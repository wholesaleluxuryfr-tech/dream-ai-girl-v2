<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dream AI Girl</title>
    <meta name="theme-color" content="#0a0a0f">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/static/css/app.css?v=20260201">
    <link rel="stylesheet" href="/app_v3_design.css">
    <link rel="manifest" href="/manifest.json">
</head>
<body>
    <div class="app-container">
        
        <!-- SIDEBAR OVERLAY -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>
        
        <!-- SIDEBAR MENU (Candy AI Style) -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">Dream AI Girl</div>
                <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">X</button>
            </div>
            
            <!-- Mode Compagnon Dropdown -->
            <div class="mode-selector">
                <span class="mode-heart">&#9829;</span>
                <span>Mode compagnon</span>
                <span class="mode-arrow">&#9662;</span>
            </div>
            
            <!-- Mon Profil Expandable -->
            <div class="menu-section expandable" id="menuProfile">
                <div class="menu-header" onclick="toggleMenuSection('menuProfile')">
                    <span class="menu-icon">&#128100;</span>
                    <span class="menu-text">Mon Profil</span>
                    <span class="menu-arrow">&#9662;</span>
                </div>
                <div class="menu-submenu">
                    <div class="submenu-item" data-page="profile">Voir mon profil</div>
                    <div class="submenu-item" onclick="showBuyTokens()">Acheter des tokens</div>
                    <div class="submenu-item" onclick="logout()">Deconnexion</div>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-item" data-page="camgirls">
                    <span class="nav-icon">&#127968;</span>
                    <span class="nav-text">Accueil</span>
                </div>
                <div class="nav-item" data-page="discover">
                    <span class="nav-icon">&#128270;</span>
                    <span class="nav-text">Decouvrir</span>
                </div>
                <div class="nav-item" data-page="messages">
                    <span class="nav-icon">&#128172;</span>
                    <span class="nav-text">Discuter</span>
                    <span class="nav-badge" id="msgBadge">3</span>
                </div>
                <div class="nav-item" data-page="myais">
                    <span class="nav-icon">&#128149;</span>
                    <span class="nav-text">Mes IA</span>
                </div>
                <div class="nav-item" data-page="gallery">
                    <span class="nav-icon">&#128444;</span>
                    <span class="nav-text">Collection</span>
                </div>
                <div class="nav-item" data-page="generate">
                    <span class="nav-icon">&#127912;</span>
                    <span class="nav-text">Generer</span>
                </div>
                <div class="nav-item" data-page="tokens">
                    <span class="nav-icon">&#127873;</span>
                    <span class="nav-text">Jetons</span>
                </div>
                <div class="nav-item" data-page="creator">
                    <span class="nav-icon">&#10024;</span>
                    <span class="nav-text">Creer un modele IA</span>
                </div>
            </nav>

            <div class="sidebar-divider"></div>
            
            <!-- Social Links -->
            <div class="sidebar-social">
                <button class="social-btn">Discord</button>
                <button class="social-btn">Contact</button>
            </div>
            <div class="sidebar-social">
                <button class="social-btn">Affiliation</button>
                <div class="lang-selector">
                    <span>&#127467;&#127479;</span> FR <span>&#9662;</span>
                </div>
            </div>
            
            <!-- Legal Links -->
            <div class="sidebar-legal">
                <a href="#">Politique de confidentialite</a>
                <a href="#">Conditions d'utilisation</a>
                <a href="#">Centre d'aide</a>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            
            <!-- MOBILE HEADER -->
            <header class="mobile-header">
                <button class="menu-btn" onclick="toggleSidebar()">â˜°</button>
                <div class="logo-small">Dream AI Girl</div>
                <div class="header-tokens" onclick="showBuyTokens()">
                    <span id="headerTokens">500</span> ðŸª™
                </div>
            </header>

            <!-- PAGE: HOME / ACCUEIL (Candy AI Style) -->
            <section class="page active" id="pageCamgirls">
                
                <!-- HERO CAROUSEL - Featured Girls -->
                <div class="hero-carousel-container">
                    <div class="hero-carousel" id="heroCarousel">
                        <!-- Slides will be injected by JS -->
                    </div>
                    <div class="hero-dots" id="heroDots"></div>
                </div>

                <!-- STORIES GIRLFRIEND -->
                <div class="stories-section">
                    <div class="stories-scroll" id="storiesContainer">
                        <!-- Stories circles will be injected here -->
                    </div>
                </div>

                <!-- ACTION EN DIRECT -->
                <div class="home-section live-section">
                    <div class="section-header">
                        <h2><span class="text-pink">Demarrez les</span> Action en Direct</h2>
                        <span class="beta-badge">BETA</span>
                    </div>
                    <div class="live-girls-scroll" id="liveGirls">
                        <!-- Live girls will be injected here -->
                    </div>
                </div>

                <!-- MODE SWIPE CTA -->
                <div class="swipe-cta-banner" onclick="openSwipeMode()">
                    <div class="swipe-cta-icon">&#128293;</div>
                    <div class="swipe-cta-text">
                        <h3>Mode Swipe</h3>
                        <p>Swipe comme sur Tinder pour matcher</p>
                    </div>
                    <span class="swipe-cta-arrow">&#8594;</span>
                </div>

                <!-- TOUTES LES FILLES -->
                <div class="home-section">
                    <div class="section-header">
                        <h2>Decouvrir</h2>
                        <button class="see-all-btn" onclick="navigateTo('discover')">Voir tout</button>
                    </div>
                    <div class="girls-grid-candy" id="allGirlsGrid">
                        <!-- All girls grid will be injected here -->
                    </div>
                </div>

                <!-- BACK TO TOP -->
                <div class="back-to-top" onclick="scrollToTop()">
                    <span>&#8593;</span> Retour en haut
                </div>
            </section>

            <!-- PAGE: DISCOVER - Instagram/TikTok Feed Style -->
            <section class="page feed-page" id="pageTinder">
                <button class="feed-back-btn" onclick="navigateTo('home')">&#8249;</button>
                <div class="feed-container" id="feedContainer">
                    <!-- Feed slides will be injected by JS -->
                </div>
                <div class="feed-progress" id="feedProgress">
                    <!-- Progress dots will be injected -->
                </div>
            </section>

            <!-- PAGE: MESSAGES / DISCUTER -->
            <section class="page" id="pageMessages">
                <div class="discuter-header">
                    <h1>Discuter</h1>
                    <button class="discuter-close" onclick="navigateTo('camgirls')">X</button>
                </div>
                <div class="discuter-search">
                    <span class="search-icon">&#128269;</span>
                    <input type="text" placeholder="Rechercher un profil..." id="searchConversation" oninput="filterConversations()">
                </div>
                <div class="conversations-list" id="conversationsList">
                    <!-- Conversations will be injected here -->
                </div>
            </section>

            <!-- PAGE: MES IA (My AI Girlfriends) -->
            <section class="page" id="pageMyAIs">
                <div class="page-header">
                    <h1>Mes IA</h1>
                    <p class="page-subtitle">Tes copines IA creees</p>
                </div>
                <div class="myais-grid" id="myAIsGrid">
                    <!-- Custom girlfriends will be injected here -->
                </div>
                <div class="myais-empty" id="myAIsEmpty">
                    <span class="empty-icon">&#128149;</span>
                    <p>Tu n'as pas encore cree de copine IA</p>
                    <button class="create-ai-btn" onclick="navigateTo('creator')">Creer ma premiere copine</button>
                </div>
            </section>

            <!-- PAGE: MATCHES -->
            <section class="page" id="pageMatches">
                <div class="page-header">
                    <h1>Tes Matches</h1>
                </div>
                <div class="matches-grid" id="matchesGrid">
                    <!-- Matches will be injected here -->
                </div>
            </section>

            <!-- PAGE: GALLERY / COLLECTION (Candy AI Style) -->
            <section class="page" id="pageGallery">
                <div class="collection-header">
                    <h1>Ma Collection</h1>
                </div>
                
                <!-- Collection Tabs -->
                <div class="collection-tabs">
                    <button class="collection-tab active" data-tab="photos" onclick="switchCollectionTab('photos')">
                        <span class="tab-icon">&#128247;</span>
                        <span>Photos</span>
                        <span class="tab-count" id="photosCount">0</span>
                    </button>
                    <button class="collection-tab" data-tab="videos" onclick="switchCollectionTab('videos')">
                        <span class="tab-icon">&#127916;</span>
                        <span>Videos</span>
                        <span class="tab-count" id="videosCount">0</span>
                    </button>
                    <button class="collection-tab" data-tab="favorites" onclick="switchCollectionTab('favorites')">
                        <span class="tab-icon">&#9829;</span>
                        <span>Favoris</span>
                        <span class="tab-count" id="favoritesCount">0</span>
                    </button>
                </div>
                
                <!-- Photos Tab -->
                <div class="collection-content active" id="tabPhotos">
                    <div class="collection-grid" id="galleryGrid">
                        <!-- Photos will be injected here -->
                    </div>
                    <div class="collection-empty" id="photosEmpty" style="display:none">
                        <span class="empty-icon">&#128247;</span>
                        <p>Aucune photo dans ta collection</p>
                        <button class="empty-btn" onclick="navigateTo('discover')">Decouvrir des profils</button>
                    </div>
                </div>
                
                <!-- Videos Tab -->
                <div class="collection-content" id="tabVideos">
                    <div class="collection-grid" id="videosGrid">
                        <!-- Videos will be injected here -->
                    </div>
                    <div class="collection-empty" id="videosEmpty">
                        <span class="empty-icon">&#127916;</span>
                        <p>Aucune video dans ta collection</p>
                        <button class="empty-btn" onclick="navigateTo('generate')">Generer une video</button>
                    </div>
                </div>
                
                <!-- Favorites Tab -->
                <div class="collection-content" id="tabFavorites">
                    <div class="favorites-grid" id="favoritesGrid">
                        <!-- Favorite girls will be injected here -->
                    </div>
                    <div class="collection-empty" id="favoritesEmpty">
                        <span class="empty-icon">&#9829;</span>
                        <p>Aucune favorite pour le moment</p>
                        <button class="empty-btn" onclick="navigateTo('discover')">Ajouter des favorites</button>
                    </div>
                </div>
            </section>

            <!-- PAGE: GENERATE -->
            <section class="page" id="pageGenerate">
                <div class="page-header">
                    <h1>Generer</h1>
                    <p class="page-subtitle">Cree des photos et videos de tes copines</p>
                </div>
                
                <!-- Girl Selection -->
                <div class="generator-section">
                    <label class="generator-section-title">Choisis ta copine</label>
                    <div class="girl-select-scroll" id="generatorGirlSelect">
                        <!-- Girls will be populated by JS -->
                    </div>
                </div>
                
                <!-- Photo/Video Toggle -->
                <div class="generator-type-toggle">
                    <button class="type-toggle-btn active" id="btnGenPhoto" onclick="setGeneratorType('photo')">Photo (20 tokens)</button>
                    <button class="type-toggle-btn" id="btnGenVideo" onclick="setGeneratorType('video')">Video (50 tokens)</button>
                </div>
                
                <!-- Tabbed Categories -->
                <div class="generator-tabs" id="generatorTabs">
                    <div class="generator-tab active" data-tab="vetements" onclick="showGeneratorTab('vetements', this)">Vetements</div>
                    <div class="generator-tab" data-tab="lingerie" onclick="showGeneratorTab('lingerie', this)">Lingerie</div>
                    <div class="generator-tab" data-tab="bikinis" onclick="showGeneratorTab('bikinis', this)">Bikinis</div>
                    <div class="generator-tab" data-tab="costumes" onclick="showGeneratorTab('costumes', this)">Costumes</div>
                    <div class="generator-tab" data-tab="luxe" onclick="showGeneratorTab('luxe', this)">Luxe</div>
                    <div class="generator-tab" data-tab="sportwear" onclick="showGeneratorTab('sportwear', this)">Sport</div>
                    <div class="generator-tab" data-tab="soiree" onclick="showGeneratorTab('soiree', this)">Soiree</div>
                    <div class="generator-tab" data-tab="poses" onclick="showGeneratorTab('poses', this)">Poses</div>
                    <div class="generator-tab" data-tab="scenes" onclick="showGeneratorTab('scenes', this)">Scenes</div>
                    <div class="generator-tab" data-tab="vehicules" onclick="showGeneratorTab('vehicules', this)">Vehicules</div>
                    <div class="generator-tab" data-tab="eclairages" onclick="showGeneratorTab('eclairages', this)">Eclairages</div>
                    <div class="generator-tab" data-tab="angles" onclick="showGeneratorTab('angles', this)">Angles</div>
                    <div class="generator-tab" data-tab="accessoires" onclick="showGeneratorTab('accessoires', this)">Accessoires</div>
                    <div class="generator-tab" data-tab="jeux" onclick="showGeneratorTab('jeux', this)">Jeux</div>
                </div>
                
                <!-- Tab Content: Vetements -->
                <div class="generator-content active" id="tabVetements">
                    <div class="image-grid-scroll">
                        <div class="image-grid" id="gridGenClothes">
                            <div class="image-option selected" data-value="lingerie" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/lingerie.jpg" class="image-option-thumb">
                                <span class="image-option-label">Lingerie</span>
                            </div>
                            <div class="image-option" data-value="bikini" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/bikini.jpg" class="image-option-thumb">
                                <span class="image-option-label">Bikini</span>
                            </div>
                            <div class="image-option" data-value="nuisette" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/nuisette.jpg" class="image-option-thumb">
                                <span class="image-option-label">Nuisette</span>
                            </div>
                            <div class="image-option" data-value="body" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/body.jpg" class="image-option-thumb">
                                <span class="image-option-label">Body</span>
                            </div>
                            <div class="image-option" data-value="maillot" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/maillot.jpg" class="image-option-thumb">
                                <span class="image-option-label">Maillot</span>
                            </div>
                            <div class="image-option" data-value="porte_jarretelles" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/porte_jarretelles.jpg" class="image-option-thumb">
                                <span class="image-option-label">Porte-jarretelles</span>
                            </div>
                            <div class="image-option" data-value="string" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/string.jpg" class="image-option-thumb">
                                <span class="image-option-label">String</span>
                            </div>
                            <div class="image-option" data-value="seins_nus" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/seins_nus.jpg" class="image-option-thumb">
                                <span class="image-option-label">Seins nus</span>
                            </div>
                            <div class="image-option" data-value="nue" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/nue.jpg" class="image-option-thumb">
                                <span class="image-option-label">Nue</span>
                            </div>
                            <div class="image-option" data-value="cuir" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/cuir.jpg" class="image-option-thumb">
                                <span class="image-option-label">Cuir</span>
                            </div>
                            <div class="image-option" data-value="latex" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/latex.jpg" class="image-option-thumb">
                                <span class="image-option-label">Latex</span>
                            </div>
                            <div class="image-option" data-value="robe_elegante" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/robe_elegante.png" class="image-option-thumb">
                                <span class="image-option-label">Robe elegante</span>
                            </div>
                            <div class="image-option" data-value="robe_courte" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/robe_courte.jpg" class="image-option-thumb">
                                <span class="image-option-label">Robe courte</span>
                            </div>
                            <div class="image-option" data-value="jean" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/jean.png" class="image-option-thumb">
                                <span class="image-option-label">Jean</span>
                            </div>
                            <div class="image-option" data-value="short" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/short.jpg" class="image-option-thumb">
                                <span class="image-option-label">Short</span>
                            </div>
                            <div class="image-option" data-value="legging" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/legging.jpg" class="image-option-thumb">
                                <span class="image-option-label">Legging</span>
                            </div>
                            <div class="image-option" data-value="sport" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/sport.png" class="image-option-thumb">
                                <span class="image-option-label">Tenue sport</span>
                            </div>
                            <div class="image-option" data-value="infirmiere" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/infirmiere.png" class="image-option-thumb">
                                <span class="image-option-label">Infirmiere</span>
                            </div>
                            <div class="image-option" data-value="policiere" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/policiere.png" class="image-option-thumb">
                                <span class="image-option-label">Policiere</span>
                            </div>
                            <div class="image-option" data-value="secretaire" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/secretaire.png" class="image-option-thumb">
                                <span class="image-option-label">Secretaire</span>
                            </div>
                            <div class="image-option" data-value="hotesse" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/hotesse.jpg" class="image-option-thumb">
                                <span class="image-option-label">Hotesse</span>
                            </div>
                            <div class="image-option" data-value="serveuse" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/serveuse.jpg" class="image-option-thumb">
                                <span class="image-option-label">Serveuse</span>
                            </div>
                            <div class="image-option" data-value="ecoliere" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/ecoliere.jpg" class="image-option-thumb">
                                <span class="image-option-label">Ecoliere</span>
                            </div>
                            <div class="image-option" data-value="soubrette" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/soubrette.jpg" class="image-option-thumb">
                                <span class="image-option-label">Soubrette</span>
                            </div>
                            <div class="image-option" data-value="militaire" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/militaire.jpg" class="image-option-thumb">
                                <span class="image-option-label">Militaire</span>
                            </div>
                            <div class="image-option" data-value="pompom_girl" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/pompom_girl.jpg" class="image-option-thumb">
                                <span class="image-option-label">Pompom girl</span>
                            </div>
                            <div class="image-option" data-value="cowgirl" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/cowgirl.jpg" class="image-option-thumb">
                                <span class="image-option-label">Cowgirl</span>
                            </div>
                            <div class="image-option" data-value="pirate" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/pirate.png" class="image-option-thumb">
                                <span class="image-option-label">Pirate</span>
                            </div>
                            <div class="image-option" data-value="footballeuse" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/footballeuse.jpg" class="image-option-thumb">
                                <span class="image-option-label">Footballeuse</span>
                            </div>
                            <div class="image-option" data-value="tennis" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/tennis.jpg" class="image-option-thumb">
                                <span class="image-option-label">Tennis</span>
                            </div>
                            <div class="image-option" data-value="football_us" onclick="selectImageOption(this, 'gridGenClothes')">
                                <img src="/static/images/creator/cropped/vetements/football_us.jpg" class="image-option-thumb">
                                <span class="image-option-label">Football US</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Actions -->
                <div class="generator-content" id="tabActions">
                    <div class="image-grid-scroll">
                        <div class="image-grid" id="gridGenActions">
                            <div class="image-option selected" data-value="pose_sexy" onclick="selectImageOption(this, 'gridGenActions')">
                                <img src="/static/images/creator/poses_actions/grid1.jpg" class="image-option-thumb" style="object-position: 0 0;">
                                <span class="image-option-label">Pose sexy</span>
                            </div>
                            <div class="image-option" data-value="selfie" onclick="selectImageOption(this, 'gridGenActions')">
                                <img src="/static/images/creator/poses_actions/grid2.jpg" class="image-option-thumb" style="object-position: 0 0;">
                                <span class="image-option-label">Selfie</span>
                            </div>
                            <div class="image-option" data-value="couche" onclick="selectImageOption(this, 'gridGenActions')">
                                <img src="/static/images/creator/poses_actions/grid1.jpg" class="image-option-thumb" style="object-position: 100% 100%;">
                                <span class="image-option-label">Couchee</span>
                            </div>
                            <div class="image-option" data-value="deshabille" onclick="selectImageOption(this, 'gridGenActions')">
                                <img src="/static/images/creator/poses_actions/grid5.jpg" class="image-option-thumb" style="object-position: 0 0;">
                                <span class="image-option-label">Se deshabille</span>
                            </div>
                            <div class="image-option" data-value="strip" onclick="selectImageOption(this, 'gridGenActions')">
                                <img src="/static/images/creator/poses_actions/grid6.jpg" class="image-option-thumb" style="object-position: 0 100%;">
                                <span class="image-option-label">Strip-tease</span>
                            </div>
                            <div class="image-option" data-value="meditation" onclick="selectImageOption(this, 'gridGenActions')">
                                <img src="/static/images/creator/poses_actions/grid4.jpg" class="image-option-thumb" style="object-position: 0 100%;">
                                <span class="image-option-label">Meditation</span>
                            </div>
                            <div class="image-option" data-value="yoga" onclick="selectImageOption(this, 'gridGenActions')">
                                <img src="/static/images/creator/poses_actions/grid1.jpg" class="image-option-thumb" style="object-position: 50% 100%;">
                                <span class="image-option-label">Yoga</span>
                            </div>
                            <div class="image-option" data-value="twerk" onclick="selectImageOption(this, 'gridGenActions')">
                                <img src="/static/images/creator/poses_actions/grid1.jpg" class="image-option-thumb" style="object-position: 100% 100%;">
                                <span class="image-option-label">Twerk</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Poses -->
                <div class="generator-content" id="tabPoses">
                    <div class="image-grid-scroll">
                        <div class="image-grid" id="gridGenPoses">
                            <div class="image-option selected" data-value="debout" onclick="selectImageOption(this, 'gridGenPoses')">
                                <img src="/static/images/creator/cropped/poses/debout.png" class="image-option-thumb">
                                <span class="image-option-label">Debout</span>
                            </div>
                            <div class="image-option" data-value="assise" onclick="selectImageOption(this, 'gridGenPoses')">
                                <img src="/static/images/creator/cropped/poses/assise.png" class="image-option-thumb">
                                <span class="image-option-label">Assise</span>
                            </div>
                            <div class="image-option" data-value="allongee" onclick="selectImageOption(this, 'gridGenPoses')">
                                <img src="/static/images/creator/cropped/poses/allongee.png" class="image-option-thumb">
                                <span class="image-option-label">Allongee</span>
                            </div>
                            <div class="image-option" data-value="a_genoux" onclick="selectImageOption(this, 'gridGenPoses')">
                                <img src="/static/images/creator/cropped/poses/a_genoux.png" class="image-option-thumb">
                                <span class="image-option-label">A genoux</span>
                            </div>
                            <div class="image-option" data-value="quatre_pattes" onclick="selectImageOption(this, 'gridGenPoses')">
                                <img src="/static/images/creator/cropped/poses/quatre_pattes.png" class="image-option-thumb">
                                <span class="image-option-label">Quatre pattes</span>
                            </div>
                            <div class="image-option" data-value="de_dos" onclick="selectImageOption(this, 'gridGenPoses')">
                                <img src="/static/images/creator/cropped/poses/de_dos.png" class="image-option-thumb">
                                <span class="image-option-label">De dos</span>
                            </div>
                            <div class="image-option" data-value="cambree" onclick="selectImageOption(this, 'gridGenPoses')">
                                <img src="/static/images/creator/cropped/poses/cambree.png" class="image-option-thumb">
                                <span class="image-option-label">Cambree</span>
                            </div>
                            <div class="image-option" data-value="penchee" onclick="selectImageOption(this, 'gridGenPoses')">
                                <img src="/static/images/creator/cropped/poses/penchee.png" class="image-option-thumb">
                                <span class="image-option-label">Penchee</span>
                            </div>
                            <div class="image-option" data-value="accroupie" onclick="selectImageOption(this, 'gridGenPoses')">
                                <img src="/static/images/creator/cropped/poses/accroupie.png" class="image-option-thumb">
                                <span class="image-option-label">Accroupie</span>
                            </div>
                            <div class="image-option" data-value="ecartee" onclick="selectImageOption(this, 'gridGenPoses')">
                                <img src="/static/images/creator/cropped/poses/ecartee.png" class="image-option-thumb">
                                <span class="image-option-label">Ecartee</span>
                            </div>
                            <div class="image-option" data-value="selfie" onclick="selectImageOption(this, 'gridGenPoses')">
                                <img src="/static/images/creator/cropped/poses/selfie.png" class="image-option-thumb">
                                <span class="image-option-label">Selfie</span>
                            </div>
                            <div class="image-option" data-value="etirement" onclick="selectImageOption(this, 'gridGenPoses')">
                                <img src="/static/images/creator/cropped/poses/etirement.png" class="image-option-thumb">
                                <span class="image-option-label">Etirement</span>
                            </div>
                            <div class="image-option" data-value="danse" onclick="selectImageOption(this, 'gridGenPoses')">
                                <img src="/static/images/creator/cropped/poses/danse.png" class="image-option-thumb">
                                <span class="image-option-label">Danse</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Accessoires -->
                <div class="generator-content" id="tabAccessoires">
                    <div class="image-grid-scroll">
                        <div class="image-grid multi" id="gridGenAccessoires" data-max="3">
                            <div class="image-option" data-value="lunettes" onclick="selectImageOption(this, 'gridGenAccessoires')">
                                <img src="/static/images/creator/accessories/grid.png" class="image-option-thumb" style="object-position: 0 0;">
                                <span class="image-option-label">Lunettes</span>
                            </div>
                            <div class="image-option" data-value="collier" onclick="selectImageOption(this, 'gridGenAccessoires')">
                                <img src="/static/images/creator/accessories/grid.png" class="image-option-thumb" style="object-position: 50% 0;">
                                <span class="image-option-label">Collier</span>
                            </div>
                            <div class="image-option" data-value="menottes" onclick="selectImageOption(this, 'gridGenAccessoires')">
                                <img src="/static/images/creator/accessories/grid.png" class="image-option-thumb" style="object-position: 100% 0;">
                                <span class="image-option-label">Menottes</span>
                            </div>
                            <div class="image-option" data-value="talons" onclick="selectImageOption(this, 'gridGenAccessoires')">
                                <img src="/static/images/creator/accessories/grid.png" class="image-option-thumb" style="object-position: 0 50%;">
                                <span class="image-option-label">Talons hauts</span>
                            </div>
                            <div class="image-option" data-value="bas" onclick="selectImageOption(this, 'gridGenAccessoires')">
                                <img src="/static/images/creator/accessories/grid.png" class="image-option-thumb" style="object-position: 50% 50%;">
                                <span class="image-option-label">Bas resille</span>
                            </div>
                            <div class="image-option" data-value="aucun" onclick="selectImageOption(this, 'gridGenAccessoires')">
                                <img src="/static/images/creator/accessories/grid.png" class="image-option-thumb" style="object-position: 100% 50%;">
                                <span class="image-option-label">Aucun</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Scenes -->
                <div class="generator-content" id="tabScenes">
                    <div class="image-grid-scroll">
                        <div class="image-grid" id="gridGenScenes">
                            <div class="image-option selected" data-value="chambre" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/chambre.jpg" class="image-option-thumb">
                                <span class="image-option-label">Chambre</span>
                            </div>
                            <div class="image-option" data-value="salon" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/salon.jpg" class="image-option-thumb">
                                <span class="image-option-label">Salon</span>
                            </div>
                            <div class="image-option" data-value="salle_de_bain" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/salle_de_bain.jpg" class="image-option-thumb">
                                <span class="image-option-label">Salle de bain</span>
                            </div>
                            <div class="image-option" data-value="jacuzzi" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/jacuzzi.jpg" class="image-option-thumb">
                                <span class="image-option-label">Jacuzzi</span>
                            </div>
                            <div class="image-option" data-value="bureau" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/bureau.jpg" class="image-option-thumb">
                                <span class="image-option-label">Bureau</span>
                            </div>
                            <div class="image-option" data-value="studio_photo" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/studio_photo.jpg" class="image-option-thumb">
                                <span class="image-option-label">Studio photo</span>
                            </div>
                            <div class="image-option" data-value="club" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/club.jpg" class="image-option-thumb">
                                <span class="image-option-label">Club</span>
                            </div>
                            <div class="image-option" data-value="yacht" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/yacht.jpg" class="image-option-thumb">
                                <span class="image-option-label">Yacht</span>
                            </div>
                            <div class="image-option" data-value="salle_de_sport" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/salle_de_sport.jpg" class="image-option-thumb">
                                <span class="image-option-label">Salle de sport</span>
                            </div>
                            <div class="image-option" data-value="parking" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/parking.png" class="image-option-thumb">
                                <span class="image-option-label">Parking</span>
                            </div>
                            <div class="image-option" data-value="vestiaire" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/vestiaire.png" class="image-option-thumb">
                                <span class="image-option-label">Vestiaire</span>
                            </div>
                            <div class="image-option" data-value="balcon" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/balcon.png" class="image-option-thumb">
                                <span class="image-option-label">Balcon</span>
                            </div>
                            <div class="image-option" data-value="escalier" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/escalier.png" class="image-option-thumb">
                                <span class="image-option-label">Escalier</span>
                            </div>
                            <div class="image-option" data-value="ascenseur" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/ascenseur.png" class="image-option-thumb">
                                <span class="image-option-label">Ascenseur</span>
                            </div>
                            <div class="image-option" data-value="cabine_essayage" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/cabine_essayage.png" class="image-option-thumb">
                                <span class="image-option-label">Cabine essayage</span>
                            </div>
                            <div class="image-option" data-value="restaurant" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/restaurant.png" class="image-option-thumb">
                                <span class="image-option-label">Restaurant</span>
                            </div>
                            <div class="image-option" data-value="cinema" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/cinema.png" class="image-option-thumb">
                                <span class="image-option-label">Cinema</span>
                            </div>
                            <div class="image-option" data-value="terrasse" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/terrasse.png" class="image-option-thumb">
                                <span class="image-option-label">Terrasse</span>
                            </div>
                            <div class="image-option" data-value="limousine" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/limousine.png" class="image-option-thumb">
                                <span class="image-option-label">Limousine</span>
                            </div>
                            <div class="image-option" data-value="train" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/train.png" class="image-option-thumb">
                                <span class="image-option-label">Train</span>
                            </div>
                            <div class="image-option" data-value="jet_prive" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/jet_prive.png" class="image-option-thumb">
                                <span class="image-option-label">Jet prive</span>
                            </div>
                            <div class="image-option" data-value="suite_hotel" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/suite_hotel.png" class="image-option-thumb">
                                <span class="image-option-label">Suite hotel</span>
                            </div>
                            <div class="image-option" data-value="sauna" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/sauna.png" class="image-option-thumb">
                                <span class="image-option-label">Sauna</span>
                            </div>
                            <div class="image-option" data-value="spa" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/spa.png" class="image-option-thumb">
                                <span class="image-option-label">Spa</span>
                            </div>
                            <div class="image-option" data-value="discoteque" onclick="selectImageOption(this, 'gridGenScenes')">
                                <img src="/static/images/creator/cropped/lieux/discoteque.png" class="image-option-thumb">
                                <span class="image-option-label">Discotheque</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Lingerie -->
                <div class="generator-content" id="tabLingerie">
                    <div class="image-grid-scroll">
                        <div class="image-grid" id="gridGenLingerie">
                            <div class="image-option selected" data-value="bralette_noire" onclick="selectImageOption(this, 'gridGenLingerie')">
                                <img src="/static/images/creator/cropped/lingerie/bralette_noire.png" class="image-option-thumb">
                                <span class="image-option-label">Bralette noire</span>
                            </div>
                            <div class="image-option" data-value="corset_rouge" onclick="selectImageOption(this, 'gridGenLingerie')">
                                <img src="/static/images/creator/cropped/lingerie/corset_rouge.png" class="image-option-thumb">
                                <span class="image-option-label">Corset rouge</span>
                            </div>
                            <div class="image-option" data-value="babydoll" onclick="selectImageOption(this, 'gridGenLingerie')">
                                <img src="/static/images/creator/cropped/lingerie/babydoll.png" class="image-option-thumb">
                                <span class="image-option-label">Babydoll</span>
                            </div>
                            <div class="image-option" data-value="teddy_noir" onclick="selectImageOption(this, 'gridGenLingerie')">
                                <img src="/static/images/creator/cropped/lingerie/teddy_noir.png" class="image-option-thumb">
                                <span class="image-option-label">Teddy noir</span>
                            </div>
                            <div class="image-option" data-value="push_up" onclick="selectImageOption(this, 'gridGenLingerie')">
                                <img src="/static/images/creator/cropped/lingerie/push_up.png" class="image-option-thumb">
                                <span class="image-option-label">Push-up</span>
                            </div>
                            <div class="image-option" data-value="mariee" onclick="selectImageOption(this, 'gridGenLingerie')">
                                <img src="/static/images/creator/cropped/lingerie/mariee.png" class="image-option-thumb">
                                <span class="image-option-label">Mariee</span>
                            </div>
                            <div class="image-option" data-value="leopard" onclick="selectImageOption(this, 'gridGenLingerie')">
                                <img src="/static/images/creator/cropped/lingerie/leopard.png" class="image-option-thumb">
                                <span class="image-option-label">Leopard</span>
                            </div>
                            <div class="image-option" data-value="velours_violet" onclick="selectImageOption(this, 'gridGenLingerie')">
                                <img src="/static/images/creator/cropped/lingerie/velours_violet.png" class="image-option-thumb">
                                <span class="image-option-label">Velours violet</span>
                            </div>
                            <div class="image-option" data-value="satin_bleu" onclick="selectImageOption(this, 'gridGenLingerie')">
                                <img src="/static/images/creator/cropped/lingerie/satin_bleu.png" class="image-option-thumb">
                                <span class="image-option-label">Satin bleu</span>
                            </div>
                            <div class="image-option" data-value="vert_emeraude" onclick="selectImageOption(this, 'gridGenLingerie')">
                                <img src="/static/images/creator/cropped/lingerie/vert_emeraude.png" class="image-option-thumb">
                                <span class="image-option-label">Vert emeraude</span>
                            </div>
                            <div class="image-option" data-value="dore" onclick="selectImageOption(this, 'gridGenLingerie')">
                                <img src="/static/images/creator/cropped/lingerie/dore.png" class="image-option-thumb">
                                <span class="image-option-label">Dore</span>
                            </div>
                            <div class="image-option" data-value="floral" onclick="selectImageOption(this, 'gridGenLingerie')">
                                <img src="/static/images/creator/cropped/lingerie/floral.png" class="image-option-thumb">
                                <span class="image-option-label">Floral</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Bikinis -->
                <div class="generator-content" id="tabBikinis">
                    <div class="image-grid-scroll">
                        <div class="image-grid" id="gridGenBikinis">
                            <div class="image-option selected" data-value="string_rouge" onclick="selectImageOption(this, 'gridGenBikinis')">
                                <img src="/static/images/creator/cropped/bikinis/string_rouge.png" class="image-option-thumb">
                                <span class="image-option-label">String rouge</span>
                            </div>
                            <div class="image-option" data-value="triangle_blanc" onclick="selectImageOption(this, 'gridGenBikinis')">
                                <img src="/static/images/creator/cropped/bikinis/triangle_blanc.png" class="image-option-thumb">
                                <span class="image-option-label">Triangle blanc</span>
                            </div>
                            <div class="image-option" data-value="maillot_noir" onclick="selectImageOption(this, 'gridGenBikinis')">
                                <img src="/static/images/creator/cropped/bikinis/maillot_noir.png" class="image-option-thumb">
                                <span class="image-option-label">Maillot noir</span>
                            </div>
                            <div class="image-option" data-value="rose_neon" onclick="selectImageOption(this, 'gridGenBikinis')">
                                <img src="/static/images/creator/cropped/bikinis/rose_neon.png" class="image-option-thumb">
                                <span class="image-option-label">Rose neon</span>
                            </div>
                            <div class="image-option" data-value="leopard" onclick="selectImageOption(this, 'gridGenBikinis')">
                                <img src="/static/images/creator/cropped/bikinis/leopard.png" class="image-option-thumb">
                                <span class="image-option-label">Leopard</span>
                            </div>
                            <div class="image-option" data-value="dore" onclick="selectImageOption(this, 'gridGenBikinis')">
                                <img src="/static/images/creator/cropped/bikinis/dore.png" class="image-option-thumb">
                                <span class="image-option-label">Dore</span>
                            </div>
                            <div class="image-option" data-value="micro_bleu" onclick="selectImageOption(this, 'gridGenBikinis')">
                                <img src="/static/images/creator/cropped/bikinis/micro_bleu.png" class="image-option-thumb">
                                <span class="image-option-label">Micro bleu</span>
                            </div>
                            <div class="image-option" data-value="crochet" onclick="selectImageOption(this, 'gridGenBikinis')">
                                <img src="/static/images/creator/cropped/bikinis/crochet.png" class="image-option-thumb">
                                <span class="image-option-label">Crochet</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Costumes -->
                <div class="generator-content" id="tabCostumes">
                    <div class="image-grid-scroll">
                        <div class="image-grid" id="gridGenCostumes">
                            <div class="image-option selected" data-value="infirmiere" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/infirmiere.png" class="image-option-thumb">
                                <span class="image-option-label">Infirmiere</span>
                            </div>
                            <div class="image-option" data-value="policiere" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/policiere.png" class="image-option-thumb">
                                <span class="image-option-label">Policiere</span>
                            </div>
                            <div class="image-option" data-value="soubrette" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/soubrette.png" class="image-option-thumb">
                                <span class="image-option-label">Soubrette</span>
                            </div>
                            <div class="image-option" data-value="ecoliere" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/ecoliere.png" class="image-option-thumb">
                                <span class="image-option-label">Ecoliere</span>
                            </div>
                            <div class="image-option" data-value="secretaire" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/secretaire.png" class="image-option-thumb">
                                <span class="image-option-label">Secretaire</span>
                            </div>
                            <div class="image-option" data-value="vampire" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/vampire.png" class="image-option-thumb">
                                <span class="image-option-label">Vampire</span>
                            </div>
                            <div class="image-option" data-value="chat" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/chat.png" class="image-option-thumb">
                                <span class="image-option-label">Chat</span>
                            </div>
                            <div class="image-option" data-value="diablesse" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/diablesse.png" class="image-option-thumb">
                                <span class="image-option-label">Diablesse</span>
                            </div>
                            <div class="image-option" data-value="ange" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/ange.png" class="image-option-thumb">
                                <span class="image-option-label">Ange</span>
                            </div>
                            <div class="image-option" data-value="pom_pom_girl" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/pom_pom_girl.png" class="image-option-thumb">
                                <span class="image-option-label">Pom pom girl</span>
                            </div>
                            <div class="image-option" data-value="cowgirl" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/cowgirl.png" class="image-option-thumb">
                                <span class="image-option-label">Cowgirl</span>
                            </div>
                            <div class="image-option" data-value="pirate" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/pirate.png" class="image-option-thumb">
                                <span class="image-option-label">Pirate</span>
                            </div>
                            <div class="image-option" data-value="sorciere" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/sorciere.png" class="image-option-thumb">
                                <span class="image-option-label">Sorciere</span>
                            </div>
                            <div class="image-option" data-value="geisha" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/geisha.png" class="image-option-thumb">
                                <span class="image-option-label">Geisha</span>
                            </div>
                            <div class="image-option" data-value="guerriere" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/guerriere.png" class="image-option-thumb">
                                <span class="image-option-label">Guerriere</span>
                            </div>
                            <div class="image-option" data-value="danseuse_ventre" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/danseuse_ventre.png" class="image-option-thumb">
                                <span class="image-option-label">Danseuse ventre</span>
                            </div>
                            <div class="image-option" data-value="dominatrice" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/dominatrice.png" class="image-option-thumb">
                                <span class="image-option-label">Dominatrice</span>
                            </div>
                            <div class="image-option" data-value="princesse" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/princesse.png" class="image-option-thumb">
                                <span class="image-option-label">Princesse</span>
                            </div>
                            <div class="image-option" data-value="sirene" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/sirene.png" class="image-option-thumb">
                                <span class="image-option-label">Sirene</span>
                            </div>
                            <div class="image-option" data-value="motarde" onclick="selectImageOption(this, 'gridGenCostumes')">
                                <img src="/static/images/creator/cropped/costumes_sexy/motarde.png" class="image-option-thumb">
                                <span class="image-option-label">Motarde</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Luxe -->
                <div class="generator-content" id="tabLuxe">
                    <div class="image-grid-scroll">
                        <div class="image-grid" id="gridGenLuxe">
                            <div class="image-option selected" data-value="chanel" onclick="selectImageOption(this, 'gridGenLuxe')">
                                <img src="/static/images/creator/cropped/luxe/chanel.png" class="image-option-thumb">
                                <span class="image-option-label">Chanel</span>
                            </div>
                            <div class="image-option" data-value="gucci" onclick="selectImageOption(this, 'gridGenLuxe')">
                                <img src="/static/images/creator/cropped/luxe/gucci.png" class="image-option-thumb">
                                <span class="image-option-label">Gucci</span>
                            </div>
                            <div class="image-option" data-value="louis_vuitton" onclick="selectImageOption(this, 'gridGenLuxe')">
                                <img src="/static/images/creator/cropped/luxe/louis_vuitton.png" class="image-option-thumb">
                                <span class="image-option-label">Louis Vuitton</span>
                            </div>
                            <div class="image-option" data-value="dior" onclick="selectImageOption(this, 'gridGenLuxe')">
                                <img src="/static/images/creator/cropped/luxe/dior.png" class="image-option-thumb">
                                <span class="image-option-label">Dior</span>
                            </div>
                            <div class="image-option" data-value="versace" onclick="selectImageOption(this, 'gridGenLuxe')">
                                <img src="/static/images/creator/cropped/luxe/versace.png" class="image-option-thumb">
                                <span class="image-option-label">Versace</span>
                            </div>
                            <div class="image-option" data-value="prada" onclick="selectImageOption(this, 'gridGenLuxe')">
                                <img src="/static/images/creator/cropped/luxe/prada.png" class="image-option-thumb">
                                <span class="image-option-label">Prada</span>
                            </div>
                            <div class="image-option" data-value="balenciaga" onclick="selectImageOption(this, 'gridGenLuxe')">
                                <img src="/static/images/creator/cropped/luxe/balenciaga.png" class="image-option-thumb">
                                <span class="image-option-label">Balenciaga</span>
                            </div>
                            <div class="image-option" data-value="hermes" onclick="selectImageOption(this, 'gridGenLuxe')">
                                <img src="/static/images/creator/cropped/luxe/hermes.png" class="image-option-thumb">
                                <span class="image-option-label">Hermes</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Sportwear -->
                <div class="generator-content" id="tabSportwear">
                    <div class="image-grid-scroll">
                        <div class="image-grid" id="gridGenSportwear">
                            <div class="image-option selected" data-value="nike" onclick="selectImageOption(this, 'gridGenSportwear')">
                                <img src="/static/images/creator/cropped/sportwear/nike.png" class="image-option-thumb">
                                <span class="image-option-label">Nike</span>
                            </div>
                            <div class="image-option" data-value="adidas" onclick="selectImageOption(this, 'gridGenSportwear')">
                                <img src="/static/images/creator/cropped/sportwear/adidas.png" class="image-option-thumb">
                                <span class="image-option-label">Adidas</span>
                            </div>
                            <div class="image-option" data-value="puma" onclick="selectImageOption(this, 'gridGenSportwear')">
                                <img src="/static/images/creator/cropped/sportwear/puma.png" class="image-option-thumb">
                                <span class="image-option-label">Puma</span>
                            </div>
                            <div class="image-option" data-value="lululemon" onclick="selectImageOption(this, 'gridGenSportwear')">
                                <img src="/static/images/creator/cropped/sportwear/lululemon.png" class="image-option-thumb">
                                <span class="image-option-label">Lululemon</span>
                            </div>
                            <div class="image-option" data-value="under_armour" onclick="selectImageOption(this, 'gridGenSportwear')">
                                <img src="/static/images/creator/cropped/sportwear/under_armour.png" class="image-option-thumb">
                                <span class="image-option-label">Under Armour</span>
                            </div>
                            <div class="image-option" data-value="gymshark" onclick="selectImageOption(this, 'gridGenSportwear')">
                                <img src="/static/images/creator/cropped/sportwear/gymshark.png" class="image-option-thumb">
                                <span class="image-option-label">Gymshark</span>
                            </div>
                            <div class="image-option" data-value="reebok" onclick="selectImageOption(this, 'gridGenSportwear')">
                                <img src="/static/images/creator/cropped/sportwear/reebok.png" class="image-option-thumb">
                                <span class="image-option-label">Reebok</span>
                            </div>
                            <div class="image-option" data-value="calvin_klein" onclick="selectImageOption(this, 'gridGenSportwear')">
                                <img src="/static/images/creator/cropped/sportwear/calvin_klein.png" class="image-option-thumb">
                                <span class="image-option-label">Calvin Klein</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Soiree -->
                <div class="generator-content" id="tabSoiree">
                    <div class="image-grid-scroll">
                        <div class="image-grid" id="gridGenSoiree">
                            <div class="image-option selected" data-value="robe_noire" onclick="selectImageOption(this, 'gridGenSoiree')">
                                <img src="/static/images/creator/cropped/soiree/robe_noire.png" class="image-option-thumb">
                                <span class="image-option-label">Robe noire</span>
                            </div>
                            <div class="image-option" data-value="paillettes_rouge" onclick="selectImageOption(this, 'gridGenSoiree')">
                                <img src="/static/images/creator/cropped/soiree/paillettes_rouge.png" class="image-option-thumb">
                                <span class="image-option-label">Paillettes rouge</span>
                            </div>
                            <div class="image-option" data-value="petite_robe_noire" onclick="selectImageOption(this, 'gridGenSoiree')">
                                <img src="/static/images/creator/cropped/soiree/petite_robe_noire.png" class="image-option-thumb">
                                <span class="image-option-label">Petite robe noire</span>
                            </div>
                            <div class="image-option" data-value="robe_doree" onclick="selectImageOption(this, 'gridGenSoiree')">
                                <img src="/static/images/creator/cropped/soiree/robe_doree.png" class="image-option-thumb">
                                <span class="image-option-label">Robe doree</span>
                            </div>
                            <div class="image-option" data-value="velours_bordeaux" onclick="selectImageOption(this, 'gridGenSoiree')">
                                <img src="/static/images/creator/cropped/soiree/velours_bordeaux.png" class="image-option-thumb">
                                <span class="image-option-label">Velours bordeaux</span>
                            </div>
                            <div class="image-option" data-value="argent" onclick="selectImageOption(this, 'gridGenSoiree')">
                                <img src="/static/images/creator/cropped/soiree/argent.png" class="image-option-thumb">
                                <span class="image-option-label">Argent</span>
                            </div>
                            <div class="image-option" data-value="combinaison_blanche" onclick="selectImageOption(this, 'gridGenSoiree')">
                                <img src="/static/images/creator/cropped/soiree/combinaison_blanche.png" class="image-option-thumb">
                                <span class="image-option-label">Combinaison blanche</span>
                            </div>
                            <div class="image-option" data-value="decollete_plongeant" onclick="selectImageOption(this, 'gridGenSoiree')">
                                <img src="/static/images/creator/cropped/soiree/decollete_plongeant.png" class="image-option-thumb">
                                <span class="image-option-label">Decollete plongeant</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Vehicules -->
                <div class="generator-content" id="tabVehicules">
                    <div class="image-grid-scroll">
                        <div class="image-grid" id="gridGenVehicules">
                            <div class="image-option selected" data-value="voiture_sport" onclick="selectImageOption(this, 'gridGenVehicules')">
                                <img src="/static/images/creator/cropped/vehicules/voiture_sport.png" class="image-option-thumb">
                                <span class="image-option-label">Voiture sport</span>
                            </div>
                            <div class="image-option" data-value="limousine" onclick="selectImageOption(this, 'gridGenVehicules')">
                                <img src="/static/images/creator/cropped/vehicules/limousine.png" class="image-option-thumb">
                                <span class="image-option-label">Limousine</span>
                            </div>
                            <div class="image-option" data-value="moto" onclick="selectImageOption(this, 'gridGenVehicules')">
                                <img src="/static/images/creator/cropped/vehicules/moto.png" class="image-option-thumb">
                                <span class="image-option-label">Moto</span>
                            </div>
                            <div class="image-option" data-value="cabriolet" onclick="selectImageOption(this, 'gridGenVehicules')">
                                <img src="/static/images/creator/cropped/vehicules/cabriolet.png" class="image-option-thumb">
                                <span class="image-option-label">Cabriolet</span>
                            </div>
                            <div class="image-option" data-value="jet_prive" onclick="selectImageOption(this, 'gridGenVehicules')">
                                <img src="/static/images/creator/cropped/vehicules/jet_prive.png" class="image-option-thumb">
                                <span class="image-option-label">Jet prive</span>
                            </div>
                            <div class="image-option" data-value="yacht" onclick="selectImageOption(this, 'gridGenVehicules')">
                                <img src="/static/images/creator/cropped/vehicules/yacht.png" class="image-option-thumb">
                                <span class="image-option-label">Yacht</span>
                            </div>
                            <div class="image-option" data-value="voiture_vintage" onclick="selectImageOption(this, 'gridGenVehicules')">
                                <img src="/static/images/creator/cropped/vehicules/voiture_vintage.png" class="image-option-thumb">
                                <span class="image-option-label">Voiture vintage</span>
                            </div>
                            <div class="image-option" data-value="suv_luxe" onclick="selectImageOption(this, 'gridGenVehicules')">
                                <img src="/static/images/creator/cropped/vehicules/suv_luxe.png" class="image-option-thumb">
                                <span class="image-option-label">SUV luxe</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Eclairages -->
                <div class="generator-content" id="tabEclairages">
                    <div class="image-grid-scroll">
                        <div class="image-grid" id="gridGenEclairages">
                            <div class="image-option selected" data-value="neon" onclick="selectImageOption(this, 'gridGenEclairages')">
                                <img src="/static/images/creator/cropped/eclairages/neon.png" class="image-option-thumb">
                                <span class="image-option-label">Neon</span>
                            </div>
                            <div class="image-option" data-value="bougies" onclick="selectImageOption(this, 'gridGenEclairages')">
                                <img src="/static/images/creator/cropped/eclairages/bougies.png" class="image-option-thumb">
                                <span class="image-option-label">Bougies</span>
                            </div>
                            <div class="image-option" data-value="coucher_soleil" onclick="selectImageOption(this, 'gridGenEclairages')">
                                <img src="/static/images/creator/cropped/eclairages/coucher_soleil.png" class="image-option-thumb">
                                <span class="image-option-label">Coucher soleil</span>
                            </div>
                            <div class="image-option" data-value="studio" onclick="selectImageOption(this, 'gridGenEclairages')">
                                <img src="/static/images/creator/cropped/eclairages/studio.png" class="image-option-thumb">
                                <span class="image-option-label">Studio</span>
                            </div>
                            <div class="image-option" data-value="clair_lune" onclick="selectImageOption(this, 'gridGenEclairages')">
                                <img src="/static/images/creator/cropped/eclairages/clair_lune.png" class="image-option-thumb">
                                <span class="image-option-label">Clair de lune</span>
                            </div>
                            <div class="image-option" data-value="lumiere_naturelle" onclick="selectImageOption(this, 'gridGenEclairages')">
                                <img src="/static/images/creator/cropped/eclairages/lumiere_naturelle.png" class="image-option-thumb">
                                <span class="image-option-label">Lumiere naturelle</span>
                            </div>
                            <div class="image-option" data-value="ombres" onclick="selectImageOption(this, 'gridGenEclairages')">
                                <img src="/static/images/creator/cropped/eclairages/ombres.png" class="image-option-thumb">
                                <span class="image-option-label">Ombres</span>
                            </div>
                            <div class="image-option" data-value="ring_light" onclick="selectImageOption(this, 'gridGenEclairages')">
                                <img src="/static/images/creator/cropped/eclairages/ring_light.png" class="image-option-thumb">
                                <span class="image-option-label">Ring light</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Angles -->
                <div class="generator-content" id="tabAngles">
                    <div class="image-grid-scroll">
                        <div class="image-grid" id="gridGenAngles">
                            <div class="image-option selected" data-value="plongee" onclick="selectImageOption(this, 'gridGenAngles')">
                                <img src="/static/images/creator/cropped/angles/plongee.png" class="image-option-thumb">
                                <span class="image-option-label">Plongee</span>
                            </div>
                            <div class="image-option" data-value="contre_plongee" onclick="selectImageOption(this, 'gridGenAngles')">
                                <img src="/static/images/creator/cropped/angles/contre_plongee.png" class="image-option-thumb">
                                <span class="image-option-label">Contre-plongee</span>
                            </div>
                            <div class="image-option" data-value="profil" onclick="selectImageOption(this, 'gridGenAngles')">
                                <img src="/static/images/creator/cropped/angles/profil.png" class="image-option-thumb">
                                <span class="image-option-label">Profil</span>
                            </div>
                            <div class="image-option" data-value="trois_quarts" onclick="selectImageOption(this, 'gridGenAngles')">
                                <img src="/static/images/creator/cropped/angles/trois_quarts.png" class="image-option-thumb">
                                <span class="image-option-label">Trois quarts</span>
                            </div>
                            <div class="image-option" data-value="dos" onclick="selectImageOption(this, 'gridGenAngles')">
                                <img src="/static/images/creator/cropped/angles/dos.png" class="image-option-thumb">
                                <span class="image-option-label">De dos</span>
                            </div>
                            <div class="image-option" data-value="gros_plan" onclick="selectImageOption(this, 'gridGenAngles')">
                                <img src="/static/images/creator/cropped/angles/gros_plan.png" class="image-option-thumb">
                                <span class="image-option-label">Gros plan</span>
                            </div>
                            <div class="image-option" data-value="corps_entier" onclick="selectImageOption(this, 'gridGenAngles')">
                                <img src="/static/images/creator/cropped/angles/corps_entier.png" class="image-option-thumb">
                                <span class="image-option-label">Corps entier</span>
                            </div>
                            <div class="image-option" data-value="selfie_pov" onclick="selectImageOption(this, 'gridGenAngles')">
                                <img src="/static/images/creator/cropped/angles/selfie_pov.png" class="image-option-thumb">
                                <span class="image-option-label">Selfie POV</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tab Content: Jeux -->
                <div class="generator-content" id="tabJeux">
                    <div class="image-grid-scroll">
                        <div class="image-grid" id="gridGenJeux">
                            <div class="image-option selected" data-value="strip_poker" onclick="selectImageOption(this, 'gridGenJeux')">
                                <img src="/static/images/creator/cropped/jeux_coquins/strip_poker.png" class="image-option-thumb">
                                <span class="image-option-label">Strip poker</span>
                            </div>
                            <div class="image-option" data-value="des_coquins" onclick="selectImageOption(this, 'gridGenJeux')">
                                <img src="/static/images/creator/cropped/jeux_coquins/des_coquins.png" class="image-option-thumb">
                                <span class="image-option-label">Des coquins</span>
                            </div>
                            <div class="image-option" data-value="action_verite" onclick="selectImageOption(this, 'gridGenJeux')">
                                <img src="/static/images/creator/cropped/jeux_coquins/action_verite.png" class="image-option-thumb">
                                <span class="image-option-label">Action verite</span>
                            </div>
                            <div class="image-option" data-value="bouteille" onclick="selectImageOption(this, 'gridGenJeux')">
                                <img src="/static/images/creator/cropped/jeux_coquins/bouteille.png" class="image-option-thumb">
                                <span class="image-option-label">Bouteille</span>
                            </div>
                            <div class="image-option" data-value="devine_qui" onclick="selectImageOption(this, 'gridGenJeux')">
                                <img src="/static/images/creator/cropped/jeux_coquins/devine_qui.png" class="image-option-thumb">
                                <span class="image-option-label">Devine qui</span>
                            </div>
                            <div class="image-option" data-value="peinture_corporelle" onclick="selectImageOption(this, 'gridGenJeux')">
                                <img src="/static/images/creator/cropped/jeux_coquins/peinture_corporelle.png" class="image-option-thumb">
                                <span class="image-option-label">Peinture corporelle</span>
                            </div>
                            <div class="image-option" data-value="glacons" onclick="selectImageOption(this, 'gridGenJeux')">
                                <img src="/static/images/creator/cropped/jeux_coquins/glacons.png" class="image-option-thumb">
                                <span class="image-option-label">Glacons</span>
                            </div>
                            <div class="image-option" data-value="massage" onclick="selectImageOption(this, 'gridGenJeux')">
                                <img src="/static/images/creator/cropped/jeux_coquins/massage.png" class="image-option-thumb">
                                <span class="image-option-label">Massage</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Generate Button -->
                <div class="generator-footer">
                    <button class="cta-btn generate-btn" id="btnGenerate" onclick="generateMedia()">
                        <span>Generer</span>
                        <span class="gen-cost" id="genCost">20 tokens</span>
                    </button>
                </div>
            </section>

            <!-- PAGE: MES IA (My Custom AI Girlfriends) -->
            <section class="page" id="pageMesIA">
                <div class="page-header">
                    <h1>Mes Copines IA</h1>
                    <p class="page-subtitle">Tes creations personnalisees</p>
                </div>
                <div class="mes-ia-grid" id="mesIAGrid">
                    <!-- Custom girls will be injected here -->
                </div>
                <div class="mes-ia-empty" id="mesIAEmpty">
                    <span class="empty-icon">&#128150;</span>
                    <p>Tu n'as pas encore cree de copine IA</p>
                    <p class="empty-sub">Cree ta copine ideale en quelques clics</p>
                    <button class="cta-btn" onclick="navigateTo('creator')">Creer ma premiere copine</button>
                </div>
            </section>

            <!-- PAGE: TOKENS (Pricing & Packs) -->
            <section class="page" id="pageTokens">
                <div class="page-header">
                    <h1>Jetons</h1>
                    <p class="page-subtitle">Debloquer du contenu exclusif</p>
                </div>
                <div class="token-balance">
                    <span class="token-icon">&#127873;</span>
                    <span class="token-count" id="tokenBalance">0</span>
                    <span class="token-label">jetons disponibles</span>
                </div>
                <div class="token-packs">
                    <div class="token-pack" onclick="buyTokens(100)">
                        <div class="pack-amount">100</div>
                        <div class="pack-label">jetons</div>
                        <div class="pack-price">9.99 EUR</div>
                        <div class="pack-bonus"></div>
                    </div>
                    <div class="token-pack popular" onclick="buyTokens(500)">
                        <div class="pack-badge">Populaire</div>
                        <div class="pack-amount">500</div>
                        <div class="pack-label">jetons</div>
                        <div class="pack-price">39.99 EUR</div>
                        <div class="pack-bonus">+20% bonus</div>
                    </div>
                    <div class="token-pack" onclick="buyTokens(1000)">
                        <div class="pack-amount">1000</div>
                        <div class="pack-label">jetons</div>
                        <div class="pack-price">69.99 EUR</div>
                        <div class="pack-bonus">+30% bonus</div>
                    </div>
                    <div class="token-pack best-value" onclick="buyTokens(3000)">
                        <div class="pack-badge">Meilleure offre</div>
                        <div class="pack-amount">3000</div>
                        <div class="pack-label">jetons</div>
                        <div class="pack-price">149.99 EUR</div>
                        <div class="pack-bonus">+50% bonus</div>
                    </div>
                </div>
                <div class="token-uses">
                    <h3>Utilisation des jetons</h3>
                    <div class="use-item"><span class="use-cost">1</span><span class="use-text">Message envoye</span></div>
                    <div class="use-item"><span class="use-cost">5</span><span class="use-text">Demander une photo</span></div>
                    <div class="use-item"><span class="use-cost">20</span><span class="use-text">Generer une photo HD</span></div>
                    <div class="use-item"><span class="use-cost">50</span><span class="use-text">Generer une video</span></div>
                    <div class="use-item"><span class="use-cost">10</span><span class="use-text">Creer une copine IA</span></div>
                    <div class="use-item"><span class="use-cost">1</span><span class="use-text">Changer de visage</span></div>
                </div>
                <div class="premium-section">
                    <h3>Abonnement Premium</h3>
                    <div class="premium-card">
                        <div class="premium-price">12.99 EUR<span>/mois</span></div>
                        <ul class="premium-benefits">
                            <li>Messages illimites</li>
                            <li>200 jetons/mois inclus</li>
                            <li>Photos HD illimitees</li>
                            <li>Acces prioritaire aux nouvelles filles</li>
                            <li>Pas de publicite</li>
                        </ul>
                        <button class="premium-btn" onclick="showPremiumPopup()">Devenir Premium</button>
                    </div>
                </div>
            </section>

            <!-- PAGE: PROFILE -->
            <section class="page" id="pageProfile">
                <div class="profile-settings">
                    <div class="profile-avatar-big" id="userAvatar">U</div>
                    <h2 id="userName">Utilisateur</h2>
                    <div class="profile-stats">
                        <div class="stat"><span class="stat-value" id="statMatches">0</span><span class="stat-label">Matches</span></div>
                        <div class="stat"><span class="stat-value" id="statPhotos">0</span><span class="stat-label">Photos</span></div>
                        <div class="stat"><span class="stat-value" id="statTokens">500</span><span class="stat-label">Tokens</span></div>
                    </div>
                </div>
            </section>

            <!-- PAGE: CREATOR (Creer sa copine IA - Wizard Style) -->
            <section class="page" id="pageCreator">
                <div class="creator-wizard">
                    <!-- Header with logo -->
                    <div class="wizard-header">
                        <span class="wizard-logo">CMAI</span>
                        <span class="wizard-version">V2</span>
                        <button class="wizard-close" onclick="navigateTo('discover')">X</button>
                    </div>
                    
                    <!-- Main tabs progress -->
                    <div class="wizard-progress">
                        <div class="progress-tab completed" data-step="vetements">
                            <span class="tab-check">&#10003;</span>
                            <span class="tab-icon">&#128087;</span>
                            <span class="tab-name">Vetements</span>
                        </div>
                        <div class="progress-tab active" data-step="personnage">
                            <span class="tab-icon">&#128100;</span>
                            <span class="tab-name">Personnage</span>
                        </div>
                    </div>
                    
                    <!-- STEP 1: VETEMENTS (Appearance) -->
                    <div class="wizard-step" id="stepVetements">
                        <div class="step-content">
                            <div class="creator-section">
                                <label>Prenom</label>
                                <input type="text" id="gfName" placeholder="Choisis son prenom..." class="creator-input">
                            </div>
                            <div class="creator-section">
                                <label>Origine / Ethnicite</label>
                                <div class="image-grid" id="gridEthnicity">
                                    <div class="image-option selected" data-value="caucasienne" onclick="selectImageOption(this, 'gridEthnicity')">
                                        <video src="/static/images/creator/cropped/ethnie/caucasienne.mp4" class="image-option-thumb" autoplay muted loop playsinline></video>
                                        <span class="image-option-label">Caucasienne</span>
                                    </div>
                                    <div class="image-option" data-value="asiatique" onclick="selectImageOption(this, 'gridEthnicity')">
                                        <video src="/static/images/creator/cropped/ethnie/asiatique.mp4" class="image-option-thumb" autoplay muted loop playsinline></video>
                                        <span class="image-option-label">Asiatique</span>
                                    </div>
                                    <div class="image-option" data-value="africaine" onclick="selectImageOption(this, 'gridEthnicity')">
                                        <video src="/static/images/creator/cropped/ethnie/africaine.mp4" class="image-option-thumb" autoplay muted loop playsinline></video>
                                        <span class="image-option-label">Africaine</span>
                                    </div>
                                    <div class="image-option" data-value="latina" onclick="selectImageOption(this, 'gridEthnicity')">
                                        <video src="/static/images/creator/cropped/ethnie/latina.mp4" class="image-option-thumb" autoplay muted loop playsinline></video>
                                        <span class="image-option-label">Latina</span>
                                    </div>
                                    <div class="image-option" data-value="arabe" onclick="selectImageOption(this, 'gridEthnicity')">
                                        <img src="/static/images/creator/cropped/ethnie/arabe.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Arabe</span>
                                    </div>
                                    <div class="image-option" data-value="japonaise" onclick="selectImageOption(this, 'gridEthnicity')">
                                        <img src="/static/images/creator/cropped/ethnie/japonaise.png" class="image-option-thumb">
                                        <span class="image-option-label">Japonaise</span>
                                    </div>
                                    <div class="image-option" data-value="coreenne" onclick="selectImageOption(this, 'gridEthnicity')">
                                        <img src="/static/images/creator/cropped/ethnie/coreenne.png" class="image-option-thumb">
                                        <span class="image-option-label">Coreenne</span>
                                    </div>
                                    <div class="image-option" data-value="bresilienne" onclick="selectImageOption(this, 'gridEthnicity')">
                                        <img src="/static/images/creator/cropped/ethnie/bresilienne.png" class="image-option-thumb">
                                        <span class="image-option-label">Bresilienne</span>
                                    </div>
                                    <div class="image-option" data-value="metisse" onclick="selectImageOption(this, 'gridEthnicity')">
                                        <img src="/static/images/creator/cropped/ethnie/metisse.png" class="image-option-thumb">
                                        <span class="image-option-label">Metisse</span>
                                    </div>
                                    <div class="image-option" data-value="russe" onclick="selectImageOption(this, 'gridEthnicity')">
                                        <img src="/static/images/creator/cropped/ethnie/russe.png" class="image-option-thumb">
                                        <span class="image-option-label">Russe</span>
                                    </div>
                                    <div class="image-option" data-value="scandinave" onclick="selectImageOption(this, 'gridEthnicity')">
                                        <img src="/static/images/creator/cropped/ethnie/scandinave.png" class="image-option-thumb">
                                        <span class="image-option-label">Scandinave</span>
                                    </div>
                                    <div class="image-option" data-value="europeenne" onclick="selectImageOption(this, 'gridEthnicity')">
                                        <img src="/static/images/creator/cropped/ethnie/europeenne.png" class="image-option-thumb">
                                        <span class="image-option-label">Europeenne</span>
                                    </div>
                                    <div class="image-option" data-value="cubaine" onclick="selectImageOption(this, 'gridEthnicity')">
                                        <img src="/static/images/creator/cropped/ethnie/cubaine.png" class="image-option-thumb">
                                        <span class="image-option-label">Cubaine</span>
                                    </div>
                                    <div class="image-option" data-value="mexicaine" onclick="selectImageOption(this, 'gridEthnicity')">
                                        <img src="/static/images/creator/cropped/ethnie/mexicaine.png" class="image-option-thumb">
                                        <span class="image-option-label">Mexicaine</span>
                                    </div>
                                </div>
                            </div>
                            <div class="creator-section">
                                <label>Age</label>
                                <div class="age-slider-container" id="ageSliderContainer">
                                    <input type="range" class="age-slider" id="ageSlider" min="18" max="55" value="25" oninput="updateAgeDisplay(this.value)">
                                    <div class="age-display">
                                        <span class="age-value" id="ageValue">25</span>
                                        <span class="age-label">ans</span>
                                    </div>
                                    <div class="age-range-labels">
                                        <span>18 ans</span>
                                        <span>55+ ans</span>
                                    </div>
                                </div>
                            </div>
                            <div class="creator-section">
                                <label>Morphologie</label>
                                <div class="image-grid cols-4" id="gridBody">
                                    <div class="image-option selected" data-value="mince" onclick="selectImageOption(this, 'gridBody')">
                                        <img src="/static/images/creator/cropped/body/mince.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Mince</span>
                                    </div>
                                    <div class="image-option" data-value="athletique" onclick="selectImageOption(this, 'gridBody')">
                                        <img src="/static/images/creator/cropped/body/athletique.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Athletique</span>
                                    </div>
                                    <div class="image-option" data-value="normale" onclick="selectImageOption(this, 'gridBody')">
                                        <img src="/static/images/creator/cropped/body/normale.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Normale</span>
                                    </div>
                                    <div class="image-option" data-value="ronde" onclick="selectImageOption(this, 'gridBody')">
                                        <img src="/static/images/creator/cropped/body/ronde.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Ronde</span>
                                    </div>
                                    <div class="image-option" data-value="pulpeuse" onclick="selectImageOption(this, 'gridBody')">
                                        <img src="/static/images/creator/cropped/body/pulpeuse.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Pulpeuse</span>
                                    </div>
                                    <div class="image-option" data-value="musclee" onclick="selectImageOption(this, 'gridBody')">
                                        <img src="/static/images/creator/cropped/body/musclee.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Musclee</span>
                                    </div>
                                </div>
                            </div>
                            <div class="creator-section">
                                <label>Poitrine</label>
                                <div class="image-grid cols-2" id="gridBreasts">
                                    <div class="image-option" data-value="petite_ab" onclick="selectImageOption(this, 'gridBreasts')">
                                        <video src="/static/images/creator/cropped/poitrine/petite_ab.mp4" class="image-option-thumb" autoplay muted loop playsinline></video>
                                        <span class="image-option-label">Petite (A-B)</span>
                                    </div>
                                    <div class="image-option selected" data-value="moyenne_c" onclick="selectImageOption(this, 'gridBreasts')">
                                        <video src="/static/images/creator/cropped/poitrine/moyenne_c.mp4" class="image-option-thumb" autoplay muted loop playsinline></video>
                                        <span class="image-option-label">Moyenne (C)</span>
                                    </div>
                                    <div class="image-option" data-value="grande_d" onclick="selectImageOption(this, 'gridBreasts')">
                                        <video src="/static/images/creator/cropped/poitrine/grande_d.mp4" class="image-option-thumb" autoplay muted loop playsinline></video>
                                        <span class="image-option-label">Grande (D)</span>
                                    </div>
                                    <div class="image-option" data-value="extra_large_ef" onclick="selectImageOption(this, 'gridBreasts')">
                                        <video src="/static/images/creator/cropped/poitrine/extra_large_ef.mp4" class="image-option-thumb" autoplay muted loop playsinline></video>
                                        <span class="image-option-label">Extra Large (E-F)</span>
                                    </div>
                                </div>
                            </div>
                            <div class="creator-section">
                                <label>Fesses</label>
                                <div class="image-grid cols-3" id="gridButt">
                                    <div class="image-option" data-value="petite" onclick="selectImageOption(this, 'gridButt')">
                                        <img src="/static/images/creator/cropped/fesses/petite.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Petite</span>
                                    </div>
                                    <div class="image-option selected" data-value="moyenne" onclick="selectImageOption(this, 'gridButt')">
                                        <img src="/static/images/creator/cropped/fesses/moyenne.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Moyenne</span>
                                    </div>
                                    <div class="image-option" data-value="ronde" onclick="selectImageOption(this, 'gridButt')">
                                        <img src="/static/images/creator/cropped/fesses/ronde.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Ronde</span>
                                    </div>
                                    <div class="image-option" data-value="athletique" onclick="selectImageOption(this, 'gridButt')">
                                        <img src="/static/images/creator/cropped/fesses/athletique.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Athletique</span>
                                    </div>
                                    <div class="image-option" data-value="pulpeuse" onclick="selectImageOption(this, 'gridButt')">
                                        <img src="/static/images/creator/cropped/fesses/pulpeuse.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Pulpeuse</span>
                                    </div>
                                    <div class="image-option" data-value="xxl" onclick="selectImageOption(this, 'gridButt')">
                                        <img src="/static/images/creator/cropped/fesses/xxl.jpg" class="image-option-thumb">
                                        <span class="image-option-label">XXL</span>
                                    </div>
                                </div>
                            </div>
                            <div class="creator-section">
                                <label>Couleur de cheveux</label>
                                <div class="image-grid cols-4" id="gridHairColor">
                                    <div class="image-option" data-value="blonde_platine" onclick="selectImageOption(this, 'gridHairColor')">
                                        <img src="/static/images/creator/cropped/hair_color/blonde_platine.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Blonde platine</span>
                                    </div>
                                    <div class="image-option selected" data-value="blonde_doree" onclick="selectImageOption(this, 'gridHairColor')">
                                        <img src="/static/images/creator/cropped/hair_color/blonde_doree.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Blonde doree</span>
                                    </div>
                                    <div class="image-option" data-value="brune" onclick="selectImageOption(this, 'gridHairColor')">
                                        <img src="/static/images/creator/cropped/hair_color/brune.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Brune</span>
                                    </div>
                                    <div class="image-option" data-value="noire" onclick="selectImageOption(this, 'gridHairColor')">
                                        <img src="/static/images/creator/cropped/hair_color/noire.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Noire</span>
                                    </div>
                                    <div class="image-option" data-value="chatain" onclick="selectImageOption(this, 'gridHairColor')">
                                        <img src="/static/images/creator/cropped/hair_color/chatain.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Chatain</span>
                                    </div>
                                    <div class="image-option" data-value="rousse" onclick="selectImageOption(this, 'gridHairColor')">
                                        <img src="/static/images/creator/cropped/hair_color/rousse.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Rousse</span>
                                    </div>
                                    <div class="image-option" data-value="rose" onclick="selectImageOption(this, 'gridHairColor')">
                                        <img src="/static/images/creator/cropped/hair_color/rose.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Rose</span>
                                    </div>
                                    <div class="image-option" data-value="bleue" onclick="selectImageOption(this, 'gridHairColor')">
                                        <img src="/static/images/creator/cropped/hair_color/bleue.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Bleue</span>
                                    </div>
                                    <div class="image-option" data-value="grise_silver" onclick="selectImageOption(this, 'gridHairColor')">
                                        <img src="/static/images/creator/cropped/hair_color/grise_silver.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Grise silver</span>
                                    </div>
                                </div>
                            </div>
                            <div class="creator-section">
                                <label>Style de cheveux</label>
                                <div class="image-grid cols-4" id="gridHairStyle">
                                    <div class="image-option selected" data-value="lisse" onclick="selectImageOption(this, 'gridHairStyle')">
                                        <video src="/static/images/creator/cropped/cheveux/lisse.mp4" class="image-option-thumb" autoplay muted loop playsinline></video>
                                        <span class="image-option-label">Longs lisses</span>
                                    </div>
                                    <div class="image-option" data-value="boucle" onclick="selectImageOption(this, 'gridHairStyle')">
                                        <video src="/static/images/creator/cropped/cheveux/boucle.mp4" class="image-option-thumb" autoplay muted loop playsinline></video>
                                        <span class="image-option-label">Boucles</span>
                                    </div>
                                    <div class="image-option" data-value="court" onclick="selectImageOption(this, 'gridHairStyle')">
                                        <video src="/static/images/creator/cropped/cheveux/court.mp4" class="image-option-thumb" autoplay muted loop playsinline></video>
                                        <span class="image-option-label">Court</span>
                                    </div>
                                    <div class="image-option" data-value="attache" onclick="selectImageOption(this, 'gridHairStyle')">
                                        <video src="/static/images/creator/cropped/cheveux/attache.mp4" class="image-option-thumb" autoplay muted loop playsinline></video>
                                        <span class="image-option-label">Attache</span>
                                    </div>
                                    <div class="image-option" data-value="chignon" onclick="selectImageOption(this, 'gridHairStyle')">
                                        <video src="/static/images/creator/cropped/cheveux/chignon.mp4" class="image-option-thumb" autoplay muted loop playsinline></video>
                                        <span class="image-option-label">Chignon</span>
                                    </div>
                                    <div class="image-option" data-value="frange" onclick="selectImageOption(this, 'gridHairStyle')">
                                        <video src="/static/images/creator/cropped/cheveux/frange.mp4" class="image-option-thumb" autoplay muted loop playsinline></video>
                                        <span class="image-option-label">Frange</span>
                                    </div>
                                </div>
                            </div>
                            <div class="creator-section">
                                <label>Yeux</label>
                                <div class="image-grid cols-4" id="gridEyes">
                                    <div class="image-option" data-value="bleu" onclick="selectImageOption(this, 'gridEyes')">
                                        <img src="/static/images/creator/cropped/yeux/bleu.png" class="image-option-thumb">
                                        <span class="image-option-label">Bleus</span>
                                    </div>
                                    <div class="image-option" data-value="vert" onclick="selectImageOption(this, 'gridEyes')">
                                        <img src="/static/images/creator/cropped/yeux/vert.png" class="image-option-thumb">
                                        <span class="image-option-label">Verts</span>
                                    </div>
                                    <div class="image-option selected" data-value="marron" onclick="selectImageOption(this, 'gridEyes')">
                                        <img src="/static/images/creator/cropped/yeux/marron.png" class="image-option-thumb">
                                        <span class="image-option-label">Marrons</span>
                                    </div>
                                    <div class="image-option" data-value="noisette" onclick="selectImageOption(this, 'gridEyes')">
                                        <img src="/static/images/creator/cropped/yeux/noisette.png" class="image-option-thumb">
                                        <span class="image-option-label">Noisette</span>
                                    </div>
                                    <div class="image-option" data-value="ambre" onclick="selectImageOption(this, 'gridEyes')">
                                        <img src="/static/images/creator/cropped/yeux/ambre.png" class="image-option-thumb">
                                        <span class="image-option-label">Ambre</span>
                                    </div>
                                </div>
                            </div>
                            <div class="creator-section">
                                <label>Style vestimentaire</label>
                                <div class="image-grid" id="gridStyle">
                                    <div class="image-option selected" data-value="casual" onclick="selectImageOption(this, 'gridStyle')">
                                        <img src="/static/images/creator/cropped/vetements/jean.png" class="image-option-thumb">
                                        <span class="image-option-label">Decontractee</span>
                                    </div>
                                    <div class="image-option" data-value="elegant" onclick="selectImageOption(this, 'gridStyle')">
                                        <img src="/static/images/creator/cropped/vetements/robe_elegante.png" class="image-option-thumb">
                                        <span class="image-option-label">Elegante</span>
                                    </div>
                                    <div class="image-option" data-value="sporty" onclick="selectImageOption(this, 'gridStyle')">
                                        <img src="/static/images/creator/cropped/vetements/sport.png" class="image-option-thumb">
                                        <span class="image-option-label">Sportive</span>
                                    </div>
                                    <div class="image-option" data-value="bikini" onclick="selectImageOption(this, 'gridStyle')">
                                        <img src="/static/images/creator/cropped/vetements/bikini.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Bikini</span>
                                    </div>
                                    <div class="image-option" data-value="lingerie" onclick="selectImageOption(this, 'gridStyle')">
                                        <img src="/static/images/creator/cropped/vetements/lingerie.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Lingerie</span>
                                    </div>
                                    <div class="image-option" data-value="nuisette" onclick="selectImageOption(this, 'gridStyle')">
                                        <img src="/static/images/creator/cropped/vetements/nuisette.jpg" class="image-option-thumb">
                                        <span class="image-option-label">Nuisette</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- STEP 2: PERSONNAGE (Personality) -->
                    <div class="wizard-step hidden" id="stepPersonnage">
                        <!-- Sub-tabs -->
                        <div class="sub-tabs">
                            <div class="sub-tab active" data-subtab="personnalite">Personnalite</div>
                            <div class="sub-tab" data-subtab="relation">Relation</div>
                            <div class="sub-tab" data-subtab="profession">Profession</div>
                            <div class="sub-tab" data-subtab="kinks">Kinks</div>
                            <div class="sub-tab" data-subtab="voix">Voix</div>
                        </div>
                        
                        <!-- Personnalite subtab -->
                        <div class="subtab-content active" id="subtabPersonnalite">
                            <div class="creator-section">
                                <label>Type de personnalite</label>
                                <div class="chip-grid" id="chipPersonality">
                                    <div class="chip" data-value="shy">Timide</div>
                                    <div class="chip selected" data-value="playful">Coquine</div>
                                    <div class="chip" data-value="dominant">Dominante</div>
                                    <div class="chip" data-value="submissive">Soumise</div>
                                    <div class="chip" data-value="romantic">Romantique</div>
                                    <div class="chip" data-value="wild">Perverse</div>
                                    <div class="chip" data-value="innocent">Innocente</div>
                                    <div class="chip" data-value="mysterious">Mysterieuse</div>
                                </div>
                            </div>
                            <div class="creator-section">
                                <label>Caractere</label>
                                <div class="chip-grid multi" id="chipCharacter" data-max="3">
                                    <div class="chip" data-value="funny">Drole</div>
                                    <div class="chip" data-value="caring">Attentionnee</div>
                                    <div class="chip" data-value="adventurous">Aventuriere</div>
                                    <div class="chip" data-value="intellectual">Intellectuelle</div>
                                    <div class="chip" data-value="passionate">Passionnee</div>
                                    <div class="chip" data-value="jealous">Jalouse</div>
                                    <div class="chip" data-value="possessive">Possessive</div>
                                    <div class="chip" data-value="independent">Independante</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Relation subtab -->
                        <div class="subtab-content hidden" id="subtabRelation">
                            <div class="creator-section">
                                <label>Type de relation</label>
                                <div class="chip-grid" id="chipRelation">
                                    <div class="chip selected" data-value="girlfriend">Petite amie</div>
                                    <div class="chip" data-value="wife">Epouse</div>
                                    <div class="chip" data-value="mistress">Maitresse</div>
                                    <div class="chip" data-value="friend">Amie proche</div>
                                    <div class="chip" data-value="stranger">Inconnue</div>
                                    <div class="chip" data-value="ex">Ex-copine</div>
                                    <div class="chip" data-value="neighbor">Voisine</div>
                                    <div class="chip" data-value="colleague">Collegue</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Profession subtab -->
                        <div class="subtab-content hidden" id="subtabProfession">
                            <div class="creator-section">
                                <label>Sa profession</label>
                                <input type="text" class="creator-input search-input" placeholder="Rechercher..." id="searchProfession">
                                <div class="chip-grid scrollable" id="chipProfession">
                                    <div class="chip" data-value="coiffeuse">&#128135; Coiffeuse</div>
                                    <div class="chip" data-value="dentiste">&#129463; Dentiste</div>
                                    <div class="chip" data-value="chanteuse">&#127908; Chanteuse/Musicienne</div>
                                    <div class="chip" data-value="gynecologue">&#128105; Gynecologue</div>
                                    <div class="chip" data-value="ecrivaine">&#9997; Ecrivaine</div>
                                    <div class="chip" data-value="hotesse">&#9992; Hotesse de l'air</div>
                                    <div class="chip" data-value="athlete">&#127939; Athlete professionnelle</div>
                                    <div class="chip" data-value="scientifique">&#128300; Scientifique</div>
                                    <div class="chip" data-value="fleuriste">&#127800; Fleuriste</div>
                                    <div class="chip" data-value="maquilleuse">&#128132; Maquilleuse</div>
                                    <div class="chip" data-value="photographe">&#128247; Photographe</div>
                                    <div class="chip" data-value="travailleuse_sociale">&#129309; Travailleuse sociale</div>
                                    <div class="chip" data-value="designer">&#127912; Designer</div>
                                    <div class="chip" data-value="pharmacienne">&#128138; Pharmacienne</div>
                                    <div class="chip" data-value="nutritionniste">&#129361; Nutritionniste</div>
                                    <div class="chip" data-value="infirmiere">&#129658; Infirmiere</div>
                                    <div class="chip" data-value="professeure">&#128218; Professeure</div>
                                    <div class="chip" data-value="avocate">&#9878; Avocate</div>
                                    <div class="chip" data-value="mannequin">&#128131; Mannequin</div>
                                    <div class="chip" data-value="actrice">&#127916; Actrice</div>
                                    <div class="chip" data-value="danseuse">&#128131; Danseuse</div>
                                    <div class="chip" data-value="streameuse">&#127918; Streameuse</div>
                                    <div class="chip" data-value="dj">&#127926; DJ</div>
                                    <div class="chip" data-value="barista">&#9749; Barista</div>
                                </div>
                                <button class="show-more-btn" id="btnMoreProfessions">Afficher plus</button>
                            </div>
                        </div>
                        
                        <!-- Kinks subtab -->
                        <div class="subtab-content hidden" id="subtabKinks">
                            <div class="creator-section">
                                <label>Quels sont ses penchants sexuels (conventionnels ou non) ? (Max. 3)</label>
                                <input type="text" class="creator-input search-input" placeholder="Rechercher..." id="searchKinks">
                                <div class="chip-grid scrollable multi" id="chipKinks" data-max="3">
                                    <div class="chip" data-value="bondage">Bondage</div>
                                    <div class="chip" data-value="fessee">Fessee</div>
                                    <div class="chip" data-value="collier">Collier et laisse</div>
                                    <div class="chip" data-value="punition">Punition</div>
                                    <div class="chip" data-value="humiliation">Humiliation</div>
                                    <div class="chip" data-value="jeu_public">Jeu public</div>
                                    <div class="chip" data-value="jeu_role">Jeu de role</div>
                                    <div class="chip" data-value="jeu_anal">Jeu anal</div>
                                    <div class="chip" data-value="jeu_oral">Jeu oral</div>
                                    <div class="chip" data-value="cum_play">Cum Play</div>
                                    <div class="chip" data-value="creampie">Creampie</div>
                                    <div class="chip" data-value="ejac_feminine">Ejaculation feminine</div>
                                    <div class="chip" data-value="dirty_talk">Dirty Talk</div>
                                    <div class="chip" data-value="breeding">Breeding</div>
                                    <div class="chip" data-value="daddy_dom">Daddy Dominance</div>
                                    <div class="chip" data-value="edging">Edging</div>
                                    <div class="chip" data-value="obeissance">Obeissance</div>
                                    <div class="chip" data-value="controle">Controle</div>
                                    <div class="chip" data-value="inexperimentee">Inexperimentee</div>
                                    <div class="chip" data-value="flirt_timide">Flirt timide</div>
                                    <div class="chip" data-value="seduction">Jeu de seduction erotique</div>
                                    <div class="chip" data-value="calins">Calins</div>
                                    <div class="chip" data-value="lent_sensuel">Lent et sensuel</div>
                                    <div class="chip" data-value="cheveux">Arrachage de cheveux</div>
                                </div>
                                <button class="show-more-btn" id="btnMoreKinks">Afficher moins</button>
                            </div>
                        </div>
                        
                        <!-- Voix subtab -->
                        <div class="subtab-content hidden" id="subtabVoix">
                            <div class="creator-section">
                                <label>Choisis sa voix</label>
                                <div class="voice-grid" id="voiceGrid">
                                    <div class="voice-card selected" data-value="voix1">
                                        <div class="voice-icon">&#127926;</div>
                                        <div class="voice-name">Voix 1</div>
                                        <div class="voice-desc">Voix assuree</div>
                                    </div>
                                    <div class="voice-card" data-value="voix2">
                                        <div class="voice-icon">&#127926;</div>
                                        <div class="voice-name">Voix 2</div>
                                        <div class="voice-desc">Enjouee</div>
                                    </div>
                                    <div class="voice-card" data-value="voix3">
                                        <div class="voice-icon">&#127926;</div>
                                        <div class="voice-name">Voix 3</div>
                                        <div class="voice-desc">Dominatrice</div>
                                    </div>
                                    <div class="voice-card" data-value="voix4">
                                        <div class="voice-icon">&#127926;</div>
                                        <div class="voice-name">Voix 4</div>
                                        <div class="voice-desc">Innocente</div>
                                    </div>
                                    <div class="voice-card" data-value="voix5">
                                        <div class="voice-icon">&#127926;</div>
                                        <div class="voice-name">Voix 5</div>
                                        <div class="voice-desc">Voix douce</div>
                                    </div>
                                    <div class="voice-card" data-value="voix6">
                                        <div class="voice-icon">&#127926;</div>
                                        <div class="voice-name">Voix 6</div>
                                        <div class="voice-desc">Voix sensuelle</div>
                                    </div>
                                    <div class="voice-card" data-value="voix7">
                                        <div class="voice-icon">&#127926;</div>
                                        <div class="voice-name">Voix 7</div>
                                        <div class="voice-desc">Timide</div>
                                    </div>
                                    <div class="voice-card" data-value="voix8">
                                        <div class="voice-icon">&#127926;</div>
                                        <div class="voice-name">Voix 8</div>
                                        <div class="voice-desc">Mature</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- STEP 3: CREATION LOADING -->
                    <div class="wizard-step hidden" id="stepCreating">
                        <div class="creation-loader">
                            <div class="progress-ring">
                                <svg viewBox="0 0 120 120">
                                    <circle class="progress-bg" cx="60" cy="60" r="54"/>
                                    <circle class="progress-bar" cx="60" cy="60" r="54" id="creationProgress"/>
                                </svg>
                                <span class="progress-percent" id="creationPercent">0%</span>
                            </div>
                            <h2>Creation de votre IA</h2>
                            <p>Tenez bon. Cela ne prendra pas longtemps.</p>
                        </div>
                    </div>
                    
                    <!-- STEP 4: RESULT -->
                    <div class="wizard-step hidden" id="stepResult">
                        <div class="result-container">
                            <button class="result-close" onclick="resetCreator()">X</button>
                            <div class="result-image" id="resultImage"></div>
                            <div class="result-actions">
                                <button class="change-face-btn" onclick="regenerateFace()">
                                    &#128260; Changer de visage <span class="token-cost">1</span>
                                </button>
                                <div class="result-votes">
                                    <span class="vote-count">1</span>
                                    <button class="vote-btn dislike">&#128078;</button>
                                    <button class="vote-btn like">&#128077;</button>
                                </div>
                            </div>
                            <div class="result-info">
                                <h2 class="result-name" id="resultName">Betty Moore, 21</h2>
                                <div class="result-tags">
                                    <span class="result-tag" id="resultRelation">Epouse</span>
                                    <span class="result-audio">&#128266;</span>
                                </div>
                            </div>
                            <button class="give-life-btn" onclick="giveLifeToAI()">
                                DONNER VIE A MON IA <span class="token-cost">10</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- Navigation footer -->
                    <div class="wizard-footer">
                        <button class="wizard-back" id="wizardBack" onclick="wizardPrev()">
                            <span>&#8592;</span>
                        </button>
                        <button class="wizard-next" id="wizardNext" onclick="wizardNext()">
                            SUIVANT <span>&#8594;</span>
                        </button>
                    </div>
                </div>
            </section>

        </main>
        
        <!-- BOTTOM NAVIGATION (Candy AI Style) -->
        <nav class="bottom-nav" id="bottomNav">
            <div class="bottom-nav-item active" data-page="camgirls">
                <span class="nav-icon">&#127968;</span>
                <span class="nav-label">Accueil</span>
            </div>
            <div class="bottom-nav-item" data-page="discover">
                <span class="nav-icon">&#128270;</span>
                <span class="nav-label">Decouvrir</span>
            </div>
            <div class="bottom-nav-item" data-page="creator">
                <span class="nav-icon">&#10024;</span>
                <span class="nav-label">Creer</span>
            </div>
            <div class="bottom-nav-item" data-page="messages">
                <span class="nav-icon">&#128172;</span>
                <span class="nav-label">Discuter</span>
                <span class="nav-notif" id="bottomMsgBadge">3</span>
            </div>
            <div class="bottom-nav-item" data-page="tokens">
                <span class="nav-icon token-icon">&#11088;</span>
                <span class="nav-label">Jetons</span>
            </div>
        </nav>
    </div>

    <!-- CAMGIRL PROFILE OVERLAY - CANDY AI STYLE -->
    <div class="overlay" id="camgirlProfile">
        <div class="candy-profile">
            <!-- Header with back button and tabs -->
            <header class="candy-header">
                <button class="candy-back" onclick="closeProfile()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
                </button>
                <div class="candy-tabs">
                    <button class="candy-tab active" id="tabProfile" onclick="showProfileTab()">Profil</button>
                    <button class="candy-tab" id="tabGallery" onclick="showGalleryTab()">Galerie</button>
                </div>
                <button class="candy-chat-btn" onclick="openProfileChat()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg>
                </button>
            </header>
            
            <!-- Photo Carousel -->
            <div class="candy-carousel" id="profileMediaBg">
                <div class="carousel-container" id="profileCarouselContainer" onclick="openProfileDetail(currentGirl?.id)" style="cursor:pointer;"></div>
                <div class="candy-photo-gradient"></div>
                <div class="candy-name-overlay">
                    <img class="mini-avatar" id="profileMiniAvatar" src="" alt="">
                    <h2 id="profileNameOverlay">Nom, Age</h2>
                    <div class="online-badge">1</div>
                </div>
                <div class="candy-action-buttons">
                    <button class="candy-action-btn" onclick="openScenarioChat()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 6L6 18M6 6l12 12"/></svg>
                    </button>
                    <button class="candy-action-btn" onclick="toggleSound()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M11 5L6 9H2v6h4l5 4V5z"/><path d="M19.07 4.93a10 10 0 010 14.14M15.54 8.46a5 5 0 010 7.07"/></svg>
                    </button>
                    <button class="candy-action-btn" onclick="toggleChatVisibility()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                    </button>
                    <button class="candy-action-btn" onclick="showProfileMenu(event)">
                        <svg viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
                    </button>
                    <!-- Profile Menu Dropdown -->
                    <div class="profile-menu-dropdown" id="profileMenuDropdown">
                        <button class="chat-menu-item" onclick="addToFavorites(); closeProfileMenu();">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                            Ajouter aux favoris
                        </button>
                        <button class="chat-menu-item" onclick="resetChat(); closeProfileMenu();">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>
                            Reinitialiser le chat
                        </button>
                        <button class="chat-menu-item danger" onclick="deleteChat(); closeProfileMenu();">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                            Supprimer le chat
                        </button>
                        <button class="chat-menu-item" onclick="closeProfileMenu(); document.getElementById('memoryModalOverlay').classList.add('active'); if(typeof loadMemories==='function')loadMemories();">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                            Souvenir
                            <span class="menu-badge-new">New</span>
                        </button>
                        <button class="chat-menu-item watch-together-btn" onclick="closeProfileMenu(); openWatchTogether();">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/><polygon points="10 8 16 11 10 14 10 8" fill="currentColor"/></svg>
                            Regarder ensemble
                            <span class="menu-badge-new">New</span>
                        </button>
                    </div>
                </div>
                <button class="candy-arrow left" onclick="prevProfileSlide()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M15 18l-6-6 6-6"/></svg>
                </button>
                <button class="candy-arrow right" onclick="nextProfileSlide()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="M9 18l6-6-6-6"/></svg>
                </button>
                <div class="candy-dots" id="profileCarouselDots"></div>
                
                <!-- CHAT OVERLAY SUR LA PHOTO -->
                <div class="photo-chat-overlay" id="photoChatOverlay">
                    <div class="photo-messages" id="photoMessages"></div>
                    <div class="photo-chat-input-row">
                        <input type="text" class="photo-chat-input" id="photoChatInput" placeholder="Ecris un message..." onkeypress="if(event.key==='Enter')sendPhotoMessage()">
                        <button class="photo-send-btn" onclick="sendPhotoMessage()">&#10148;</button>
                    </div>
                </div>
                
            </div>
            
            <!-- Profile Info Section -->
            <div class="candy-info" id="profileInfoSection">
                <div class="candy-name-row">
                    <h1 class="candy-name" id="profileName">Emilia, 22</h1>
                    <button class="candy-fav" onclick="toggleFavorite()">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                    </button>
                </div>
                <p class="candy-bio" id="profileBio">Description de la fille...</p>
                
                <div class="candy-actions">
                    <button class="candy-action primary" onclick="startAudioCall()">Appelle-moi</button>
                    <button class="candy-action secondary" onclick="openGeneratePopup()">Generer</button>
                </div>
                <button class="candy-private" onclick="showPrivateContent()">Mon Contenu Prive</button>
                
                <div class="candy-about">
                    <h3>A propos de moi:</h3>
                    <div class="candy-stats" id="profileStats">
                        <div class="candy-stat"><span class="stat-icon">ðŸŽ‚</span><span class="stat-label">AGE</span><span class="stat-value" id="statAge">22</span></div>
                        <div class="candy-stat"><span class="stat-icon">ðŸ‘¤</span><span class="stat-label">CORPS</span><span class="stat-value" id="statBody">Mince</span></div>
                        <div class="candy-stat"><span class="stat-icon">ðŸŒ</span><span class="stat-label">ORIGINE</span><span class="stat-value" id="statOrigin">France</span></div>
                        <div class="candy-stat"><span class="stat-icon">ðŸ’¬</span><span class="stat-label">LANGUE</span><span class="stat-value">Francais</span></div>
                        <div class="candy-stat"><span class="stat-icon">ðŸ’•</span><span class="stat-label">RELATION</span><span class="stat-value" id="statRelation">Celibataire</span></div>
                        <div class="candy-stat"><span class="stat-icon">ðŸ’¼</span><span class="stat-label">PROFESSION</span><span class="stat-value" id="statProfession">Etudiante</span></div>
                    </div>
                </div>
                
                <div class="candy-tags" id="profileTags"></div>
                
                <!-- ACTION EN DIRECT BUTTON (Candy AI Style) -->
                <button class="action-direct-btn" onclick="openActionPanel()">
                    <span class="action-direct-icon">&#127918;</span>
                    <span class="action-direct-text">Action en Direct</span>
                    <span class="action-direct-badge">Beta v2</span>
                </button>
                
                <!-- ACTION EN DIRECT PANEL (Candy AI Style) -->
                <div class="action-direct-panel" id="actionDirectPanel">
                    <div class="adp-header">
                        <button class="adp-close" onclick="closeActionPanel()">&#10005;</button>
                        <span class="adp-title">Action en Direct</span>
                        <span class="adp-badge">Beta v2</span>
                    </div>
                    
                    <div class="adp-level-section">
                        <div class="adp-level-circle" id="xpLevelBadge">1</div>
                        <div class="adp-level-info">
                            <div class="adp-level-label">Niveau <span id="xpCurrentLevel">1</span></div>
                            <div class="adp-level-status" id="xpLevelStatus">NIVEAU 2 DEVERROUILLE !</div>
                            <div class="adp-xp-bar">
                                <div class="adp-xp-fill" id="xpProgressFill" style="width:0%"></div>
                            </div>
                            <div class="adp-xp-text"><span id="xpCurrentXP">0</span> / <span id="xpMaxXP">35</span> XP Niveau <span id="xpTargetLevel">2</span></div>
                        </div>
                    </div>
                    
                    <div class="adp-current-action">
                        <div class="adp-action-card">
                            <span class="adp-action-icon">&#128293;</span>
                            <span class="adp-action-text" id="currentActionText">Je te chauffe en douceur</span>
                            <button class="adp-action-btn" onclick="executeCurrentAction()">
                                <span>&#9658;</span> Demander
                            </button>
                        </div>
                    </div>
                    
                    <div class="adp-more-actions" id="moreActionsSection">
                        <div class="adp-more-header" onclick="toggleMoreActions()">
                            <span class="adp-hot-icon">&#127798;</span>
                            <span class="adp-more-count" id="moreActionsCount">+9 Actions hot</span>
                            <span class="adp-expand-arrow" id="expandArrow">&#9660;</span>
                        </div>
                        <div class="adp-actions-list" id="xpRequestsList">
                            <!-- Actions populated by JS -->
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Gallery Section (hidden by default) -->
            <div class="candy-gallery" id="profileGallerySection" style="display:none;">
                <div class="gallery-grid" id="profilePhotos"></div>
                <div class="gallery-grid" id="profileVideos"></div>
            </div>
        </div>
    </div>

    <!-- VUE SCENARIO CHAT -->
    <div class="scenario-chat-view" id="scenarioChatView">
        <div class="scenario-header">
            <div class="scenario-back" onclick="goToHome()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
            </div>
            <img class="scenario-avatar" id="scenarioAvatar" src="" alt="" onclick="openCamgirlProfileFromScenario()" style="cursor:pointer;">
            <span class="scenario-name" id="scenarioName">Lola</span>
            <div class="scenario-header-actions">
                <button class="scenario-action-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/></svg>
                </button>
                <button class="scenario-action-icon scenario-call" onclick="startLiveCall()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M6.62 10.79c1.44 2.83 3.76 5.14 6.59 6.59l2.2-2.2c.27-.27.67-.36 1.02-.24 1.12.37 2.33.57 3.57.57.55 0 1 .45 1 1V20c0 .55-.45 1-1 1-9.39 0-17-7.61-17-17 0-.55.45-1 1-1h3.5c.55 0 1 .45 1 1 0 1.25.2 2.45.57 3.57.11.35.03.74-.25 1.02l-2.2 2.2z"/></svg>
                </button>
                <button class="scenario-action-icon" onclick="toggleChatMenu(event)">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
                </button>
                <!-- Chat Menu Dropdown -->
                <div class="chat-menu-dropdown" id="chatMenuDropdown">
                    <button class="chat-menu-item" onclick="addToFavorites()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                        Ajouter aux favoris
                    </button>
                    <button class="chat-menu-item" onclick="resetChat()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 4v6h-6M1 20v-6h6"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                        Reinitialiser le chat
                    </button>
                    <button class="chat-menu-item danger" onclick="deleteChat()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                        Supprimer le chat
                    </button>
                    <button class="chat-menu-item" onclick="openSouvenirFromChat()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                        Souvenir
                        <span class="menu-badge-new">New</span>
                    </button>
                    <button class="chat-menu-item watch-together-btn" onclick="closeChatMenu(); openWatchTogether();">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="3" width="20" height="14" rx="2" ry="2"/><line x1="8" y1="21" x2="16" y2="21"/><line x1="12" y1="17" x2="12" y2="21"/><polygon points="10 8 16 11 10 14 10 8" fill="currentColor"/></svg>
                        Regarder ensemble
                        <span class="menu-badge-new">New</span>
                    </button>
                    <button class="chat-menu-item" onclick="closeChatMenu(); openPovMode();">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/></svg>
                        Mode POV
                        <span class="menu-badge-new">Hot</span>
                    </button>
                    <button class="chat-menu-item" onclick="closeChatMenu(); openActionDirect();">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
                        Action en Direct
                        <span class="menu-badge-new">XP</span>
                    </button>
                </div>
            </div>
        </div>
        
        <div class="scenario-warning">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg>
            <span>Avertissement - Chat Securise</span>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5z"/></svg>
        </div>
        
        <div class="scenario-content" id="scenarioContent">
            <div class="scenario-video-container" id="scenarioVideoContainer">
                <video class="scenario-video" id="scenarioVideo" poster="" loop muted playsinline>
                    <source src="" type="video/mp4">
                </video>
                <div class="scenario-video-overlay">
                    <button class="scenario-play-btn" onclick="toggleScenarioVideo()">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="white"><path d="M8 5v14l11-7z"/></svg>
                    </button>
                </div>
                <div class="scenario-video-controls">
                    <button class="scenario-video-sound" onclick="toggleScenarioSound()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02z"/></svg>
                    </button>
                    <button class="scenario-video-fullscreen" onclick="toggleScenarioFullscreen()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg>
                    </button>
                    <button class="scenario-video-menu">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="white"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>
                    </button>
                </div>
                <div class="scenario-video-progress">
                    <div class="scenario-progress-bar" id="scenarioProgressBar"></div>
                </div>
            </div>
            
            <div class="scenario-messages" id="scenarioMessages">
                <div class="scenario-message girl">
                    <img class="scenario-avatar" id="scenarioMsgAvatar" src="" alt="">
                    <p id="scenarioFirstMessage">Hey toi... T'as ce regard qui m'excite... Tu es curieux ? Ou tu fais juste semblant de pas me mater ?</p>
                </div>
                <div class="scenario-timestamp">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67V7z"/></svg>
                    <span id="scenarioTime">En ligne</span>
                </div>
            </div>
        </div>
        
        <div class="scenario-input-bar">
            <input type="text" class="scenario-input" id="scenarioInput" placeholder="Message" onkeypress="if(event.key==='Enter')sendScenarioMessage()">
            <button class="scenario-send-btn" id="scenarioSendBtn">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
            </button>
            <button class="scenario-actions-btn" onclick="toggleScenarioActions()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                <span>Actions</span>
                <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M7 10l5 5 5-5z"/></svg>
            </button>
        </div>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var btn = document.getElementById('scenarioSendBtn');
        if (btn) {
            btn.addEventListener('click', function() {
                var inp = document.getElementById('scenarioInput');
                var msg = inp ? inp.value.trim() : '';
                if (!msg) return;
                var cont = document.getElementById('scenarioMessages');
                var div = document.createElement('div');
                div.className = 'scenario-message user';
                div.innerHTML = '<p>' + msg + '</p>';
                cont.appendChild(div);
                inp.value = '';
                cont.scrollTop = cont.scrollHeight;
                var typing = document.createElement('div');
                typing.className = 'scenario-message girl typing';
                var avatar = window.currentGirlPhoto || '';
                typing.innerHTML = '<img class="scenario-avatar" src="' + avatar + '" alt=""><p>...</p>';
                cont.appendChild(typing);
                var girlId = window.currentGirlId || 1;
                // Save user message to normal chat history
                fetch('/api/chat/' + girlId, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ sender: 'user', content: msg })
                }).catch(function(e) { console.log('[Sync] Error saving user msg:', e); });
                
                fetch('/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ girl_id: girlId, messages: [{ role: 'user', content: msg }], affection: 80, scenario_mode: true })
                })
                .then(function(r) { return r.json(); })
                .then(function(d) {
                    typing.remove();
                    if (d.reply) {
                        var g = document.createElement('div');
                        g.className = 'scenario-message girl';
                        g.innerHTML = '<img class="scenario-avatar" src="' + avatar + '" alt=""><p>' + d.reply + '</p>';
                        cont.appendChild(g);
                        cont.scrollTop = cont.scrollHeight;
                        
                        // Save girl reply to normal chat history
                        fetch('/api/chat/' + girlId, {
                            method: 'POST',
                            headers: {'Content-Type': 'application/json'},
                            body: JSON.stringify({ sender: 'girl', content: d.reply })
                        }).catch(function(e) { console.log('[Sync] Error saving reply:', e); });
                        
                        // Add XP for scenario chat
                        var xpGain = 3 + Math.floor(Math.random() * 3);
                        if (typeof window.showXpPopupCandy === 'function') {
                            window.showXpPopupCandy(xpGain);
                        }
                        if (girlId) {
                            fetch('/api/action/add-xp', {
                                method: 'POST',
                                headers: {'Content-Type': 'application/json'},
                                body: JSON.stringify({ girl_id: girlId, type: 'message' })
                            }).then(function(r) { return r.json(); }).then(function(xpData) {
                                if (xpData.success && typeof window.updateXpBubbleCandy === 'function') {
                                    window.updateXpBubbleCandy(xpData.level, xpData.xp_in_level, xpData.xp_for_next);
                                }
                            }).catch(function(e) { console.log('[XP] Error:', e); });
                        }
                    }
                })
                .catch(function() { typing.remove(); });
            });
        }
    });
    </script>

    <!-- CHAT OVERLAY -->
    <div class="chat-panel" id="chatPanel">
        <div class="chat-header">
            <div class="chat-user-info" onclick="openGirlProfile()">
                <div class="chat-avatar" id="chatAvatar">Y</div>
                <div class="chat-user-details">
                    <h3 id="chatUserName">Yuki</h3>
                    <span class="online-status"><span class="status-dot"></span> En ligne</span>
                </div>
            </div>
            <div class="chat-tokens" onclick="showBuyTokens()">
                <span id="chatTokens">500</span> tokens
            </div>
            <button class="close-chat" onclick="closeChat()">Ã—</button>
        </div>
        <div class="chat-messages" id="chatMessages"></div>
        <div class="chat-quick-actions" id="quickActions">
            <button class="quick-btn" onclick="requestQuickPhoto()">ðŸ“¸ Photo</button>
            <button class="quick-btn" onclick="requestQuickVideo()">ðŸŽ¬ Video</button>
            <button class="quick-btn" onclick="sendCoquinMessage()">ðŸ’‹ Coquin</button>
        </div>
        <div class="fantasy-actions" id="fantasyActions">
            <button class="fantasy-btn primary" id="fantasyActivateBtn" onclick="activateFantasyMode()">ðŸ”¥ Donne-moi ton fantasme</button>
            <button class="fantasy-btn" onclick="showMeAction()">ðŸ‘€ Montre-moi...</button>
            <button class="fantasy-btn" onclick="sendMeAction()">ðŸ“· Envoie-moi...</button>
        </div>
        <div class="fantasy-mode-bar" id="fantasyModeBar" style="display:none;">
            <div class="fantasy-status">
                <span class="fantasy-icon">ðŸ”¥</span>
                <span class="fantasy-text">Mode Fantasme actif</span>
            </div>
            <div class="fantasy-level" id="fantasyLevel" onclick="showFantasyLevelPicker()">Niveau 1</div>
            <button class="fantasy-stop" onclick="stopFantasyMode()">Arreter</button>
        </div>
        <div class="chat-input-area">
            <button class="games-btn" onclick="showGamesPopup()">ðŸŽ²</button>
            <input type="text" class="chat-input" id="chatInput" placeholder="Ecris un message...">
            <button class="mic-btn" onclick="startVoice()">ðŸŽ¤</button>
            <button class="send-btn" onclick="sendMessage()">âž¤</button>
        </div>
    </div>

    <!-- GAMES POPUP -->
    <div class="popup games-popup" id="gamesPopup">
        <div class="popup-content games-content">
            <button class="popup-close" onclick="closeGamesPopup()">Ã—</button>
            <h2>Jeux Coquins</h2>
            <p class="games-subtitle">Choisis un jeu a jouer avec elle</p>
            
            <div class="games-grid">
                <div class="game-card" onclick="startGame('strip')">
                    <div class="game-icon">ðŸƒ</div>
                    <div class="game-name">Strip Poker</div>
                    <div class="game-desc">Gagne et elle enleve un vetement</div>
                </div>
                <div class="game-card" onclick="startGame('dice')">
                    <div class="game-icon">ðŸŽ²</div>
                    <div class="game-name">Des Coquins</div>
                    <div class="game-desc">Lance les des pour une action</div>
                </div>
                <div class="game-card" onclick="startGame('truth')">
                    <div class="game-icon">â“</div>
                    <div class="game-name">Action ou Verite</div>
                    <div class="game-desc">Ose repondre ou agir</div>
                </div>
                <div class="game-card" onclick="startGame('bottle')">
                    <div class="game-icon">ðŸ¾</div>
                    <div class="game-name">La Bouteille</div>
                    <div class="game-desc">Fais tourner et vois ce qui arrive</div>
                </div>
                <div class="game-card" onclick="startGame('massage')">
                    <div class="game-icon">ðŸ’†</div>
                    <div class="game-name">Massage Sensuel</div>
                    <div class="game-desc">Guide ses mains sur ton corps</div>
                </div>
                <div class="game-card" onclick="startGame('ice')">
                    <div class="game-icon">ðŸ§Š</div>
                    <div class="game-name">Jeu des Glacons</div>
                    <div class="game-desc">Sensations froides et chaudes</div>
                </div>
            </div>
        </div>
    </div>

    <!-- GAME ACTIVE OVERLAY -->
    <div class="game-overlay" id="gameOverlay">
        <div class="game-header">
            <span class="game-title" id="gameTitle">Strip Poker</span>
            <button class="game-close" onclick="endGame()">Ã—</button>
        </div>
        <div class="game-area" id="gameArea"></div>
        <div class="game-controls" id="gameControls"></div>
    </div>

    <!-- STORY VIEWER -->
    <div class="overlay story-viewer" id="storyViewer">
        <div class="story-content" id="storyContent"></div>
        <div class="story-progress" id="storyProgress"></div>
        <button class="story-close" onclick="closeStory()">Ã—</button>
        <div class="story-nav">
            <div class="story-prev" onclick="prevStory()"></div>
            <div class="story-next" onclick="nextStory()"></div>
        </div>
    </div>

    <!-- BUY TOKENS POPUP -->
    <div class="popup" id="buyTokensPopup">
        <div class="popup-content">
            <button class="popup-close" onclick="closeBuyTokens()">Ã—</button>
            <h2>Acheter des Tokens</h2>
            <div class="token-packages">
                <div class="token-package" onclick="buyTokens(100)">
                    <span class="package-tokens">100 ðŸª™</span>
                    <span class="package-price">4.99â‚¬</span>
                </div>
                <div class="token-package popular" onclick="buyTokens(500)">
                    <span class="package-badge">Populaire</span>
                    <span class="package-tokens">500 ðŸª™</span>
                    <span class="package-price">19.99â‚¬</span>
                </div>
                <div class="token-package" onclick="buyTokens(1000)">
                    <span class="package-tokens">1000 ðŸª™</span>
                    <span class="package-price">34.99â‚¬</span>
                </div>
                <div class="token-package" onclick="buyTokens(5000)">
                    <span class="package-badge">Meilleure offre</span>
                    <span class="package-tokens">5000 ðŸª™</span>
                    <span class="package-price">99.99â‚¬</span>
                </div>
            </div>
        </div>
    </div>

    <!-- GENERATE PHOTO POPUP -->
    <div class="popup" id="generatePhotoPopup">
        <div class="popup-content generate-popup">
            <button class="popup-close" onclick="closeGeneratePopup()">X</button>
            <h2>Generer une photo</h2>
            <p class="generate-cost">20 tokens par photo</p>
            
            <div class="generate-preview" id="generatePreview">
                <img id="generatePreviewImg" src="" alt="Preview">
            </div>
            
            <div class="generate-tabs">
                <button class="gen-tab active" data-tab="outfit" onclick="showGenTab('outfit')">Tenue</button>
                <button class="gen-tab" data-tab="scene" onclick="showGenTab('scene')">Lieu</button>
                <button class="gen-tab" data-tab="pose" onclick="showGenTab('pose')">Position</button>
            </div>
            
            <div class="gen-options" id="genOutfit">
                <div class="gen-option selected" data-value="lingerie">Lingerie</div>
                <div class="gen-option" data-value="bikini">Bikini</div>
                <div class="gen-option" data-value="nue">Nue</div>
                <div class="gen-option" data-value="robe">Robe sexy</div>
                <div class="gen-option" data-value="uniforme">Uniforme</div>
                <div class="gen-option" data-value="cuir">Cuir/Latex</div>
                <div class="gen-option" data-value="sport">Tenue sport</div>
                <div class="gen-option" data-value="transparente">Transparente</div>
            </div>
            
            <div class="gen-options" id="genScene" style="display:none;">
                <div class="gen-option selected" data-value="chambre">Chambre</div>
                <div class="gen-option" data-value="plage">Plage</div>
                <div class="gen-option" data-value="piscine">Piscine</div>
                <div class="gen-option" data-value="douche">Douche</div>
                <div class="gen-option" data-value="jacuzzi">Jacuzzi</div>
                <div class="gen-option" data-value="exterieur">Exterieur</div>
                <div class="gen-option" data-value="bureau">Bureau</div>
                <div class="gen-option" data-value="studio">Studio photo</div>
            </div>
            
            <div class="gen-options" id="genPose" style="display:none;">
                <div class="gen-option selected" data-value="debout">Debout</div>
                <div class="gen-option" data-value="assise">Assise</div>
                <div class="gen-option" data-value="allongee">Allongee</div>
                <div class="gen-option" data-value="genoux">A genoux</div>
                <div class="gen-option" data-value="quatre_pattes">A quatre pattes</div>
                <div class="gen-option" data-value="de_dos">De dos</div>
            </div>
            
            <button class="generate-submit-btn" onclick="submitGeneratePhoto()">
                Generer <span class="gen-cost">20 tokens</span>
            </button>
        </div>
    </div>

    <!-- SWIPE OVERLAY (Tinder-style) -->
    <div class="swipe-overlay" id="swipeOverlay">
        <div class="swipe-header">
            <button class="swipe-close-btn" onclick="closeSwipeMode()">X</button>
            <h2>Mode Swipe</h2>
            <div class="swipe-filters">
                <select id="swipeAgeFilter" onchange="applySwipeFilters()">
                    <option value="all">Tous ages</option>
                    <option value="18-25">18-25 ans</option>
                    <option value="25-35">25-35 ans</option>
                    <option value="35-45">35-45 ans</option>
                    <option value="45+">45+ ans</option>
                </select>
            </div>
        </div>
        <div class="swipe-cards" id="swipeCards">
            <!-- Swipe cards will be injected here -->
        </div>
        <div class="swipe-actions">
            <button class="swipe-btn pass" onclick="swipePass()">
                <span>X</span>
            </button>
            <button class="swipe-btn superlike" onclick="swipeSuperlike()">
                <span>&#9733;</span>
            </button>
            <button class="swipe-btn like" onclick="swipeLike()">
                <span>&#9829;</span>
            </button>
        </div>
        <div class="swipe-instructions">
            <span>&#8592; Passer</span>
            <span>&#8593; Super Like</span>
            <span>Liker &#8594;</span>
        </div>
    </div>

    <!-- MATCH POPUP -->
    <div class="popup match-popup" id="matchPopup">
        <div class="match-content">
            <h1>C'est un Match!</h1>
            <div class="match-avatars">
                <div class="match-avatar" id="matchAvatar1"></div>
                <div class="match-heart">â¤ï¸</div>
                <div class="match-avatar" id="matchAvatar2"></div>
            </div>
            <p id="matchText">Tu as matche avec Yuki!</p>
            <div class="match-actions">
                <button class="match-btn primary" onclick="openMatchChat()">Envoyer un message</button>
                <button class="match-btn" onclick="closeMatch()">Continuer</button>
            </div>
        </div>
    </div>

    <!-- UNLOCK POPUP -->
    <div class="popup" id="unlockPopup">
        <div class="popup-content unlock-content">
            <button class="popup-close" onclick="closeUnlock()">Ã—</button>
            <div class="unlock-preview" id="unlockPreview"></div>
            <h3>Debloquer ce contenu?</h3>
            <p class="unlock-cost"><span id="unlockCost">50</span> tokens</p>
            <button class="unlock-btn" onclick="confirmUnlock()">Debloquer</button>
        </div>
    </div>

    <!-- LOGIN/REGISTER -->
    <div class="auth-screen" id="authScreen">
        <div class="auth-container">
            <div class="auth-logo">Dream AI Girl</div>
            <div class="auth-tabs">
                <button class="auth-tab active" id="tabLogin" onclick="showLogin()">Connexion</button>
                <button class="auth-tab" id="tabRegister" onclick="showRegister()">Inscription</button>
            </div>
            
            <!-- LOGIN FORM -->
            <form class="auth-form" id="loginForm" onsubmit="return handleLogin(event)">
                <input type="text" name="username" placeholder="Nom d'utilisateur" required>
                <input type="password" name="password" placeholder="Mot de passe" required>
                <button type="submit" class="auth-submit">Se connecter</button>
            </form>

            <!-- REGISTER FORM -->
            <form class="auth-form hidden" id="registerForm" onsubmit="return handleRegister(event)">
                <input type="text" name="username" placeholder="Nom d'utilisateur" required>
                <input type="email" name="email" placeholder="Email" required>
                <input type="password" name="password" placeholder="Mot de passe" required>
                <input type="number" name="age" placeholder="Age (18+)" min="18" required>
                <label class="checkbox-label">
                    <input type="checkbox" required>
                    J'ai plus de 18 ans et j'accepte les conditions
                </label>
                <button type="submit" class="auth-submit">S'inscrire</button>
            </form>
        </div>
    </div>

    <!-- GIRL PROFILE OVERLAY -->
    <div class="girl-profile-overlay" id="girlProfileOverlay">
        <div class="girl-profile-panel">
            <div class="profile-header">
                <button class="back-btn" onclick="closeGirlProfile()"><</button>
                <div class="profile-tabs">
                    <button class="profile-tab active" data-tab="profil" onclick="switchProfileTab('profil')">Profil</button>
                    <button class="profile-tab" data-tab="galerie" onclick="switchProfileTab('galerie')">Galerie</button>
                </div>
                <button class="chat-btn" onclick="closeGirlProfile()">ðŸ’¬</button>
            </div>
            
            <div class="xp-bar-section">
                <div class="xp-level-badge" id="profileLevelBadge">1</div>
                <div class="xp-info">
                    <span class="xp-level-text" id="profileLevelText">Niveau 1</span>
                    <div class="xp-bar-container">
                        <div class="xp-bar-fill" id="profileXpBar"></div>
                        <div class="xp-bar-bg"></div>
                    </div>
                    <div class="xp-numbers">
                        <span id="profileXpCurrent">0</span> / <span id="profileXpMax">100</span> XP
                        <span class="xp-next">Niveau <span id="profileNextLevel">2</span></span>
                    </div>
                </div>
            </div>
            
            <div class="profile-tab-content" id="profileTabContent">
                <div class="profile-actions-list" id="profileActionsList"></div>
            </div>
            
            <div class="galerie-tab-content" id="galerieTabContent" style="display:none;">
                <div class="galerie-grid" id="galerieGrid"></div>
            </div>
        </div>
    </div>

    <!-- PROFILE DETAIL PAGE (Tache 2) -->
    <div class="profile-detail-overlay" id="profileDetailOverlay">
        <header class="profile-detail-header">
            <button class="profile-detail-back" onclick="closeProfileDetail()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
            </button>
            <span></span>
        </header>
        
        <div class="media-carousel-container" id="detailMediaCarousel">
            <div class="media-slides" id="detailMediaSlides"></div>
            <button class="media-nav-btn media-nav-prev" onclick="prevDetailMedia()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
            </button>
            <button class="media-nav-btn media-nav-next" onclick="nextDetailMedia()">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
            </button>
            <div class="media-indicators" id="detailMediaIndicators"></div>
        </div>
        
        <div class="profile-detail-info">
            <h1 class="profile-detail-name" id="detailName">Nom, Age</h1>
            <p class="profile-detail-location" id="detailLocation">Paris, France</p>
            <p class="profile-detail-bio" id="detailBio">Bio de la fille...</p>
            
            <div class="profile-detail-stats">
                <div class="detail-stat">
                    <div class="detail-stat-value" id="detailAge">22</div>
                    <div class="detail-stat-label">Age</div>
                </div>
                <div class="detail-stat">
                    <div class="detail-stat-value" id="detailHeight">168cm</div>
                    <div class="detail-stat-label">Taille</div>
                </div>
                <div class="detail-stat">
                    <div class="detail-stat-value" id="detailAffection">0%</div>
                    <div class="detail-stat-label">Affection</div>
                </div>
            </div>
            
            <div class="profile-detail-tags" id="detailTags"></div>
        </div>
        
    </div>

    <!-- MEMORY MODAL -->
    <div class="memory-modal-overlay" id="memoryModalOverlay" onclick="if(event.target===this)closeMemoryModal()">
        <div class="memory-modal">
            <div class="memory-modal-header">
                <h2>Souvenir</h2>
                <button class="memory-modal-close" onclick="closeMemoryModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
            </div>
            <div class="memory-modal-body">
                <p class="memory-info">Ces souvenirs sont utilises uniquement par <span id="memoryGirlName" class="memory-girl-name">elle</span> <span class="memory-count" id="memoryCount">0/10</span></p>
                <div id="memoriesContainer" class="memories-list"></div>
                <button class="memory-add-btn" onclick="showAddMemoryForm()">Ajouter un souvenir</button>
            </div>
            <div class="memory-add-form" id="memoryAddForm" style="display:none;">
                <p class="memory-instruction">De quel souvenir voulez-vous que <span class="memory-girl-name2">elle</span> se souvienne ?</p>
                <textarea id="memoryInput" class="memory-textarea" placeholder="Saisissez votre souvenir ici..." maxlength="250" oninput="updateMemoryCharCount()"></textarea>
                <div class="memory-char-count"><span id="memoryCharCount">0</span>/250</div>
                <div class="memory-form-actions">
                    <button class="memory-back-btn" onclick="hideAddMemoryForm()">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                    </button>
                    <button class="memory-save-btn" id="memorySaveBtn">Enregistrer le souvenir</button>
<script>
document.getElementById('memorySaveBtn').addEventListener('click', function(e) {
    e.preventDefault();
    var content = document.getElementById('memoryInput').value.trim();
    var girlId = window.currentGirlId;
    var user = JSON.parse(localStorage.getItem('dreamUser') || '{}');
    var userId = user.id;
    
    if(!content){showToast('Veuillez saisir un souvenir');return;}
    if(!girlId){showToast('Erreur: profil non selectionne');return;}
    if(!userId){showToast('Erreur: non connecte');return;}
    
    var xhr = new XMLHttpRequest();
    xhr.open('POST', '/api/memories', true);
    xhr.setRequestHeader('Content-Type', 'application/json');
    xhr.onload = function() {
        try {
            var d = JSON.parse(xhr.responseText);
            if(d.success){
                showToast('Souvenir enregistre');
                document.getElementById('memoryInput').value='';
                if(typeof loadMemories==='function')loadMemories();
                if(typeof hideAddMemoryForm==='function')hideAddMemoryForm();
            } else {
                showToast(d.error || 'Erreur');
            }
        } catch(err) {
            showToast('Erreur serveur');
        }
    };
    xhr.onerror = function() { showToast('Erreur reseau'); };
    xhr.send(JSON.stringify({girl_id: girlId, content: content, user_id: userId}));
});
</script>
                </div>
            </div>
        </div>
    </div>

    <!-- WATCH TOGETHER MODAL -->
    <div id="watchTogetherModal" class="watch-together-modal">
        <div class="watch-together-container">
            <div class="watch-header">
                <button class="watch-back-btn" onclick="closeWatchTogether()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
                </button>
                <div class="watch-title">Regarder ensemble</div>
                <div class="watch-timer" id="watchTimer">00:00</div>
            </div>
            
            <div class="watch-video-selection" id="watchVideoSelection">
                <div class="watch-section-title">Choisis une video</div>
                <div class="watch-categories">
                    <button class="watch-cat-btn active" data-cat="all">Tout</button>
                    <button class="watch-cat-btn" data-cat="sensuel">Sensuel</button>
                    <button class="watch-cat-btn" data-cat="oral">Oral</button>
                    <button class="watch-cat-btn" data-cat="hardcore">Hardcore</button>
                </div>
                <div class="watch-video-grid" id="watchVideoGrid"></div>
            </div>
            
            <div class="watch-player-area" id="watchPlayerArea" style="display:none;">
                <!-- Selecteur de mode -->
                <div class="watch-mode-selector">
                    <button class="mode-btn active" onclick="setWatchMode('reaction')">Reaction</button>
                    <button class="mode-btn" onclick="setWatchMode('facetime')">Appel</button>
                </div>
                
                <!-- Scene Chambre (cache par defaut) -->
                <div class="watch-gamer-room" id="watchModeCozy" style="display:none;">
                    <!-- Fond chambre gamer -->
                    <div class="gamer-room-bg">
                        <div class="gamer-wall"></div>
                        <div class="gamer-led-strip"></div>
                        <div class="gamer-floor"></div>
                        <div class="gamer-ambient"></div>
                    </div>
                    
                    <!-- Decors gauche -->
                    <div class="room-decor-left">
                        <div class="decor-shelf">
                            <div class="shelf-plant"></div>
                            <div class="shelf-figurine"></div>
                        </div>
                        <div class="decor-led-bar left"></div>
                        <div class="decor-poster left"></div>
                    </div>
                    
                    <!-- Decors droite -->
                    <div class="room-decor-right">
                        <div class="decor-shelf">
                            <div class="shelf-book"></div>
                            <div class="shelf-light"></div>
                        </div>
                        <div class="decor-led-bar right"></div>
                        <div class="decor-poster right"></div>
                    </div>
                    
                    <!-- TV Gaming avec video NSFW -->
                    <div class="gamer-tv-setup">
                        <div class="gamer-tv-frame">
                            <div class="gamer-tv-screen">
                                <video id="watchMainVideo" playsinline></video>
                            </div>
                            <div class="gamer-tv-led"></div>
                        </div>
                        <div class="gamer-tv-stand"></div>
                    </div>
                    
                    <!-- Camgirl avec chroma key -->
                    <div class="gamer-camgirl-area">
                        <canvas id="chromaCanvas" class="chroma-overlay"></canvas>
                        <video id="watchReactionVideo" class="chroma-source-video" loop muted playsinline crossorigin="anonymous"></video>
                        <img id="watchReactionImg" style="display:none;">
                        <div class="gamer-name-tag" id="watchCamgirlName"></div>
                    </div>
                    
                    <!-- Bulle de commentaire -->
                    <div class="gamer-speech-bubble" id="watchCamgirlComment"></div>
                    
                    <!-- Controles -->
                    <div class="watch-controls-bar">
                        <button class="room-control-btn" onclick="toggleWatchPlay()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                        </button>
                        <div class="room-progress-bar" onclick="seekWatch(event)">
                            <div class="room-progress-fill" id="watchProgressFill1"></div>
                        </div>
                        <span class="room-time" id="roomCurrentTime1">0:00</span>
                    </div>
                </div>
                
                <!-- MODE 2: FACETIME / APPEL VIDEO -->
                <div class="watch-mode-facetime" id="watchModeFacetime" style="display:none;">
                    <div class="facetime-bg"></div>
                    <div class="facetime-main">
                        <canvas id="chromaCanvasFT" class="facetime-camgirl"></canvas>
                        <video id="watchReactionVideoFT" class="chroma-source-video" loop muted playsinline crossorigin="anonymous"></video>
                    </div>
                    <div class="facetime-pip">
                        <video id="watchMainVideoFT" playsinline loop></video>
                        <div class="facetime-pip-label">Son ecran</div>
                    </div>
                    <div class="facetime-name" id="watchCamgirlNameFT"></div>
                    <div class="facetime-controls">
                        <button class="ft-btn red" onclick="closeWatchTogether()"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.1-.7-.28-.79-.73-1.68-1.36-2.66-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"/></svg></button>
                        <button class="ft-btn" onclick="toggleWatchPlay()"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg></button>
                    </div>
                </div>
                
                <!-- MODE 3: REACTION YOUTUBE (par defaut) -->
                <div class="watch-mode-reaction" id="watchModeReaction">
                    <div class="reaction-main-video">
                        <video id="watchMainVideoRX" playsinline loop></video>
                    </div>
                    <div class="reaction-overlay">
                        <video id="watchReactionVideoRX" class="reaction-camgirl-video" loop muted playsinline autoplay></video>
                        <div class="reaction-name" id="watchCamgirlNameRX"></div>
                    </div>
                    <div class="reaction-controls">
                        <button class="room-control-btn" onclick="toggleWatchPlay()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                        </button>
                        <div class="room-progress-bar" onclick="seekWatch(event)">
                            <div class="room-progress-fill" id="watchProgressFill3"></div>
                        </div>
                        <span class="room-time" id="roomCurrentTime3">0:00</span>
                    </div>
                </div>
                
                <!-- MODE 4: POV LIT -->
                <div class="watch-mode-pov" id="watchModePov" style="display:none;">
                    <div class="pov-bg">
                        <div class="pov-blanket"></div>
                        <div class="pov-pillows"></div>
                    </div>
                    <div class="pov-phone">
                        <div class="pov-phone-screen">
                            <video id="watchMainVideoPOV" playsinline></video>
                        </div>
                    </div>
                    <div class="pov-camgirl">
                        <canvas id="chromaCanvasPOV" class="pov-girl-canvas"></canvas>
                        <video id="watchReactionVideoPOV" class="chroma-source-video" loop muted playsinline></video>
                        <div class="pov-name" id="watchCamgirlNamePOV"></div>
                    </div>
                    <div class="pov-hand"></div>
                    <div class="pov-controls">
                        <button class="room-control-btn" onclick="toggleWatchPlay()">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                        </button>
                        <div class="room-progress-bar" onclick="seekWatch(event)">
                            <div class="room-progress-fill" id="watchProgressFill4"></div>
                        </div>
                        <span class="room-time" id="roomCurrentTime4">0:00</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- TOAST -->
    <div class="toast" id="toast"></div>

    <script src="/static/js/app.js?v=20260203actionsV6"></script>
    <script>
    function openSouvenirFromChat() {
        console.log('openSouvenirFromChat called, girlId:', window.currentGirlId);
        var menu = document.getElementById('chatMenuDropdown');
        if (menu) menu.classList.remove('active');
        
        var modal = document.getElementById('memoryModalOverlay');
        console.log('Modal element:', modal);
        if (!modal) {
            alert('Modal non trouve!');
            return;
        }
        
        modal.classList.add('active');
        var addForm = document.getElementById('memoryAddForm');
        var body = document.querySelector('.memory-modal-body');
        if (addForm) addForm.style.display = 'none';
        if (body) body.style.display = 'block';
        
        var girlName = (window.currentGirl && (window.currentGirl.pseudo || window.currentGirl.name)) || 'elle';
        var nameEl = document.getElementById('memoryGirlName');
        if (nameEl) nameEl.textContent = girlName;
        var gn2 = document.querySelector('.memory-girl-name2');
        if (gn2) gn2.textContent = girlName;
        
        if (typeof loadMemories === 'function') loadMemories();
    }
    
    function showAddMemoryForm() {
        document.querySelector('.memory-modal-body').style.display = 'none';
        document.getElementById('memoryAddForm').style.display = 'block';
        document.getElementById('memoryInput').value = '';
        document.getElementById('memoryCharCount').textContent = '0';
    }
    
    function hideAddMemoryForm() {
        document.getElementById('memoryAddForm').style.display = 'none';
        document.querySelector('.memory-modal-body').style.display = 'block';
    }
    
    function updateMemoryCharCount() {
        var input = document.getElementById('memoryInput');
        document.getElementById('memoryCharCount').textContent = input.value.length;
    }
    
    function showProfileMenu(e) {
        if (e) e.stopPropagation();
        var menu = document.getElementById('profileMenuDropdown');
        if (menu) {
            menu.classList.toggle('active');
            if (menu.classList.contains('active')) {
                setTimeout(function() {
                    document.addEventListener('click', closeProfileMenuOnClickOutside);
                }, 10);
            }
        }
    }
    
    function closeProfileMenuOnClickOutside(e) {
        var menu = document.getElementById('profileMenuDropdown');
        if (menu && !menu.contains(e.target)) {
            menu.classList.remove('active');
            document.removeEventListener('click', closeProfileMenuOnClickOutside);
        }
    }
    
    function closeProfileMenu() {
        var menu = document.getElementById('profileMenuDropdown');
        if (menu) menu.classList.remove('active');
        document.removeEventListener('click', closeProfileMenuOnClickOutside);
    }
    
    function closeMemoryModal() {
        var modal = document.getElementById('memoryModalOverlay');
        if (modal) modal.classList.remove('active');
    }
    </script>
    <style>
    .profile-menu-dropdown {
        position: absolute;
        top: 50px;
        right: 10px;
        background: #1a1a2e;
        border-radius: 12px;
        padding: 8px 0;
        min-width: 200px;
        box-shadow: 0 4px 20px rgba(0,0,0,0.4);
        z-index: 1000;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.2s ease;
    }
    .profile-menu-dropdown.active {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
    }
    
    /* WATCH TOGETHER */
    .watch-together-btn { background: linear-gradient(135deg, #e91e63, #9c27b0) !important; }
    .watch-together-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 10000; display: none; flex-direction: column; }
    .watch-together-modal.active { display: flex; }
    .watch-together-container { width: 100%; height: 100%; display: flex; flex-direction: column; }
    .watch-header { display: flex; align-items: center; padding: 15px; background: rgba(0,0,0,0.9); border-bottom: 1px solid #222; }
    .watch-back-btn { background: none; border: none; color: white; cursor: pointer; padding: 5px; }
    .watch-title { flex: 1; color: white; font-weight: 600; font-size: 1.1rem; margin-left: 10px; }
    .watch-timer { color: #e91e63; font-weight: 600; font-size: 0.9rem; }
    .watch-video-selection { flex: 1; padding: 15px; overflow-y: auto; }
    .watch-section-title { color: white; font-size: 1rem; margin-bottom: 15px; font-weight: 600; }
    .watch-categories { display: flex; gap: 10px; margin-bottom: 20px; overflow-x: auto; padding-bottom: 5px; }
    .watch-cat-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: white; padding: 8px 16px; border-radius: 20px; font-size: 0.85rem; cursor: pointer; white-space: nowrap; }
    .watch-cat-btn.active { background: linear-gradient(135deg, #e91e63, #9c27b0); border-color: transparent; }
    .watch-video-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
    .watch-video-item { position: relative; border-radius: 12px; overflow: hidden; cursor: pointer; aspect-ratio: 16/9; background: #1a1a1a; }
    .watch-video-item img { width: 100%; height: 100%; object-fit: cover; }
    .watch-video-item .video-title { position: absolute; bottom: 0; left: 0; right: 0; padding: 8px; background: linear-gradient(transparent, rgba(0,0,0,0.9)); color: white; font-size: 0.75rem; }
    .watch-video-item .video-duration { position: absolute; top: 8px; right: 8px; background: rgba(0,0,0,0.7); color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; }
    .watch-video-item .play-icon { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 50px; height: 50px; background: rgba(233,30,99,0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; }
    .watch-player-area { flex: 1; display: flex; flex-direction: column; position: relative; overflow: hidden; }
    
    /* SCENE IMMERSIVE - CHAMBRE */
    .watch-room-scene { position: relative; width: 100%; height: 100%; overflow: hidden; }
    .room-background { position: absolute; inset: 0; }
    .room-wall { position: absolute; top: 0; left: 0; right: 0; height: 65%; background: linear-gradient(180deg, #1a1520 0%, #251a2e 50%, #2d1f35 100%); }
    .room-floor { position: absolute; bottom: 0; left: 0; right: 0; height: 35%; background: linear-gradient(180deg, #1a1418 0%, #0f0d10 100%); }
    .room-ambient-light { position: absolute; inset: 0; background: radial-gradient(ellipse at 50% 30%, rgba(233,30,99,0.08) 0%, transparent 60%); pointer-events: none; }
    
    /* TV */
    .room-tv-area { position: absolute; top: 8%; left: 50%; transform: translateX(-50%); width: 70%; max-width: 320px; z-index: 2; }
    .room-tv-frame { background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%); border-radius: 8px; padding: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
    .room-tv-screen { position: relative; aspect-ratio: 16/9; background: #000; border-radius: 4px; overflow: hidden; }
    .room-tv-screen video { width: 100%; height: 100%; object-fit: contain; }
    .tv-reflection { position: absolute; inset: 0; background: linear-gradient(135deg, rgba(255,255,255,0.08) 0%, transparent 50%); pointer-events: none; }
    .room-tv-stand { width: 30%; height: 8px; margin: 8px auto 0; background: linear-gradient(180deg, #333 0%, #1a1a1a 100%); border-radius: 0 0 4px 4px; }
    .tv-glow { position: absolute; top: 10%; left: 50%; transform: translateX(-50%); width: 90%; height: 60%; background: radial-gradient(ellipse, rgba(100,150,255,0.15) 0%, transparent 70%); pointer-events: none; filter: blur(20px); z-index: 1; }
    
    /* CAMGIRL SUR LE LIT */
    .room-camgirl-area { position: absolute; bottom: 5%; left: 50%; transform: translateX(-50%); width: 85%; max-width: 350px; z-index: 3; }
    .camgirl-bed { position: relative; background: linear-gradient(180deg, rgba(60,30,50,0.6) 0%, rgba(40,20,35,0.8) 100%); border-radius: 20px 20px 8px 8px; padding: 10px; box-shadow: 0 -5px 30px rgba(233,30,99,0.2); }
    .camgirl-figure { width: 100%; aspect-ratio: 4/3; border-radius: 15px; overflow: hidden; background: #1a1a1a; }
    .camgirl-figure video, .camgirl-figure img { width: 100%; height: 100%; object-fit: cover; }
    .camgirl-name-tag { position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #e91e63, #9c27b0); color: white; padding: 5px 15px; border-radius: 15px; font-size: 0.8rem; font-weight: 600; white-space: nowrap; }
    
    /* BULLE DE DIALOGUE */
    .camgirl-speech-bubble { position: absolute; top: -15px; right: 10px; background: rgba(233,30,99,0.95); color: white; padding: 10px 15px; border-radius: 15px 15px 5px 15px; font-size: 0.85rem; max-width: 200px; opacity: 0; transform: scale(0.8) translateY(10px); transition: all 0.3s ease; box-shadow: 0 5px 15px rgba(233,30,99,0.3); z-index: 10; }
    .camgirl-speech-bubble::after { content: ''; position: absolute; bottom: -8px; right: 20px; border-width: 8px 8px 0; border-style: solid; border-color: rgba(233,30,99,0.95) transparent transparent; }
    .camgirl-speech-bubble.show { opacity: 1; transform: scale(1) translateY(0); }
    
    /* CONTROLES */
    .room-controls-overlay { position: absolute; bottom: 0; left: 0; right: 0; padding: 15px; background: linear-gradient(transparent, rgba(0,0,0,0.8)); z-index: 5; }
    .room-controls { display: flex; align-items: center; gap: 12px; padding: 8px; background: rgba(0,0,0,0.4); border-radius: 25px; backdrop-filter: blur(10px); }
    .room-control-btn { background: rgba(255,255,255,0.15); border: none; color: white; width: 44px; height: 44px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; }
    .room-control-btn:hover { background: rgba(233,30,99,0.5); }
    .room-progress-bar { flex: 1; height: 6px; background: rgba(255,255,255,0.2); border-radius: 3px; cursor: pointer; overflow: hidden; }
    .room-progress-fill { height: 100%; background: linear-gradient(90deg, #e91e63, #9c27b0); border-radius: 3px; width: 0%; transition: width 0.1s linear; }
    .room-time { color: rgba(255,255,255,0.7); font-size: 0.8rem; min-width: 40px; text-align: right; }
    
    .watch-empty { text-align: center; padding: 40px; color: rgba(255,255,255,0.5); }
    
    /* CHAMBRE COZY MODE - Style realiste */
    .watch-gamer-room { position: relative; width: 100%; height: 100%; overflow: hidden; }
    .gamer-room-bg { position: absolute; inset: 0; z-index: 0; }
    .gamer-wall { position: absolute; top: 0; left: 0; right: 0; height: 55%; background: linear-gradient(180deg, #e8e0f0 0%, #d8d0e5 50%, #c8c0d8 100%); }
    .gamer-led-strip { position: absolute; top: 0; left: 0; right: 0; height: 6px; background: linear-gradient(90deg, #ff69b4, #da70d6, #ff69b4, #da70d6); animation: ledPulse 2s ease-in-out infinite; box-shadow: 0 0 30px rgba(255,105,180,0.7), 0 0 60px rgba(218,112,214,0.5), 0 10px 80px rgba(255,105,180,0.4); }
    @keyframes ledPulse { 0%,100% { opacity: 0.9; } 50% { opacity: 1; } }
    .gamer-floor { position: absolute; bottom: 0; left: 0; right: 0; height: 45%; background: linear-gradient(180deg, #f5f0fa 0%, #e8e0f0 100%); }
    .gamer-ambient { position: absolute; inset: 0; background: radial-gradient(ellipse at 50% 0%, rgba(255,105,180,0.25) 0%, transparent 50%), radial-gradient(ellipse at 20% 30%, rgba(218,112,214,0.15) 0%, transparent 40%), radial-gradient(ellipse at 80% 30%, rgba(255,182,193,0.15) 0%, transparent 40%); pointer-events: none; }
    
    /* TV sur meuble - Style realiste */
    .gamer-tv-setup { position: absolute; top: 8%; left: 50%; transform: translateX(-50%); width: 70%; max-width: 280px; z-index: 2; }
    .gamer-tv-frame { background: #1a1a1a; border-radius: 4px; padding: 4px; box-shadow: 0 5px 25px rgba(0,0,0,0.3); position: relative; }
    .gamer-tv-screen { position: relative; aspect-ratio: 16/9; background: #000; border-radius: 2px; overflow: hidden; }
    .gamer-tv-screen video { width: 100%; height: 100%; object-fit: contain; }
    .gamer-tv-led { display: none; }
    .gamer-tv-stand { width: 100%; height: 25px; margin-top: 4px; background: linear-gradient(180deg, #2a2a2a 0%, #1a1a1a 100%); border-radius: 3px; box-shadow: 0 3px 10px rgba(0,0,0,0.2); }
    
    /* Camgirl avec chroma key - Premier plan */
    .gamer-camgirl-area { position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); width: 65%; max-width: 260px; z-index: 3; }
    .chroma-overlay { width: 100%; height: auto; display: block; border-radius: 8px; }
    .chroma-source-video { position: absolute; opacity: 0; pointer-events: none; width: 1px; height: 1px; }
    .gamer-name-tag { position: absolute; bottom: -25px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #ff69b4, #da70d6); color: white; padding: 5px 15px; border-radius: 15px; font-size: 0.8rem; font-weight: 600; white-space: nowrap; box-shadow: 0 3px 15px rgba(255,105,180,0.4); }
    
    /* Bulle commentaire */
    .gamer-speech-bubble { position: absolute; top: 20%; right: 5%; background: rgba(255,255,255,0.95); color: #333; padding: 10px 15px; border-radius: 15px 15px 5px 15px; font-size: 0.85rem; max-width: 160px; opacity: 0; transform: scale(0.8); transition: all 0.3s ease; box-shadow: 0 5px 20px rgba(0,0,0,0.15); z-index: 10; border: 2px solid rgba(255,105,180,0.3); }
    .gamer-speech-bubble.show { opacity: 1; transform: scale(1); }
    
    /* Controles */
    .gamer-controls { position: absolute; bottom: 0; left: 0; right: 0; padding: 12px 15px; display: flex; align-items: center; gap: 12px; background: linear-gradient(transparent, rgba(240,235,245,0.95)); z-index: 5; }
    
    /* Lit blanc en premier plan */
    .room-decor-left, .room-decor-right { display: none; }
    .gamer-room-bg::after { content: ''; position: absolute; bottom: 0; left: 0; right: 0; height: 35%; background: linear-gradient(180deg, transparent 0%, rgba(255,255,255,0.3) 20%, rgba(255,255,255,0.6) 100%); pointer-events: none; z-index: 0; }
    .watch-controls-bar { position: absolute; bottom: 0; left: 0; right: 0; padding: 12px 15px; display: flex; align-items: center; gap: 12px; background: linear-gradient(transparent, rgba(0,0,0,0.7)); z-index: 5; }
    
    /* SELECTEUR DE MODE */
    .watch-mode-selector { position: absolute; top: 10px; left: 50%; transform: translateX(-50%); display: flex; gap: 5px; z-index: 20; background: rgba(0,0,0,0.5); padding: 5px; border-radius: 20px; }
    .mode-btn { background: rgba(255,255,255,0.1); border: none; color: white; padding: 6px 12px; border-radius: 15px; font-size: 0.7rem; cursor: pointer; transition: all 0.2s; }
    .mode-btn.active { background: linear-gradient(135deg, #e91e63, #9c27b0); }
    
    /* MODE FACETIME */
    .watch-mode-facetime { position: relative; width: 100%; height: 100%; overflow: hidden; }
    .facetime-bg { position: absolute; inset: 0; background: linear-gradient(180deg, #2d1f3d 0%, #1a1525 50%, #0f0a15 100%); }
    .facetime-main { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; }
    .facetime-camgirl { width: 100%; height: 100%; object-fit: contain; }
    .facetime-pip { position: absolute; top: 50px; right: 15px; width: 120px; aspect-ratio: 9/16; background: #000; border-radius: 12px; overflow: hidden; box-shadow: 0 5px 25px rgba(0,0,0,0.5); border: 2px solid rgba(255,255,255,0.2); }
    .facetime-pip video { width: 100%; height: 100%; object-fit: cover; }
    .facetime-pip-label { position: absolute; bottom: 5px; left: 50%; transform: translateX(-50%); background: rgba(0,0,0,0.6); color: white; font-size: 0.6rem; padding: 2px 8px; border-radius: 10px; }
    .facetime-name { position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%); color: white; font-size: 1.2rem; font-weight: 600; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }
    .facetime-controls { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; gap: 30px; }
    .ft-btn { width: 55px; height: 55px; border-radius: 50%; border: none; background: rgba(255,255,255,0.2); color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    .ft-btn.red { background: #ff3b30; }
    
    /* ACTION EN DIRECT PANEL */
    .action-direct-btn { display: flex; align-items: center; gap: 10px; background: linear-gradient(135deg, #e91e63, #9c27b0); border: none; color: white; padding: 12px 20px; border-radius: 25px; font-size: 0.9rem; font-weight: 600; cursor: pointer; margin: 15px auto; box-shadow: 0 5px 20px rgba(233,30,99,0.4); }
    .action-direct-icon { font-size: 1.2rem; }
    .action-direct-text { flex: 1; }
    .action-direct-badge { background: rgba(255,255,255,0.2); padding: 3px 8px; border-radius: 10px; font-size: 0.7rem; }
    .action-direct-panel { display: none; position: fixed; bottom: 0; left: 0; right: 0; background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%); border-radius: 20px 20px 0 0; padding: 20px; z-index: 1000; max-height: 80vh; overflow-y: auto; box-shadow: 0 -10px 40px rgba(0,0,0,0.5); }
    .adp-header { display: flex; align-items: center; gap: 10px; margin-bottom: 20px; }
    .adp-close { background: none; border: none; color: #999; font-size: 1.2rem; cursor: pointer; padding: 5px; }
    .adp-title { flex: 1; font-size: 1.1rem; font-weight: 600; color: white; }
    .adp-badge { background: rgba(233,30,99,0.3); color: #e91e63; padding: 3px 10px; border-radius: 10px; font-size: 0.7rem; }
    .adp-level-section { display: flex; align-items: center; gap: 15px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px; margin-bottom: 15px; }
    .adp-level-circle { width: 50px; height: 50px; border-radius: 50%; background: linear-gradient(135deg, #e91e63, #9c27b0); display: flex; align-items: center; justify-content: center; font-size: 1.4rem; font-weight: 700; color: white; }
    .adp-level-info { flex: 1; }
    .adp-level-label { color: white; font-weight: 600; margin-bottom: 5px; }
    .adp-level-status { color: #e91e63; font-size: 0.75rem; font-weight: 600; margin-bottom: 8px; }
    .adp-xp-bar { height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px; overflow: hidden; }
    .adp-xp-fill { height: 100%; background: linear-gradient(90deg, #e91e63, #ff5722); border-radius: 10px; transition: width 0.5s ease; }
    .adp-xp-text { color: #888; font-size: 0.7rem; margin-top: 5px; }
    .adp-current-action { margin-bottom: 15px; }
    .adp-action-card { background: rgba(255,255,255,0.05); padding: 12px 15px; border-radius: 12px; display: flex; align-items: center; gap: 12px; }
    .adp-action-icon { font-size: 1.3rem; }
    .adp-action-text { flex: 1; color: white; font-size: 0.9rem; }
    .adp-action-btn { background: linear-gradient(135deg, #e91e63, #9c27b0); border: none; color: white; padding: 10px 20px; border-radius: 20px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; }
    .adp-more-actions { background: rgba(255,255,255,0.03); border-radius: 12px; overflow: hidden; }
    .adp-more-header { display: flex; align-items: center; gap: 10px; padding: 12px 15px; cursor: pointer; }
    .adp-hot-icon { font-size: 1.1rem; }
    .adp-more-count { flex: 1; color: #e91e63; font-weight: 600; font-size: 0.85rem; }
    .adp-expand-arrow { color: #666; }
    .adp-actions-list { max-height: 0; overflow: hidden; transition: max-height 0.3s ease; }
    .adp-action-item { display: flex; align-items: center; padding: 12px 15px; border-top: 1px solid rgba(255,255,255,0.05); }
    .adp-action-item.locked { opacity: 0.6; }
    .adp-item-text { flex: 1; color: white; font-size: 0.85rem; }
    .adp-item-lock { color: #666; font-size: 0.75rem; display: flex; align-items: center; gap: 5px; }
    .adp-item-play { background: linear-gradient(135deg, #e91e63, #9c27b0); border: none; color: white; width: 35px; height: 35px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; }
    
    /* MODE REACTION */
    .watch-mode-reaction { position: relative; width: 100%; height: 100%; overflow: hidden; background: #000; }
    .reaction-main-video { position: absolute; inset: 0; }
    .reaction-main-video video { width: 100%; height: 100%; object-fit: contain; }
    .reaction-overlay { position: absolute; bottom: 60px; right: 15px; width: 120px; height: 160px; border-radius: 12px; overflow: hidden; box-shadow: 0 5px 25px rgba(0,0,0,0.6); border: 3px solid #e91e63; background: #1a1a1a; }
    .reaction-camgirl-video { width: 100%; height: 100%; object-fit: cover; }
    .reaction-name { position: absolute; bottom: 8px; left: 50%; transform: translateX(-50%); background: rgba(233,30,99,0.9); color: white; font-size: 0.65rem; padding: 3px 10px; border-radius: 10px; white-space: nowrap; }
    .reaction-controls { position: absolute; bottom: 0; left: 0; right: 0; padding: 12px 15px; display: flex; align-items: center; gap: 12px; background: linear-gradient(transparent, rgba(0,0,0,0.8)); z-index: 5; }
    
    /* MODE POV */
    .watch-mode-pov { position: relative; width: 100%; height: 100%; overflow: hidden; }
    .pov-bg { position: absolute; inset: 0; background: linear-gradient(180deg, #2a2035 0%, #1a1525 100%); }
    .pov-blanket { position: absolute; bottom: 0; left: -20%; right: -20%; height: 40%; background: linear-gradient(0deg, #f5f0fa 0%, #e8dff0 50%, transparent 100%); border-radius: 100% 100% 0 0; transform: perspective(500px) rotateX(-10deg); }
    .pov-pillows { position: absolute; top: 10%; left: 10%; width: 80px; height: 50px; background: #fff; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    .pov-phone { position: absolute; top: 15%; left: 50%; transform: translateX(-50%); width: 55%; max-width: 200px; background: #1a1a1a; border-radius: 15px; padding: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
    .pov-phone-screen { aspect-ratio: 9/16; background: #000; border-radius: 10px; overflow: hidden; }
    .pov-phone-screen video { width: 100%; height: 100%; object-fit: contain; }
    .pov-camgirl { position: absolute; bottom: 50px; right: 10%; width: 40%; max-width: 150px; }
    .pov-girl-canvas { width: 100%; height: auto; border-radius: 10px; }
    .pov-name { position: absolute; bottom: -20px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #e91e63, #9c27b0); color: white; font-size: 0.65rem; padding: 3px 10px; border-radius: 10px; white-space: nowrap; }
    .pov-hand { position: absolute; bottom: 5%; left: 5%; width: 60px; height: 80px; background: linear-gradient(135deg, #f5d0c5, #e8c0b5); border-radius: 10px 10px 20px 20px; opacity: 0.7; }
    .pov-controls { position: absolute; bottom: 0; left: 0; right: 0; padding: 12px 15px; display: flex; align-items: center; gap: 12px; background: linear-gradient(transparent, rgba(0,0,0,0.8)); z-index: 5; }
    
    /* ACTION EN DIRECT PANEL (Style Candy AI) */
    .action-direct-panel { position: fixed; bottom: 0; left: 0; right: 0; background: #18182a; border-radius: 20px 20px 0 0; z-index: 999; transition: all 0.3s ease; }
    .action-direct-panel.collapsed .adp-content { display: none; }
    .adp-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; cursor: pointer; }
    .adp-title { display: flex; align-items: center; gap: 10px; color: white; font-weight: 600; font-size: 0.95rem; }
    .adp-title svg { color: #e91e63; }
    .adp-beta { background: #7c4dff; color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.7rem; font-weight: 500; }
    .adp-expand { color: #888; font-size: 0.9rem; }
    .adp-content { padding: 0 18px 18px; max-height: 50vh; overflow-y: auto; }
    .adp-level-row { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
    .adp-level-circle { width: 38px; height: 38px; border-radius: 50%; background: #2a2a4a; color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1rem; border: 2px solid #7c4dff; }
    .adp-level-text { color: #aaa; font-size: 0.9rem; }
    .adp-skip-btn { margin-left: auto; background: linear-gradient(135deg, #e91e63, #9c27b0); color: white; border: none; padding: 10px 16px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; font-weight: 500; }
    .adp-xp-row { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
    .adp-xp-bar { flex: 1; height: 8px; background: #2a2a4a; border-radius: 4px; overflow: hidden; }
    .adp-xp-fill { height: 100%; background: linear-gradient(90deg, #e91e63, #ff4081); border-radius: 4px; transition: width 0.3s; }
    .adp-xp-text { color: #888; font-size: 0.8rem; min-width: 70px; }
    .adp-next-level { color: #e91e63; font-size: 0.8rem; }
    .adp-actions-list { display: flex; flex-direction: column; gap: 8px; }
    .adp-action-item { background: #252540; padding: 14px 16px; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; }
    .adp-action-item.locked { opacity: 0.7; }
    .adp-action-text { color: white; font-size: 0.95rem; flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
    .adp-action-play { width: 42px; height: 42px; border-radius: 50%; background: #e91e63; border: none; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
    .adp-action-lock { color: #888; font-size: 0.85rem; display: flex; align-items: center; gap: 6px; flex-shrink: 0; }
    .adp-action-lock svg { opacity: 0.6; }
    </style>
    
    <script>
    // WATCH TOGETHER FUNCTIONS
    var watchVideos = [];
    var watchReactions = {};
    var currentWatchVideo = null;
    var watchTimerInterval = null;
    var watchStartTime = 0;

    function openWatchTogether() {
        var girlId = window.currentGirlId;
        if (!girlId) {
            showToast("Selectionne une fille d'abord");
            return;
        }
        document.getElementById('watchTogetherModal').classList.add('active');
        loadWatchVideos();
        loadWatchReactions(girlId);
        var girlName = window.currentGirlName || 'Elle';
        document.getElementById('watchCamgirlName').textContent = girlName;
    }

    function closeWatchTogether() {
        document.getElementById('watchTogetherModal').classList.remove('active');
        stopWatchVideo();
        document.getElementById('watchVideoSelection').style.display = 'block';
        document.getElementById('watchPlayerArea').style.display = 'none';
    }

    function loadWatchVideos(category) {
        var url = '/api/watch/videos';
        if (category && category !== 'all') url += '?category=' + category;
        fetch(url).then(function(r){return r.json();}).then(function(data){
            watchVideos = data.videos || [];
            renderWatchVideoGrid();
        }).catch(function(e){ watchVideos = []; renderWatchVideoGrid(); });
    }

    function loadWatchReactions(girlId) {
        fetch('/api/watch/reactions/' + girlId).then(function(r){return r.json();}).then(function(data){
            watchReactions = data.reactions || {};
            updateReactionDisplay('idle');
        }).catch(function(e){ watchReactions = {}; });
    }

    // =============== SYSTEME ACTION EN DIRECT XP ===============
    var actionLevels = [];
    var userActionProgress = { level: 1, xp: 0, xp_in_level: 0, xp_for_next: 35, unlocked_levels: [1] };
    var actionPanelOpen = false;
    var moreActionsExpanded = false;

    function openActionDirect() {
        if (!window.currentGirlId) {
            showToast('Selectionnez une fille d\'abord');
            return;
        }
        
        var girlName = window.currentGirlName || 'Elle';
        var girlPhoto = window.currentGirlPhoto || '/static/default.jpg';
        
        // Charger la progression si pas fait
        fetch('/api/action/progress/' + window.currentGirlId).then(function(r){return r.json();}).then(function(data){
            if (!data.error) userActionProgress = data;
            showActionDirectFullscreen(girlName, girlPhoto);
        }).catch(function(){ showActionDirectFullscreen(girlName, girlPhoto); });
    }
    
    function showActionDirectFullscreen(girlName, girlPhoto) {
        var lvl = userActionProgress.level || 1;
        var xpInLevel = userActionProgress.xp_in_level || 0;
        var xpForNext = userActionProgress.xp_for_next || 35;
        var unlocked = userActionProgress.unlocked_levels || [1];
        var tokensToSkip = Math.min(5 + (lvl * 5), 75);
        
        var existingModal = document.getElementById('actionDirectFullscreen');
        if (existingModal) existingModal.remove();
        
        var bottomNav = document.getElementById('bottomNav');
        if (bottomNav) bottomNav.style.display = 'none';
        var xpBubble = document.getElementById('xpBubbleCandy');
        if (xpBubble) xpBubble.style.display = 'none';
        
        var modal = document.createElement('div');
        modal.id = 'actionDirectFullscreen';
        modal.innerHTML = '<div class="adf-container">' +
            '<div class="adf-header">' +
                '<button class="adf-back" onclick="closeActionDirectFullscreen()">&#8592;</button>' +
                '<div class="adf-girl-info"><img src="' + girlPhoto + '" class="adf-mini-avatar"><span>' + girlName + '</span><span class="adf-level-badge">' + lvl + '</span></div>' +
                '<button class="adf-close" onclick="closeActionDirectFullscreen()">&#10005;</button>' +
            '</div>' +
            '<div class="adf-video-area">' +
                '<img class="adf-main-photo" src="' + girlPhoto + '" alt="">' +
                '<div class="adf-mini-model"><img src="' + girlPhoto + '" alt=""></div>' +
                '<div class="adf-action-buttons">' +
                    '<button class="adf-icon-btn"><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/></svg></button>' +
                    '<button class="adf-icon-btn"><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="3.2"/><path d="M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"/></svg></button>' +
                    '<button class="adf-icon-btn"><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg></button>' +
                '</div>' +
            '</div>' +
            '<div class="adf-panel">' +
                '<div class="adf-panel-header" onclick="toggleActionDirectPanel()">' +
                    '<div class="adf-panel-title"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg> Action en Direct <span class="adf-beta">Beta v2</span></div>' +
                    '<span id="adfExpandArrow">&#9660;</span>' +
                '</div>' +
                '<div class="adf-level-row">' +
                    '<div class="adf-level-circle">' + lvl + '</div>' +
                    '<span class="adf-level-text">Niveau ' + lvl + '</span>' +
                    '<button class="adf-skip-btn" onclick="skipActionLevel()">Passer au niveau ' + (lvl+1) + ' &#11088; ' + tokensToSkip + '</button>' +
                '</div>' +
                '<div class="adf-xp-row">' +
                    '<div class="adf-xp-bar"><div class="adf-xp-fill" style="width:' + (xpForNext > 0 ? Math.min(100, (xpInLevel/xpForNext)*100) : 0) + '%"></div></div>' +
                    '<span class="adf-xp-text">' + xpInLevel + ' / ' + xpForNext + ' XP</span>' +
                    '<span class="adf-next-level">Niveau ' + (lvl+1) + '</span>' +
                '</div>' +
                '<div class="adf-actions-list" id="adfActionsList"></div>' +
            '</div>' +
        '</div>';
        modal.style.cssText = 'position:fixed;inset:0;z-index:9999;background:#0a0a0c;';
        
        var style = document.createElement('style');
        style.id = 'adfStyles';
        style.textContent = '.adf-container{height:100%;display:flex;flex-direction:column;}.adf-header{display:flex;align-items:center;padding:12px 15px;background:rgba(0,0,0,0.8);position:absolute;top:0;left:0;right:0;z-index:10;}.adf-back,.adf-close{background:none;border:none;color:white;font-size:1.4rem;cursor:pointer;padding:5px;}.adf-girl-info{flex:1;display:flex;align-items:center;gap:10px;justify-content:center;}.adf-mini-avatar{width:32px;height:32px;border-radius:50%;object-fit:cover;}.adf-level-badge{background:#e91e63;color:white;padding:2px 8px;border-radius:12px;font-size:0.8rem;}.adf-video-area{flex:1;position:relative;background:#1a1a1a;display:flex;align-items:center;justify-content:center;overflow:hidden;}.adf-main-photo{width:100%;height:100%;object-fit:cover;}.adf-mini-model{position:absolute;bottom:180px;right:15px;width:80px;height:80px;border-radius:12px;overflow:hidden;border:2px solid rgba(255,255,255,0.3);box-shadow:0 4px 15px rgba(0,0,0,0.5);}.adf-mini-model img{width:100%;height:100%;object-fit:cover;}.adf-action-buttons{position:absolute;right:15px;top:70px;display:flex;flex-direction:column;gap:12px;}.adf-icon-btn{width:44px;height:44px;border-radius:50%;background:rgba(60,60,60,0.7);border:none;color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;}.adf-panel{background:#18182a;border-radius:20px 20px 0 0;padding:15px;position:absolute;bottom:0;left:0;right:0;max-height:55vh;overflow-y:auto;}.adf-panel-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;cursor:pointer;}.adf-panel-title{display:flex;align-items:center;gap:8px;color:white;font-weight:600;}.adf-beta{background:#7c4dff;color:white;padding:2px 8px;border-radius:10px;font-size:0.7rem;}.adf-level-row{display:flex;align-items:center;gap:12px;margin-bottom:12px;}.adf-level-circle{width:36px;height:36px;border-radius:50%;background:#2a2a4a;color:white;display:flex;align-items:center;justify-content:center;font-weight:700;border:2px solid #7c4dff;}.adf-level-text{color:#aaa;font-size:0.9rem;}.adf-skip-btn{margin-left:auto;background:linear-gradient(135deg,#e91e63,#9c27b0);color:white;border:none;padding:8px 14px;border-radius:20px;font-size:0.8rem;cursor:pointer;}.adf-xp-row{display:flex;align-items:center;gap:10px;margin-bottom:15px;}.adf-xp-bar{flex:1;height:8px;background:#2a2a4a;border-radius:4px;overflow:hidden;}.adf-xp-fill{height:100%;background:linear-gradient(90deg,#e91e63,#ff4081);border-radius:4px;transition:width 0.3s;}.adf-xp-text{color:#888;font-size:0.8rem;}.adf-next-level{color:#e91e63;font-size:0.8rem;}.adf-actions-list{display:flex;flex-direction:column;gap:8px;}.adf-action-item{background:#252540;padding:14px 16px;border-radius:12px;display:flex;align-items:center;justify-content:space-between;}.adf-action-item.locked{opacity:0.7;}.adf-action-text{color:white;font-size:0.95rem;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;}.adf-action-play{width:40px;height:40px;border-radius:50%;background:#e91e63;border:none;color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;}.adf-action-lock{color:#888;font-size:0.85rem;display:flex;align-items:center;gap:6px;}.adf-action-lock svg{opacity:0.6;}';
        document.head.appendChild(style);
        document.body.appendChild(modal);
        
        renderActionDirectList();
    }
    
    function renderActionDirectList() {
        var listEl = document.getElementById('adfActionsList');
        if (!listEl) return;
        
        var lvl = userActionProgress.level || 1;
        var unlocked = userActionProgress.unlocked_levels || [1];
        var html = '';
        
        actionLevels.forEach(function(action) {
            var isUnlocked = unlocked.indexOf(action.level) !== -1 || action.level <= lvl;
            html += '<div class="adf-action-item ' + (isUnlocked ? '' : 'locked') + '">' +
                '<span class="adf-action-text">' + action.title + '</span>' +
                (isUnlocked ? 
                    '<button class="adf-action-play" onclick="playActionVideo(' + action.level + ')"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg></button>' :
                    '<span class="adf-action-lock"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg> Niveau ' + action.level + '</span>') +
            '</div>';
        });
        listEl.innerHTML = html;
    }
    
    function closeActionDirectFullscreen() {
        var modal = document.getElementById('actionDirectFullscreen');
        var styles = document.getElementById('adfStyles');
        if (modal) modal.remove();
        if (styles) styles.remove();
        
        var bottomNav = document.getElementById('bottomNav');
        if (bottomNav) bottomNav.style.display = 'flex';
        var xpBubble = document.getElementById('xpBubbleCandy');
        if (xpBubble) xpBubble.style.display = 'flex';
    }
    
    function toggleActionDirectPanel() {
        var panel = document.querySelector('.adf-panel');
        var arrow = document.getElementById('adfExpandArrow');
        if (panel.style.maxHeight === '120px') {
            panel.style.maxHeight = '55vh';
            arrow.innerHTML = '&#9660;';
        } else {
            panel.style.maxHeight = '120px';
            arrow.innerHTML = '&#9650;';
        }
    }
    
    function skipActionLevel() {
        var lvl = userActionProgress.level || 1;
        var tokensToSkip = Math.min(5 + (lvl * 5), 75);
        
        if (confirm('Depenser ' + tokensToSkip + ' tokens pour passer au niveau ' + (lvl+1) + ' ?')) {
            fetch('/api/action/skip-level', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ girl_id: window.currentGirlId })
            }).then(function(r){return r.json();}).then(function(data){
                if (data.success) {
                    userActionProgress = data;
                    showToast('Niveau ' + data.level + ' deverrouille !');
                    showActionDirectFullscreen(window.currentGirlName || 'Elle', window.currentGirlPhoto || '/static/default.jpg');
                } else {
                    showToast(data.error || 'Erreur');
                }
            });
        }
    }

    function loadActionLevels() {
        fetch('/api/action/levels').then(function(r){return r.json();}).then(function(data){
            actionLevels = data.levels || [];
        }).catch(function(e){ actionLevels = []; });
    }

    function loadActionProgress(girlId) {
        fetch('/api/action/progress/' + girlId).then(function(r){return r.json();}).then(function(data){
            if (!data.error) {
                userActionProgress = data;
                updateActionPanelUI();
                updateProfileActionPanel();
            }
        }).catch(function(e){});
    }
    
    // ======= PROFILE ACTION PANEL (Candy AI Style) =======
    var profileActionPanelExpanded = true;
    
    function toggleActionPanel() {
        var panel = document.getElementById('actionDirectPanel');
        var arrow = document.getElementById('adpExpandArrow');
        profileActionPanelExpanded = !profileActionPanelExpanded;
        
        if (profileActionPanelExpanded) {
            panel.classList.remove('collapsed');
            arrow.innerHTML = '&#9650;';
        } else {
            panel.classList.add('collapsed');
            arrow.innerHTML = '&#9660;';
        }
    }
    
    function updateProfileActionPanel() {
        var lvl = userActionProgress.level || 1;
        var xpInLevel = userActionProgress.xp_in_level || 0;
        var xpForNext = userActionProgress.xp_for_next || 35;
        var unlocked = userActionProgress.unlocked_levels || [1];
        var tokensToSkip = Math.min(5 + (lvl * 5), 75);
        
        var levelCircle = document.getElementById('adpLevelCircle');
        var levelNum = document.getElementById('adpLevelNum');
        var skipBtn = document.getElementById('adpSkipBtn');
        var xpFill = document.getElementById('adpXpFill');
        var xpText = document.getElementById('adpXpText');
        var nextLevel = document.getElementById('adpNextLevel');
        
        if (levelCircle) levelCircle.textContent = lvl;
        if (levelNum) levelNum.textContent = lvl;
        if (skipBtn) skipBtn.innerHTML = 'Passer au niveau ' + (lvl+1) + ' &#11088; ' + tokensToSkip;
        if (xpFill) xpFill.style.width = (xpForNext > 0 ? Math.min(100, (xpInLevel/xpForNext)*100) : 0) + '%';
        if (xpText) xpText.textContent = xpInLevel + ' / ' + xpForNext + ' XP';
        if (nextLevel) nextLevel.textContent = lvl + 1;
        
        renderProfileActionsList(lvl, unlocked);
    }
    
    function renderProfileActionsList(lvl, unlocked) {
        var listEl = document.getElementById('adpActionsList');
        if (!listEl) return;
        
        var html = '';
        actionLevels.forEach(function(action) {
            var isUnlocked = unlocked.indexOf(action.level) !== -1 || action.level <= lvl;
            html += '<div class="adp-action-item ' + (isUnlocked ? '' : 'locked') + '">' +
                '<span class="adp-action-text">' + action.title + '</span>' +
                (isUnlocked ? 
                    '<button class="adp-action-play" onclick="playActionVideo(' + action.level + ')"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg></button>' :
                    '<span class="adp-action-lock"><svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM12 17c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg> Niveau ' + action.level + '</span>') +
            '</div>';
        });
        listEl.innerHTML = html;
    }
    
    function skipLevelFromProfile() {
        var lvl = userActionProgress.level || 1;
        var tokensToSkip = Math.min(5 + (lvl * 5), 75);
        
        if (confirm('Depenser ' + tokensToSkip + ' tokens pour passer au niveau ' + (lvl+1) + ' ?')) {
            fetch('/api/action/skip-level', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ girl_id: window.currentGirlId })
            }).then(function(r){return r.json();}).then(function(data){
                if (data.success) {
                    userActionProgress = data;
                    updateProfileActionPanel();
                    showToast('Niveau ' + data.level + ' deverrouille !');
                } else {
                    showToast(data.error || 'Erreur');
                }
            });
        }
    }
    
    function initProfileActionPanel() {
        if (window.currentGirlId) {
            loadActionProgress(window.currentGirlId);
        }
    }

    function openActionPanel() {
        var panel = document.getElementById('actionDirectPanel');
        panel.style.display = 'block';
        actionPanelOpen = true;
        if (window.currentGirlId) {
            loadActionProgress(window.currentGirlId);
        }
        updateActionPanelUI();
    }

    function closeActionPanel() {
        document.getElementById('actionDirectPanel').style.display = 'none';
        actionPanelOpen = false;
    }

    function updateActionPanelUI() {
        var lvl = userActionProgress.level || 1;
        var xpInLevel = userActionProgress.xp_in_level || 0;
        var xpForNext = userActionProgress.xp_for_next || 35;
        var unlocked = userActionProgress.unlocked_levels || [1];

        document.getElementById('xpLevelBadge').textContent = lvl;
        document.getElementById('xpCurrentLevel').textContent = lvl;
        document.getElementById('xpCurrentXP').textContent = xpInLevel;
        document.getElementById('xpMaxXP').textContent = xpForNext;
        document.getElementById('xpTargetLevel').textContent = lvl + 1;

        var pct = xpForNext > 0 ? Math.min(100, (xpInLevel / xpForNext) * 100) : 0;
        document.getElementById('xpProgressFill').style.width = pct + '%';

        var statusEl = document.getElementById('xpLevelStatus');
        if (lvl >= 10) {
            statusEl.textContent = 'NIVEAU MAX ATTEINT !';
            statusEl.style.color = '#ffd700';
        } else if (pct >= 100) {
            statusEl.textContent = 'NIVEAU ' + (lvl+1) + ' DEVERROUILLE !';
            statusEl.style.color = '#4caf50';
        } else {
            statusEl.textContent = 'Passer au niveau ' + (lvl+1);
            statusEl.style.color = '#e91e63';
        }

        var currentAction = actionLevels.find(function(a){ return a.level === lvl; });
        if (currentAction) {
            document.getElementById('currentActionText').textContent = currentAction.title;
        }

        var listEl = document.getElementById('xpRequestsList');
        var html = '';
        var lockedCount = 0;
        actionLevels.forEach(function(action) {
            var isUnlocked = unlocked.indexOf(action.level) !== -1 || action.level <= lvl;
            if (!isUnlocked) lockedCount++;
            html += '<div class="adp-action-item ' + (isUnlocked ? 'unlocked' : 'locked') + '" data-level="' + action.level + '">' +
                '<span class="adp-item-text">' + action.title + '</span>' +
                (isUnlocked ? 
                    '<button class="adp-item-play" onclick="playActionVideo(' + action.level + ')"><span>&#9658;</span></button>' :
                    '<span class="adp-item-lock">&#128274; Niveau ' + action.level + '</span>') +
            '</div>';
        });
        listEl.innerHTML = html;
        document.getElementById('moreActionsCount').textContent = '+' + lockedCount + ' Actions hot';
    }

    function toggleMoreActions() {
        moreActionsExpanded = !moreActionsExpanded;
        var list = document.getElementById('xpRequestsList');
        var arrow = document.getElementById('expandArrow');
        if (moreActionsExpanded) {
            list.style.maxHeight = '400px';
            arrow.innerHTML = '&#9650;';
        } else {
            list.style.maxHeight = '0';
            arrow.innerHTML = '&#9660;';
        }
    }

    function executeCurrentAction() {
        var lvl = userActionProgress.level || 1;
        playActionVideo(lvl);
    }

    function playActionVideo(level) {
        var action = actionLevels.find(function(a){ return a.level === level; });
        if (!action) return;
        var unlocked = userActionProgress.unlocked_levels || [1];
        if (unlocked.indexOf(level) === -1 && level > userActionProgress.level) {
            showToast('Debloquez le niveau ' + level + ' pour voir cette action');
            return;
        }
        if (action.video_url) {
            showActionVideoModal(action);
        } else {
            sendActionRequest(action);
        }
    }

    function showActionVideoModal(action) {
        var modal = document.createElement('div');
        modal.className = 'action-video-modal';
        modal.innerHTML = '<div class="action-video-content">' +
            '<button class="action-video-close" onclick="this.parentElement.parentElement.remove()">&#10005;</button>' +
            '<h3>' + action.title + '</h3>' +
            '<video controls autoplay style="width:100%;max-height:70vh;border-radius:12px;">' +
                '<source src="' + action.video_url + '" type="video/mp4">' +
            '</video>' +
        '</div>';
        modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:9999;display:flex;align-items:center;justify-content:center;padding:20px;';
        modal.querySelector('.action-video-content').style.cssText = 'background:#1a1a2e;padding:20px;border-radius:16px;max-width:600px;width:100%;';
        modal.querySelector('.action-video-close').style.cssText = 'position:absolute;top:10px;right:10px;background:none;border:none;color:white;font-size:24px;cursor:pointer;';
        modal.onclick = function(e) { if (e.target === modal) modal.remove(); };
        document.body.appendChild(modal);
    }

    function sendActionRequest(action) {
        var girlName = window.currentGirlName || 'Elle';
        var girlPhoto = window.currentGirlPhoto || '/static/default.jpg';
        
        showActionLoadingModal(action, girlName, girlPhoto, 'Generation en cours...');
        
        fetch('/api/action/execute', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                girl_id: window.currentGirlId,
                level: action.level
            })
        }).then(function(r) { return r.json(); }).then(function(data) {
            if (data.success) {
                if (data.video_task_id) {
                    updateActionLoadingText('Conversion en video...');
                    pollVideoStatus(data.video_task_id, action, data.image_url, girlName);
                } else if (data.image_url) {
                    hideActionLoadingModal();
                    showActionResultModal(action, data.image_url, null, girlName);
                } else {
                    hideActionLoadingModal();
                    showActionTextModal(action, data.message || action.description, girlName, girlPhoto);
                }
            } else {
                hideActionLoadingModal();
                showToast(data.error || 'Erreur');
            }
        }).catch(function(e) {
            hideActionLoadingModal();
            showActionTextModal(action, action.description, girlName, girlPhoto);
        });
    }
    
    function pollVideoStatus(taskId, action, imageUrl, girlName) {
        var attempts = 0;
        var maxAttempts = 40;
        
        var pollInterval = setInterval(function() {
            attempts++;
            updateActionLoadingText('Creation de la video... (' + Math.min(attempts * 3, 95) + '%)');
            
            fetch('/api/action/video-status/' + taskId).then(function(r) { return r.json(); }).then(function(data) {
                if (data.status === 'completed' && data.video_url) {
                    clearInterval(pollInterval);
                    hideActionLoadingModal();
                    showActionResultModal(action, imageUrl, data.video_url, girlName);
                } else if (data.status === 'failed' || attempts >= maxAttempts) {
                    clearInterval(pollInterval);
                    hideActionLoadingModal();
                    if (imageUrl) {
                        showActionResultModal(action, imageUrl, null, girlName);
                    } else {
                        showToast('Video non disponible');
                    }
                }
            }).catch(function(e) {
                if (attempts >= maxAttempts) {
                    clearInterval(pollInterval);
                    hideActionLoadingModal();
                    if (imageUrl) {
                        showActionResultModal(action, imageUrl, null, girlName);
                    }
                }
            });
        }, 3000);
    }
    
    function updateActionLoadingText(text) {
        var modal = document.getElementById('actionLoadingModal');
        if (modal) {
            var p = modal.querySelector('p');
            if (p) p.textContent = text;
        }
    }
    
    function showActionLoadingModal(action, girlName, girlPhoto, statusText) {
        var modal = document.createElement('div');
        modal.id = 'actionLoadingModal';
        modal.innerHTML = '<div class="action-loading-content">' +
            '<img class="action-loading-avatar" src="' + girlPhoto + '" alt="">' +
            '<div class="action-loading-spinner"></div>' +
            '<h3>' + action.title + '</h3>' +
            '<p>' + (statusText || girlName + ' se prepare...') + '</p>' +
        '</div>';
        modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:99999;display:flex;align-items:center;justify-content:center;';
        modal.querySelector('.action-loading-content').style.cssText = 'text-align:center;color:white;';
        modal.querySelector('.action-loading-avatar').style.cssText = 'width:100px;height:100px;border-radius:50%;object-fit:cover;margin-bottom:20px;border:3px solid #e91e63;';
        modal.querySelector('.action-loading-spinner').style.cssText = 'width:40px;height:40px;border:4px solid rgba(255,255,255,0.2);border-top-color:#e91e63;border-radius:50%;margin:20px auto;animation:spin 1s linear infinite;';
        
        var style = document.createElement('style');
        style.id = 'actionLoadingStyle';
        style.textContent = '@keyframes spin{to{transform:rotate(360deg)}}';
        document.head.appendChild(style);
        document.body.appendChild(modal);
    }
    
    function hideActionLoadingModal() {
        var modal = document.getElementById('actionLoadingModal');
        var style = document.getElementById('actionLoadingStyle');
        if (modal) modal.remove();
        if (style) style.remove();
    }
    
    function showActionResultModal(action, imageUrl, videoUrl, girlName) {
        var modal = document.createElement('div');
        modal.id = 'actionResultModal';
        
        var mediaHtml = '';
        if (videoUrl) {
            mediaHtml = '<video class="action-result-video" controls autoplay loop playsinline>' +
                '<source src="' + videoUrl + '" type="video/mp4">' +
                '</video>';
        } else if (imageUrl) {
            mediaHtml = '<img class="action-result-image" src="' + imageUrl + '" alt="">';
        }
        
        modal.innerHTML = '<div class="action-result-content">' +
            '<button class="action-result-close" onclick="document.getElementById(\'actionResultModal\').remove()">&#10005;</button>' +
            '<h3 class="action-result-title">' + action.title + '</h3>' +
            mediaHtml +
            '<p class="action-result-desc">' + girlName + ': "' + action.description + '"</p>' +
            '<button class="action-result-btn" onclick="document.getElementById(\'actionResultModal\').remove()">Fermer</button>' +
        '</div>';
        modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.95);z-index:99999;display:flex;align-items:center;justify-content:center;padding:20px;overflow-y:auto;';
        modal.querySelector('.action-result-content').style.cssText = 'background:#1a1a2e;padding:20px;border-radius:16px;max-width:500px;width:100%;text-align:center;';
        modal.querySelector('.action-result-close').style.cssText = 'position:absolute;top:15px;right:15px;background:none;border:none;color:white;font-size:24px;cursor:pointer;';
        modal.querySelector('.action-result-title').style.cssText = 'color:#e91e63;margin-bottom:15px;';
        var imgEl = modal.querySelector('.action-result-image');
        if (imgEl) imgEl.style.cssText = 'width:100%;max-height:60vh;object-fit:contain;border-radius:12px;margin-bottom:15px;';
        var vidEl = modal.querySelector('.action-result-video');
        if (vidEl) vidEl.style.cssText = 'width:100%;max-height:60vh;border-radius:12px;margin-bottom:15px;';
        modal.querySelector('.action-result-desc').style.cssText = 'color:#aaa;font-style:italic;margin-bottom:15px;';
        modal.querySelector('.action-result-btn').style.cssText = 'background:linear-gradient(135deg,#e91e63,#9c27b0);color:white;border:none;padding:12px 30px;border-radius:25px;font-size:1rem;cursor:pointer;';
        modal.onclick = function(e) { if (e.target === modal) modal.remove(); };
        document.body.appendChild(modal);
    }
    
    function showActionTextModal(action, message, girlName, girlPhoto) {
        var modal = document.createElement('div');
        modal.id = 'actionTextModal';
        modal.innerHTML = '<div class="action-text-content">' +
            '<button class="action-text-close" onclick="document.getElementById(\'actionTextModal\').remove()">&#10005;</button>' +
            '<img class="action-text-avatar" src="' + girlPhoto + '" alt="">' +
            '<h3 class="action-text-title">' + action.title + '</h3>' +
            '<div class="action-text-bubble">' +
                '<p>' + message + '</p>' +
            '</div>' +
            '<button class="action-text-btn" onclick="document.getElementById(\'actionTextModal\').remove()">OK</button>' +
        '</div>';
        modal.style.cssText = 'position:fixed;inset:0;background:rgba(0,0,0,0.9);z-index:99999;display:flex;align-items:center;justify-content:center;padding:20px;';
        modal.querySelector('.action-text-content').style.cssText = 'background:#1a1a2e;padding:25px;border-radius:16px;max-width:400px;width:100%;text-align:center;';
        modal.querySelector('.action-text-close').style.cssText = 'position:absolute;top:10px;right:10px;background:none;border:none;color:white;font-size:20px;cursor:pointer;';
        modal.querySelector('.action-text-avatar').style.cssText = 'width:80px;height:80px;border-radius:50%;object-fit:cover;margin-bottom:15px;border:3px solid #e91e63;';
        modal.querySelector('.action-text-title').style.cssText = 'color:#e91e63;margin-bottom:15px;';
        modal.querySelector('.action-text-bubble').style.cssText = 'background:#252540;padding:15px 20px;border-radius:20px;margin-bottom:20px;';
        modal.querySelector('.action-text-bubble p').style.cssText = 'color:white;font-size:1rem;margin:0;';
        modal.querySelector('.action-text-btn').style.cssText = 'background:linear-gradient(135deg,#e91e63,#9c27b0);color:white;border:none;padding:10px 25px;border-radius:20px;cursor:pointer;';
        modal.onclick = function(e) { if (e.target === modal) modal.remove(); };
        document.body.appendChild(modal);
    }

    function addXpFromChat(girlId, xpType) {
        fetch('/api/action/add-xp', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ girl_id: girlId, type: xpType })
        }).then(function(r){return r.json();}).then(function(data){
            if (data.success) {
                userActionProgress = {
                    level: data.level,
                    xp: data.xp,
                    xp_in_level: data.xp_in_level,
                    xp_for_next: data.xp_for_next,
                    unlocked_levels: data.unlocked_levels
                };
                if (data.new_levels && data.new_levels.length > 0) {
                    data.new_levels.forEach(function(lvl) {
                        showLevelUpNotification(lvl);
                    });
                }
                if (actionPanelOpen) updateActionPanelUI();
            }
        }).catch(function(e){});
    }

    function showLevelUpNotification(level) {
        var action = actionLevels.find(function(a){ return a.level === level; });
        var title = action ? action.title : 'Nouvelle action';
        var notif = document.createElement('div');
        notif.className = 'level-up-notification';
        notif.innerHTML = '<div class="lun-icon">&#127881;</div>' +
            '<div class="lun-text"><strong>Niveau ' + level + ' debloque !</strong><br><small>' + title + '</small></div>';
        notif.style.cssText = 'position:fixed;top:80px;left:50%;transform:translateX(-50%);background:linear-gradient(135deg,#e91e63,#9c27b0);color:white;padding:15px 25px;border-radius:50px;z-index:9999;display:flex;align-items:center;gap:15px;animation:slideDown 0.5s ease;box-shadow:0 10px 40px rgba(233,30,99,0.4);';
        document.body.appendChild(notif);
        setTimeout(function(){ notif.remove(); }, 4000);
    }

    function skipToNextLevel(girlId) {
        fetch('/api/action/skip-level', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ girl_id: girlId })
        }).then(function(r){return r.json();}).then(function(data){
            if (data.success) {
                showToast('Niveau ' + data.new_level + ' debloque !');
                loadActionProgress(girlId);
            } else {
                showToast(data.error || 'Erreur');
            }
        }).catch(function(e){ showToast('Erreur reseau'); });
    }

    loadActionLevels();

    // =============== MODE LIVE VIDEO CALL ===============
    var liveCallActive = false;
    
    function startLiveCall() {
        if (!window.currentGirlId) {
            showToast('Selectionnez une fille d\'abord');
            return;
        }
        
        showIncomingCall();
    }
    
    function showIncomingCall() {
        var girlName = window.currentGirlName || 'Elle';
        var girlPhoto = window.currentGirlPhoto || '/static/default.jpg';
        
        var modal = document.createElement('div');
        modal.id = 'incomingCallModal';
        modal.innerHTML = '<div class="call-overlay">' +
            '<div class="call-content">' +
                '<div class="call-pulse"></div>' +
                '<img class="call-avatar" src="' + girlPhoto + '" alt="">' +
                '<div class="call-name">' + girlName + '</div>' +
                '<div class="call-status">Appel video entrant...</div>' +
                '<div class="call-buttons">' +
                    '<button class="call-btn call-decline" onclick="declineCall()"><svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.1-.7-.28-.79-.73-1.68-1.36-2.66-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"/></svg></button>' +
                    '<button class="call-btn call-accept" onclick="acceptCall()"><svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M20.01 15.38c-1.23 0-2.42-.2-3.53-.56-.35-.12-.74-.03-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99z"/></svg></button>' +
                '</div>' +
            '</div>' +
        '</div>';
        modal.style.cssText = 'position:fixed;inset:0;z-index:9999;display:flex;align-items:center;justify-content:center;background:rgba(0,0,0,0.9);';
        
        var style = document.createElement('style');
        style.textContent = '.call-overlay{text-align:center;}.call-content{position:relative;}.call-pulse{position:absolute;top:50%;left:50%;width:150px;height:150px;transform:translate(-50%,-50%);border-radius:50%;background:rgba(76,175,80,0.3);animation:callPulse 1.5s infinite;}.call-avatar{width:120px;height:120px;border-radius:50%;border:4px solid #4caf50;object-fit:cover;position:relative;z-index:1;}.call-name{color:white;font-size:1.5rem;font-weight:600;margin-top:20px;}.call-status{color:#aaa;margin-top:8px;}.call-buttons{display:flex;gap:50px;justify-content:center;margin-top:40px;}.call-btn{width:65px;height:65px;border-radius:50%;border:none;cursor:pointer;display:flex;align-items:center;justify-content:center;}.call-decline{background:#ff3b30;color:white;}.call-accept{background:#4caf50;color:white;animation:shake 0.5s infinite;}@keyframes callPulse{0%{transform:translate(-50%,-50%) scale(1);opacity:0.8;}100%{transform:translate(-50%,-50%) scale(1.5);opacity:0;}}@keyframes shake{0%,100%{transform:rotate(-5deg);}50%{transform:rotate(5deg);}}';
        document.head.appendChild(style);
        document.body.appendChild(modal);
        
        if (navigator.vibrate) navigator.vibrate([200, 100, 200, 100, 200]);
    }
    
    function declineCall() {
        var modal = document.getElementById('incomingCallModal');
        if (modal) modal.remove();
        showToast('Appel decline');
    }
    
    function acceptCall() {
        var modal = document.getElementById('incomingCallModal');
        if (modal) modal.remove();
        liveCallActive = true;
        
        fetch('/api/live/start', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ girl_id: window.currentGirlId })
        }).then(function(r){return r.json();}).then(function(data){
            if (data.success) {
                showLiveCallUI(data);
            } else {
                showToast('Erreur de connexion');
            }
        });
    }
    
    function showLiveCallUI(data) {
        var girlPhoto = window.currentGirlPhoto || '/static/default.jpg';
        
        var callUI = document.createElement('div');
        callUI.id = 'liveCallUI';
        callUI.innerHTML = '<div class="live-call-container">' +
            '<div class="live-call-header">' +
                '<span class="live-indicator">&#9679; LIVE</span>' +
                '<span class="live-name">' + data.girl_name + '</span>' +
                '<span class="live-timer" id="liveTimer">00:00</span>' +
            '</div>' +
            '<div class="live-video-area">' +
                (data.video_url ? '<video class="live-camgirl-video" src="' + data.video_url + '" autoplay loop muted playsinline></video>' : 
                '<img class="live-camgirl-video" src="' + girlPhoto + '" alt="">') +
            '</div>' +
            '<div class="live-greeting">' + data.greeting + '</div>' +
            '<div class="live-controls">' +
                '<button class="live-btn" onclick="toggleLiveMute()"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M12 14c1.66 0 3-1.34 3-3V5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3z"/><path d="M17 11c0 2.76-2.24 5-5 5s-5-2.24-5-5H5c0 3.53 2.61 6.43 6 6.92V21h2v-3.08c3.39-.49 6-3.39 6-6.92h-2z"/></svg></button>' +
                '<button class="live-btn live-end" onclick="endLiveCall()"><svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor"><path d="M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.1-.7-.28-.79-.73-1.68-1.36-2.66-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9z"/></svg></button>' +
                '<button class="live-btn" onclick="toggleLiveCamera()"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor"><path d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/></svg></button>' +
            '</div>' +
        '</div>';
        callUI.style.cssText = 'position:fixed;inset:0;z-index:9998;background:#0a0a0c;';
        
        var style = document.createElement('style');
        style.id = 'liveCallStyles';
        style.textContent = '.live-call-container{height:100%;display:flex;flex-direction:column;}.live-call-header{display:flex;align-items:center;gap:15px;padding:15px 20px;background:rgba(0,0,0,0.5);}.live-indicator{color:#ff3b30;font-size:0.8rem;font-weight:600;animation:blink 1s infinite;}.live-name{flex:1;color:white;font-weight:600;}.live-timer{color:#888;font-size:0.9rem;}.live-video-area{flex:1;display:flex;align-items:center;justify-content:center;background:#1a1a1a;}.live-camgirl-video{max-width:100%;max-height:100%;object-fit:contain;}.live-greeting{background:rgba(0,0,0,0.7);color:white;padding:15px 20px;text-align:center;font-style:italic;}.live-controls{display:flex;justify-content:center;gap:30px;padding:25px;background:#12121a;}.live-btn{width:60px;height:60px;border-radius:50%;border:none;background:rgba(255,255,255,0.1);color:white;cursor:pointer;display:flex;align-items:center;justify-content:center;}.live-btn.live-end{background:#ff3b30;}@keyframes blink{0%,100%{opacity:1;}50%{opacity:0.3;}}';
        document.head.appendChild(style);
        document.body.appendChild(callUI);
        
        startLiveTimer();
    }
    
    var liveTimerInterval = null;
    var liveSeconds = 0;
    
    function startLiveTimer() {
        liveSeconds = 0;
        liveTimerInterval = setInterval(function() {
            liveSeconds++;
            var mins = Math.floor(liveSeconds / 60);
            var secs = liveSeconds % 60;
            var el = document.getElementById('liveTimer');
            if (el) el.textContent = (mins < 10 ? '0' : '') + mins + ':' + (secs < 10 ? '0' : '') + secs;
        }, 1000);
    }
    
    function endLiveCall() {
        liveCallActive = false;
        if (liveTimerInterval) clearInterval(liveTimerInterval);
        var ui = document.getElementById('liveCallUI');
        var styles = document.getElementById('liveCallStyles');
        if (ui) ui.remove();
        if (styles) styles.remove();
        showToast('Appel termine - ' + Math.floor(liveSeconds / 60) + ' min');
    }
    
    function toggleLiveMute() { showToast('Micro coupe'); }
    function toggleLiveCamera() { showToast('Camera desactivee'); }

    // =============== MODE POV INTERACTIF ===============
    var povActions = [];
    
    function loadPovActions() {
        fetch('/api/pov/actions').then(function(r){return r.json();}).then(function(data){
            povActions = data.actions || [];
        }).catch(function(e){ povActions = []; });
    }
    
    function openPovMode() {
        if (!window.currentGirlId) {
            showToast('Selectionnez une fille d\'abord');
            return;
        }
        
        var girlName = window.currentGirlName || 'Elle';
        var girlPhoto = window.currentGirlPhoto || '/static/default.jpg';
        var userLevel = userActionProgress.level || 1;
        
        // Charger les actions si pas encore fait
        if (povActions.length === 0) {
            fetch('/api/pov/actions').then(function(r){return r.json();}).then(function(data){
                povActions = data.actions || [];
                showPovModal(girlName, girlPhoto, userLevel);
            });
        } else {
            showPovModal(girlName, girlPhoto, userLevel);
        }
    }
    
    function showPovModal(girlName, girlPhoto, userLevel) {
        var modal = document.createElement('div');
        modal.id = 'povModal';
        modal.innerHTML = '<div class="pov-container">' +
            '<div class="pov-header">' +
                '<button class="pov-close" onclick="closePovMode()">&#10005;</button>' +
                '<span class="pov-title">Mode POV - ' + girlName + '</span>' +
                '<span class="pov-level">Niveau ' + userLevel + '</span>' +
            '</div>' +
            '<div class="pov-video-area">' +
                '<img class="pov-camgirl" src="' + girlPhoto + '" alt="">' +
                '<div class="pov-hands" id="povHands"></div>' +
            '</div>' +
            '<div class="pov-reaction" id="povReaction"></div>' +
            '<div class="pov-actions-grid" id="povActionsGrid"></div>' +
        '</div>';
        modal.style.cssText = 'position:fixed;inset:0;z-index:9998;background:#0a0a0c;';
        
        var style = document.createElement('style');
        style.id = 'povStyles';
        style.textContent = '.pov-container{height:100%;display:flex;flex-direction:column;}.pov-header{display:flex;align-items:center;gap:15px;padding:15px;background:#12121a;}.pov-close{background:none;border:none;color:white;font-size:1.3rem;cursor:pointer;}.pov-title{flex:1;color:white;font-weight:600;}.pov-level{color:#e91e63;font-size:0.85rem;}.pov-video-area{flex:1;position:relative;display:flex;align-items:center;justify-content:center;background:#1a1a1a;overflow:hidden;}.pov-camgirl{max-width:100%;max-height:100%;object-fit:contain;}.pov-hands{position:absolute;bottom:0;left:0;right:0;height:150px;pointer-events:none;}.pov-reaction{min-height:50px;background:#1a1a2e;color:white;padding:15px;text-align:center;font-style:italic;}.pov-actions-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;padding:15px;background:#12121a;}.pov-action-btn{background:rgba(255,255,255,0.1);border:none;color:white;padding:12px 8px;border-radius:12px;font-size:0.75rem;cursor:pointer;text-align:center;transition:all 0.2s;}.pov-action-btn:hover{background:rgba(233,30,99,0.3);}.pov-action-btn.locked{opacity:0.4;pointer-events:none;}.pov-action-icon{font-size:1.3rem;display:block;margin-bottom:5px;}';
        document.head.appendChild(style);
        document.body.appendChild(modal);
        
        renderPovActions(userLevel);
    }
    
    function renderPovActions(userLevel) {
        var grid = document.getElementById('povActionsGrid');
        if (!grid) return;
        
        var icons = {'hand': '&#9995;', 'heart': '&#10084;', 'fire': '&#128293;', 'star': '&#11088;'};
        var html = '';
        povActions.forEach(function(action) {
            var locked = action.level_required > userLevel;
            html += '<button class="pov-action-btn ' + (locked ? 'locked' : '') + '" onclick="executePovAction(' + action.id + ')" ' + (locked ? 'disabled' : '') + '>' +
                '<span class="pov-action-icon">' + (icons[action.icon] || '&#128400;') + '</span>' +
                '<span>' + action.name + '</span>' +
                (locked ? '<br><small style="color:#e91e63;">Niv.' + action.level_required + '</small>' : '') +
            '</button>';
        });
        grid.innerHTML = html;
    }
    
    function executePovAction(actionId) {
        fetch('/api/pov/execute', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ girl_id: window.currentGirlId, action_id: actionId })
        }).then(function(r){return r.json();}).then(function(data){
            if (data.success) {
                var reactionEl = document.getElementById('povReaction');
                if (reactionEl) reactionEl.textContent = '"' + data.reaction + '"';
                addXpFromChat(window.currentGirlId, 'action');
            }
        });
    }
    
    function closePovMode() {
        var modal = document.getElementById('povModal');
        var styles = document.getElementById('povStyles');
        if (modal) modal.remove();
        if (styles) styles.remove();
    }
    
    loadPovActions();

    function renderWatchVideoGrid() {
        var grid = document.getElementById('watchVideoGrid');
        if (watchVideos.length === 0) {
            grid.innerHTML = '<div class="watch-empty">Aucune video disponible</div>';
            return;
        }
        grid.innerHTML = watchVideos.map(function(v){
            return '<div class="watch-video-item" onclick="startWatchVideo('+v.id+')">' +
                '<img src="'+(v.thumbnail_url || 'https://via.placeholder.com/320x180/1a1a1a/666?text=Video')+'" alt="'+v.title+'">' +
                '<div class="video-duration">'+formatWatchDuration(v.duration)+'</div>' +
                '<div class="video-title">'+v.title+'</div>' +
                '<div class="play-icon"><svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg></div>' +
            '</div>';
        }).join('');
    }

    function formatWatchDuration(seconds) {
        var mins = Math.floor(seconds / 60);
        var secs = seconds % 60;
        return mins + ':' + (secs < 10 ? '0' : '') + secs;
    }

    function startWatchVideo(videoId) {
        var video = watchVideos.find(function(v){ return v.id === videoId; });
        if (!video) return;
        currentWatchVideo = video;
        document.getElementById('watchVideoSelection').style.display = 'none';
        document.getElementById('watchPlayerArea').style.display = 'flex';
        
        // Charger la video dans tous les modes
        var allMainVideos = ['watchMainVideo', 'watchMainVideoFT', 'watchMainVideoRX', 'watchMainVideoPOV'];
        allMainVideos.forEach(function(id) {
            var v = document.getElementById(id);
            if (v) { v.src = video.video_url; v.load(); }
        });
        
        // Utiliser la video du mode actif
        var mainVideo;
        if (currentWatchMode === 'facetime') mainVideo = document.getElementById('watchMainVideoFT');
        else if (currentWatchMode === 'reaction') mainVideo = document.getElementById('watchMainVideoRX');
        else mainVideo = document.getElementById('watchMainVideo');
        
        mainVideo.play();
        watchStartTime = Date.now();
        startWatchTimer();
        mainVideo.ontimeupdate = function() {
            updateWatchProgress();
            checkReactionTimestamps(mainVideo.currentTime);
        };
        
        // Charger et jouer la video de reaction
        loadReactionVideoForMode();
        
        // Mettre le nom de la camgirl
        var girlName = window.currentGirlName || 'Elle';
        document.getElementById('watchCamgirlNameRX').textContent = girlName;
        document.getElementById('watchCamgirlNameFT').textContent = girlName;
    }
    
    var chromaFTAnimationId = null;
    
    function loadReactionVideoForMode() {
        // Trouver le premier clip de reaction disponible
        var reactionUrl = null;
        var keys = Object.keys(watchReactions);
        if (keys.length > 0) {
            reactionUrl = watchReactions[keys[0]].url;
        }
        if (!reactionUrl) return;
        
        // Charger dans le mode Reaction
        var rxVideo = document.getElementById('watchReactionVideoRX');
        if (rxVideo) {
            rxVideo.src = reactionUrl;
            rxVideo.load();
            rxVideo.play();
        }
        
        // Charger dans le mode Facetime avec chroma key
        var ftVideo = document.getElementById('watchReactionVideoFT');
        var ftCanvas = document.getElementById('chromaCanvasFT');
        if (ftVideo && ftCanvas) {
            ftVideo.src = reactionUrl;
            ftVideo.load();
            ftVideo.onloadeddata = function() {
                ftCanvas.width = ftVideo.videoWidth || 640;
                ftCanvas.height = ftVideo.videoHeight || 480;
                ftVideo.play();
                startChromaKeyFT();
            };
        }
    }
    
    function startChromaKeyFT() {
        var video = document.getElementById('watchReactionVideoFT');
        var canvas = document.getElementById('chromaCanvasFT');
        var ctx = canvas.getContext('2d', {willReadFrequently: true});
        
        function processFrame() {
            if (video.paused || video.ended) {
                chromaFTAnimationId = requestAnimationFrame(processFrame);
                return;
            }
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            var frame = ctx.getImageData(0, 0, canvas.width, canvas.height);
            var data = frame.data;
            
            for (var i = 0; i < data.length; i += 4) {
                var r = data[i], g = data[i+1], b = data[i+2];
                if (g > 80 && g > r * 1.2 && g > b * 1.2) {
                    data[i+3] = 0;
                }
            }
            ctx.putImageData(frame, 0, 0);
            chromaFTAnimationId = requestAnimationFrame(processFrame);
        }
        processFrame();
    }

    function stopWatchVideo() {
        var mainVideo = document.getElementById('watchMainVideo');
        var reactionVideo = document.getElementById('watchReactionVideo');
        if(mainVideo){ mainVideo.pause(); mainVideo.src = ''; }
        if(reactionVideo){ reactionVideo.pause(); reactionVideo.src = ''; }
        stopWatchTimer();
        stopChromaKey();
        currentWatchVideo = null;
    }

    function toggleWatchPlay() {
        var mainVideo;
        if (currentWatchMode === 'facetime') mainVideo = document.getElementById('watchMainVideoFT');
        else if (currentWatchMode === 'reaction') mainVideo = document.getElementById('watchMainVideoRX');
        else mainVideo = document.getElementById('watchMainVideo');
        if (mainVideo.paused) { mainVideo.play(); } else { mainVideo.pause(); }
    }

    function updateWatchProgress() {
        var mainVideo;
        if (currentWatchMode === 'facetime') mainVideo = document.getElementById('watchMainVideoFT');
        else if (currentWatchMode === 'reaction') mainVideo = document.getElementById('watchMainVideoRX');
        else mainVideo = document.getElementById('watchMainVideo');
        if (!mainVideo || !mainVideo.duration) return;
        var progress = (mainVideo.currentTime / mainVideo.duration) * 100;
        var progressFill = document.getElementById('watchProgressFill') || document.getElementById('roomProgressFill');
        if (progressFill) progressFill.style.width = progress + '%';
        var roomTime = document.getElementById('roomCurrentTime');
        if (roomTime) roomTime.textContent = formatWatchDuration(Math.floor(mainVideo.currentTime));
    }

    function startWatchTimer() {
        stopWatchTimer();
        watchTimerInterval = setInterval(function(){
            var elapsed = Math.floor((Date.now() - watchStartTime) / 1000);
            document.getElementById('watchTimer').textContent = formatWatchDuration(elapsed);
        }, 1000);
    }

    function stopWatchTimer() {
        if (watchTimerInterval) { clearInterval(watchTimerInterval); watchTimerInterval = null; }
    }

    function checkReactionTimestamps(currentTime) {
        if (!currentWatchVideo || !currentWatchVideo.timestamps) return;
        var timestamps = currentWatchVideo.timestamps;
        var currentReaction = 'idle';
        for (var i = timestamps.length - 1; i >= 0; i--) {
            if (currentTime >= timestamps[i].time) {
                currentReaction = timestamps[i].intensity || 'idle';
                if (timestamps[i].comment) showWatchComment(timestamps[i].comment);
                break;
            }
        }
        updateReactionDisplay(currentReaction);
    }

    var chromaAnimationId = null;
    var chromaCanvas = null;
    var chromaCtx = null;
    
    function updateReactionDisplay(reactionType) {
        var reaction = watchReactions[reactionType] || watchReactions['idle'];
        if (!reaction) {
            var keys = Object.keys(watchReactions);
            if (keys.length > 0) reaction = watchReactions[keys[0]];
        }
        var reactionVideo = document.getElementById('watchReactionVideo');
        var reactionImg = document.getElementById('watchReactionImg');
        chromaCanvas = document.getElementById('chromaCanvas');
        
        if (!reaction) {
            if (chromaAnimationId) cancelAnimationFrame(chromaAnimationId);
            chromaCanvas.style.display = 'none';
            return;
        }
        
        if (reaction.is_video) {
            reactionImg.style.display = 'none';
            if (reactionVideo.src !== reaction.url) {
                reactionVideo.src = reaction.url;
                reactionVideo.load();
                reactionVideo.onloadeddata = function() {
                    chromaCanvas.width = reactionVideo.videoWidth || 640;
                    chromaCanvas.height = reactionVideo.videoHeight || 480;
                    chromaCanvas.style.display = 'block';
                    chromaCtx = chromaCanvas.getContext('2d', {willReadFrequently: true});
                    reactionVideo.play();
                    startChromaKey();
                };
            }
        } else {
            if (chromaAnimationId) cancelAnimationFrame(chromaAnimationId);
            chromaCanvas.style.display = 'none';
            reactionImg.style.display = 'block';
            reactionImg.src = reaction.url;
        }
    }
    
    function startChromaKey() {
        var video = document.getElementById('watchReactionVideo');
        if (!chromaCanvas || !chromaCtx || video.paused || video.ended) return;
        
        chromaCtx.drawImage(video, 0, 0, chromaCanvas.width, chromaCanvas.height);
        var frame = chromaCtx.getImageData(0, 0, chromaCanvas.width, chromaCanvas.height);
        var data = frame.data;
        
        for (var i = 0; i < data.length; i += 4) {
            var r = data[i], g = data[i+1], b = data[i+2];
            // Detecte le vert (tolerant)
            if (g > 80 && g > r * 1.2 && g > b * 1.2) {
                data[i+3] = 0; // Rend transparent
            }
        }
        chromaCtx.putImageData(frame, 0, 0);
        chromaAnimationId = requestAnimationFrame(startChromaKey);
    }
    
    function stopChromaKey() {
        if (chromaAnimationId) {
            cancelAnimationFrame(chromaAnimationId);
            chromaAnimationId = null;
        }
    }

    function showWatchComment(text) {
        var comment = document.getElementById('watchCamgirlComment');
        comment.textContent = text;
        comment.classList.remove('show');
        void comment.offsetWidth;
        comment.classList.add('show');
        setTimeout(function(){ comment.classList.remove('show'); }, 3000);
    }

    function toggleWatchFullscreen() {
        var container = document.getElementById('watchTogetherModal');
        if (document.fullscreenElement) { document.exitFullscreen(); }
        else { container.requestFullscreen(); }
    }

    function seekWatch(event) {
        var bar = document.getElementById('watchProgressBar');
        var rect = bar.getBoundingClientRect();
        var percent = (event.clientX - rect.left) / rect.width;
        var mainVideo = document.getElementById('watchMainVideo');
        if (mainVideo.duration) mainVideo.currentTime = percent * mainVideo.duration;
    }

    document.querySelectorAll('.watch-cat-btn').forEach(function(btn){
        btn.addEventListener('click', function(){
            document.querySelectorAll('.watch-cat-btn').forEach(function(b){ b.classList.remove('active'); });
            this.classList.add('active');
            loadWatchVideos(this.dataset.cat);
        });
    });

    window.openWatchTogether = openWatchTogether;
    window.closeWatchTogether = closeWatchTogether;
    window.toggleWatchPlay = toggleWatchPlay;
    window.toggleWatchFullscreen = toggleWatchFullscreen;
    var currentWatchMode = 'reaction';
    
    function setWatchMode(mode) {
        currentWatchMode = mode;
        // Hide all modes
        document.getElementById('watchModeCozy').style.display = 'none';
        document.getElementById('watchModeFacetime').style.display = 'none';
        document.getElementById('watchModeReaction').style.display = 'none';
        document.getElementById('watchModePov').style.display = 'none';
        
        // Update buttons
        document.querySelectorAll('.mode-btn').forEach(function(btn){ btn.classList.remove('active'); });
        if (event && event.target) event.target.classList.add('active');
        
        // Show selected mode
        if (mode === 'facetime') document.getElementById('watchModeFacetime').style.display = 'block';
        else document.getElementById('watchModeReaction').style.display = 'block';
        
        // Sync videos to current mode
        syncVideosToMode(mode);
    }
    
    function syncVideosToMode(mode) {
        var mainSrc = document.getElementById('watchMainVideo').src;
        var reactionSrc = document.getElementById('watchReactionVideo').src;
        var girlName = document.getElementById('watchCamgirlName').textContent;
        
        if (mode === 'facetime') {
            document.getElementById('watchMainVideoFT').src = mainSrc;
            document.getElementById('watchReactionVideoFT').src = reactionSrc;
            document.getElementById('watchCamgirlNameFT').textContent = girlName;
        } else if (mode === 'reaction') {
            document.getElementById('watchMainVideoRX').src = mainSrc;
            document.getElementById('watchReactionVideoRX').src = reactionSrc;
            document.getElementById('watchCamgirlNameRX').textContent = girlName;
        } else if (mode === 'pov') {
            document.getElementById('watchMainVideoPOV').src = mainSrc;
            document.getElementById('watchReactionVideoPOV').src = reactionSrc;
            document.getElementById('watchCamgirlNamePOV').textContent = girlName;
        }
    }
    
    window.setWatchMode = setWatchMode;
    window.startWatchVideo = startWatchVideo;
    window.seekWatch = seekWatch;
    
    // ======= PANNEAU ACTION EN DIRECT FIXE (Style Candy AI) =======
    function showProfileActionPanel() {
        var panel = document.getElementById('profileActionPanelFixed');
        if (panel) {
            panel.style.display = 'block';
            if (window.currentGirlId) {
                loadActionProgress(window.currentGirlId);
            }
        }
    }
    
    function hideProfileActionPanel() {
        var panel = document.getElementById('profileActionPanelFixed');
        if (panel) panel.style.display = 'none';
    }
    
    // NE PAS montrer automatiquement - seulement via bulle XP
    // Observer pour cacher quand on quitte le profil
    var profileObserver = new MutationObserver(function(mutations) {
        var profilePage = document.getElementById('candyProfile');
        if (!profilePage || profilePage.style.display === 'none' || !profilePage.classList.contains('active')) {
            hideProfileActionPanel();
        }
    });
    
    var candyProfile = document.getElementById('candyProfile');
    if (candyProfile) {
        profileObserver.observe(candyProfile, { attributes: true, attributeFilter: ['style', 'class'] });
    }
    </script>

<!-- PANNEAU ACTION EN DIRECT FIXE (GLOBAL) -->
<div id="profileActionPanelFixed" class="profile-action-panel-fixed" style="display:none;">
    <div class="papf-header" onclick="toggleProfileActionPanel()">
        <div class="papf-title">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M13 2L3 14h9l-1 8 10-12h-9l1-8z"/></svg>
            <span>Action en Direct</span>
            <span class="papf-beta">Beta v2</span>
        </div>
        <span class="papf-arrow" id="papfArrow">&#9650;</span>
    </div>
    <div class="papf-content" id="papfContent">
        <div class="papf-level-row">
            <div class="papf-level-circle" id="papfLevel">1</div>
            <span class="papf-level-text">Niveau <span id="papfLevelNum">1</span></span>
            <button class="papf-skip-btn" onclick="skipLevelFromProfile()">Passer au niveau 2 &#11088; 5</button>
        </div>
        <div class="papf-xp-row">
            <div class="papf-xp-bar"><div class="papf-xp-fill" id="papfXpFill" style="width:0%"></div></div>
            <span class="papf-xp-text" id="papfXpText">0 / 35 XP</span>
            <span class="papf-next-level">Niveau <span id="papfNextLevel">2</span></span>
        </div>
        <div class="papf-actions" id="papfActions"></div>
    </div>
</div>

<style>
.profile-action-panel-fixed { position: fixed; bottom: 0; left: 0; right: 0; background: #18182a; border-radius: 20px 20px 0 0; z-index: 9999; box-shadow: 0 -5px 30px rgba(0,0,0,0.5); }
.profile-action-panel-fixed.collapsed .papf-content { display: none; }
.papf-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; cursor: pointer; }
.papf-title { display: flex; align-items: center; gap: 10px; color: white; font-weight: 600; }
.papf-title svg { color: #e91e63; }
.papf-beta { background: #7c4dff; color: white; padding: 3px 10px; border-radius: 12px; font-size: 0.7rem; }
.papf-arrow { color: #888; }
.papf-content { padding: 0 18px 18px; max-height: 50vh; overflow-y: auto; }
.papf-level-row { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; }
.papf-level-circle { width: 38px; height: 38px; border-radius: 50%; background: #2a2a4a; color: white; display: flex; align-items: center; justify-content: center; font-weight: 700; border: 2px solid #7c4dff; }
.papf-level-text { color: #aaa; font-size: 0.9rem; }
.papf-skip-btn { margin-left: auto; background: linear-gradient(135deg, #e91e63, #9c27b0); color: white; border: none; padding: 10px 16px; border-radius: 20px; font-size: 0.8rem; cursor: pointer; }
.papf-xp-row { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; }
.papf-xp-bar { flex: 1; height: 8px; background: #2a2a4a; border-radius: 4px; overflow: hidden; }
.papf-xp-fill { height: 100%; background: linear-gradient(90deg, #e91e63, #ff4081); border-radius: 4px; }
.papf-xp-text { color: #888; font-size: 0.8rem; }
.papf-next-level { color: #e91e63; font-size: 0.8rem; }
.papf-actions { display: flex; flex-direction: column; gap: 8px; }
.papf-action { background: #252540; padding: 14px 16px; border-radius: 12px; display: flex; align-items: center; justify-content: space-between; color: white; }
.papf-action.locked { opacity: 0.6; }
.papf-action-play { width: 40px; height: 40px; border-radius: 50%; background: #e91e63; border: none; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; }
.papf-action-lock { color: #888; font-size: 0.85rem; }
</style>

<script>
function toggleProfileActionPanel() {
    var panel = document.getElementById('profileActionPanelFixed');
    var arrow = document.getElementById('papfArrow');
    panel.classList.toggle('collapsed');
    arrow.innerHTML = panel.classList.contains('collapsed') ? '&#9660;' : '&#9650;';
}

function toggleActionPanelFromBubble() {
    var panel = document.getElementById('profileActionPanelFixed');
    if (!panel) return;
    if (panel.style.display === 'none' || panel.style.display === '') {
        panel.style.display = 'block';
        panel.classList.remove('collapsed');
        var arrow = document.getElementById('papfArrow');
        if (arrow) arrow.innerHTML = '&#9650;';
        if (window.currentGirlId) loadActionProgress(window.currentGirlId);
    } else {
        panel.style.display = 'none';
    }
}

function updateFixedActionPanel() {
    var lvl = userActionProgress.level || 1;
    var xpInLevel = userActionProgress.xp_in_level || 0;
    var xpForNext = userActionProgress.xp_for_next || 35;
    var unlocked = userActionProgress.unlocked_levels || [1];
    var tokensToSkip = Math.min(5 + (lvl * 5), 75);
    
    var levelEl = document.getElementById('papfLevel');
    var levelNumEl = document.getElementById('papfLevelNum');
    var skipBtn = document.querySelector('.papf-skip-btn');
    var xpFill = document.getElementById('papfXpFill');
    var xpText = document.getElementById('papfXpText');
    var nextLevel = document.getElementById('papfNextLevel');
    
    if (levelEl) levelEl.textContent = lvl;
    if (levelNumEl) levelNumEl.textContent = lvl;
    if (skipBtn) skipBtn.innerHTML = 'Passer au niveau ' + (lvl+1) + ' &#11088; ' + tokensToSkip;
    if (xpFill) xpFill.style.width = (xpForNext > 0 ? Math.min(100, (xpInLevel/xpForNext)*100) : 0) + '%';
    if (xpText) xpText.textContent = xpInLevel + ' / ' + xpForNext + ' XP';
    if (nextLevel) nextLevel.textContent = lvl + 1;
    
    var actionsEl = document.getElementById('papfActions');
    if (actionsEl && actionLevels.length > 0) {
        var html = '';
        actionLevels.forEach(function(action) {
            var isUnlocked = unlocked.indexOf(action.level) !== -1 || action.level <= lvl;
            html += '<div class="papf-action ' + (isUnlocked ? '' : 'locked') + '">' +
                '<span>' + action.title + '</span>' +
                (isUnlocked ? 
                    '<button class="papf-action-play" onclick="playActionVideo(' + action.level + ')">&#9658;</button>' :
                    '<span class="papf-action-lock">&#128274; Niveau ' + action.level + '</span>') +
            '</div>';
        });
        actionsEl.innerHTML = html;
    }
}

// Hook into loadActionProgress
var origLoadActionProgress = loadActionProgress;
loadActionProgress = function(girlId) {
    fetch('/api/action/progress/' + girlId).then(function(r){return r.json();}).then(function(data){
        if (!data.error) {
            userActionProgress = data;
            updateActionPanelUI();
            updateProfileActionPanel();
            updateFixedActionPanel();
        }
    }).catch(function(e){});
};

// Panel stays hidden until XP bubble is clicked
// Removed auto-show behavior
</script>

<!-- CANDY AI STYLE XP BUBBLE -->
<style>
.xp-bubble-candy {
    position: fixed;
    bottom: 100px;
    right: 20px;
    width: 55px;
    height: 55px;
    border-radius: 50%;
    background: conic-gradient(#4ade80 var(--xp-progress, 0%), #333 0%);
    display: none;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 10000;
    box-shadow: 0 4px 20px rgba(74, 222, 128, 0.4);
    transition: transform 0.2s, box-shadow 0.2s;
}
.xp-bubble-candy:hover { transform: scale(1.1); box-shadow: 0 6px 25px rgba(74, 222, 128, 0.6); }
.xp-bubble-candy-inner {
    width: 43px;
    height: 43px;
    border-radius: 50%;
    background: linear-gradient(135deg, #1a1a2e, #16213e);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 1.2rem;
    color: #4ade80;
    border: 2px solid #4ade80;
}
.xp-popup-candy {
    position: fixed;
    bottom: 165px;
    right: 30px;
    color: #4ade80;
    font-weight: bold;
    font-size: 1rem;
    pointer-events: none;
    animation: xpPopupAnim 1.5s ease-out forwards;
    z-index: 10001;
    text-shadow: 0 2px 10px rgba(74, 222, 128, 0.8);
}
@keyframes xpPopupAnim {
    0% { opacity: 1; transform: translateY(0) scale(1); }
    50% { opacity: 1; transform: translateY(-20px) scale(1.2); }
    100% { opacity: 0; transform: translateY(-50px) scale(0.8); }
}
</style>

<div id="xpBubbleCandy" class="xp-bubble-candy" onclick="toggleActionPanelFromBubble()">
    <div class="xp-bubble-candy-inner" id="xpBubbleCandyLevel">1</div>
</div>
<div id="xpPopupContainer"></div>

<script>
window.showXpBubbleCandy = function() {
    var bubble = document.getElementById('xpBubbleCandy');
    if (bubble) bubble.style.display = 'flex';
};
window.hideXpBubbleCandy = function() {
    var bubble = document.getElementById('xpBubbleCandy');
    if (bubble) bubble.style.display = 'none';
};
window.updateXpBubbleCandy = function(level, xp, maxXp) {
    console.log('[XP CANDY] updateXpBubbleCandy called:', level, xp, maxXp);
    var progress = Math.min(100, (xp / (maxXp || 35)) * 100);
    var bubble = document.getElementById('xpBubbleCandy');
    if (bubble) {
        bubble.style.setProperty('--xp-progress', progress + '%');
    }
    var levelEl = document.getElementById('xpBubbleCandyLevel');
    if (levelEl) levelEl.textContent = level;
};
window.showXpPopupCandy = function(amount) {
    console.log('[XP CANDY] showXpPopupCandy called:', amount);
    var container = document.getElementById('xpPopupContainer');
    if (!container) {
        container = document.createElement('div');
        container.id = 'xpPopupContainer';
        container.style.cssText = 'position:fixed;bottom:120px;right:20px;z-index:9999;pointer-events:none;';
        document.body.appendChild(container);
    }
    var popup = document.createElement('div');
    popup.className = 'xp-popup-candy';
    popup.textContent = '+' + amount + ' XP';
    popup.style.right = (25 + Math.random() * 30) + 'px';
    container.appendChild(popup);
    setTimeout(function() { popup.remove(); }, 1500);
};

// Auto-detect chat visibility and show XP bubble
var xpBubbleLastGirlId = null;
setInterval(function() {
    var chatVisible = false;
    var chatPages = document.querySelectorAll('[id*="chat"], .chat-page, .candy-chat-page');
    chatPages.forEach(function(el) {
        if (el.style.display !== 'none' && (el.classList.contains('active') || el.offsetParent !== null)) {
            chatVisible = true;
        }
    });
    
    var girlId = window.currentGirlId;
    
    if (chatVisible && girlId) {
        showXpBubbleCandy();
        // Load XP if girl changed
        if (xpBubbleLastGirlId !== girlId) {
            xpBubbleLastGirlId = girlId;
            fetch('/api/action/progress?girl_id=' + girlId)
                .then(function(r) { return r.json(); })
                .then(function(data) {
                    if (data.level) {
                        updateXpBubbleCandy(data.level, data.xp_in_level || 0, data.xp_for_next || 35);
                    }
                }).catch(function(e) { console.log('[XP] Error:', e); });
        }
    } else {
        hideXpBubbleCandy();
    }
}, 500);

// XP is handled by app.js addXP function - it calls showXpPopupCandy and updateXpBubbleCandy
</script>

<!-- V3 Service Worker Registration -->
<script>
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
            .then(registration => {
                console.log('âœ… Service Worker V3 registered:', registration.scope);

                // Check for updates every 30 seconds
                setInterval(() => {
                    registration.update();
                }, 30000);
            })
            .catch(error => {
                console.error('âŒ Service Worker registration failed:', error);
            });
    });
}

// V3 Features - Stories Auto-refresh
setInterval(() => {
    if (window.currentPage === 'discover') {
        fetch('/api/v3/stories')
            .then(r => r.json())
            .then(data => {
                if (data.stories) {
                    console.log('ðŸ“– Stories updated:', data.count);
                }
            })
            .catch(e => console.log('Stories update error:', e));
    }
}, 60000); // Every minute

// V3 Features - Check for daily challenges
function checkDailyChallenges() {
    fetch('/api/v3/challenges')
        .then(r => r.json())
        .then(data => {
            if (data.challenges && data.challenges.length > 0) {
                console.log('ðŸŽ¯ Daily challenges available:', data.challenges.length);
                // Show notification badge on challenges icon
                const challengeBadge = document.querySelector('.challenge-badge');
                if (challengeBadge) {
                    challengeBadge.textContent = data.challenges.length;
                    challengeBadge.style.display = 'block';
                }
            }
        })
        .catch(e => console.log('Challenges check error:', e));
}

// Check challenges on page load
setTimeout(checkDailyChallenges, 2000);

console.log('âœ… Dream AI Girl V3 - Frontend loaded');
</script>
</body>
</html>
